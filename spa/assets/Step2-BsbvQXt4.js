import{j as e,h as A,G as I,u as S,a as U,r as b,b as l,L as M}from"./index-BCQQ6zpL.js";import{u as v}from"./useMutation-ByUVrACc.js";import{A as F,a as V,b as B}from"./avatar-4Rggkv7J.js";import{B as j}from"./button-BH4btbcH.js";import{C as N,a as y}from"./card-Ez0Z9LcK.js";import{l as P,v as R}from"./channelsApi-lyuCwBMD.js";import{g as C}from"./errorMapping-C1vL_WNS.js";import{u as z}from"./useAddChannelFlow-Br0ZUT7p.js";import{f as D}from"./formatters-DrHNNfko.js";const G=I("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function K({className:t,variant:s,...m}){return e.jsx("div",{className:A(G({variant:s}),t),...m})}const O=(t,s)=>t==null?null:D(t,s,{notation:"compact"}),T=t=>{const s=String(t.status??"").toUpperCase();return["VERIFIED","SUCCESS","OK"].includes(s)},_=()=>{const t=S(),{t:s,language:m}=U(),{state:c,setLinkedChannelId:k,setLinkStatus:d,setVerifyStatus:i,setLastError:o}=z(),n=c.preview;b.useEffect(()=>{n||t("/add-channel/step-1",{replace:!0})},[t,n]);const E=b.useMemo(()=>n?.username?n.username.startsWith("@")?n.username:`@${n.username}`:s("common.emptyValue"),[n?.username,s]),p=v({mutationFn:a=>P({username:a}),onMutate:()=>{d("loading"),o(null)},onSuccess:a=>{const r=a.channelId??a.id;if(!r){const g=s("channels.add.step2.missingLinkId");d("error"),o(g),l.error(g);return}d("success"),k(r),i("idle"),l.success(s("channels.add.step2.linkedToast")),u.mutate(r)},onError:a=>{const r=C(a);d("error"),o(r),l.error(r)}}),u=v({mutationFn:a=>R({id:a}),onMutate:()=>{i("loading"),o(null)},onSuccess:a=>{if(T(a)){i("success"),o(null),t("/add-channel/step-3");return}const r=typeof a.error=="string"?a.error:a.error?.message||s("channels.add.step2.verifyError");i("error"),o(r),l.error(r)},onError:a=>{const r=C(a);i("error"),o(r),l.error(r)}}),L=()=>{if(!n)return;const a=(n.normalizedUsername||n.username||"").replace(/^@/,"");if(!c.linkedChannelId){if(!a){l.error(s("channels.add.step2.missingUsername"));return}p.mutate(a);return}u.mutate(c.linkedChannelId)},x=p.isPending||u.isPending,f=!!c.linkedChannelId,w=s(f?"channels.add.step2.verifyAction":"channels.add.step2.connectAction"),h=O(n?.memberCount,m);return n?e.jsxs("div",{className:"flex flex-1 flex-col gap-4",children:[e.jsx(N,{className:"border-border/60 bg-card/80 shadow-sm",children:e.jsxs(y,{className:"space-y-4 p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(F,{className:"h-12 w-12",children:[n.photoUrl||n.avatarUrl?e.jsx(V,{src:n.photoUrl??n.avatarUrl??""}):null,e.jsx(B,{className:"bg-secondary text-sm font-semibold text-foreground",children:(n.title||s("common.avatarFallback")).charAt(0)})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-sm font-semibold text-foreground",children:n.title}),e.jsx("p",{className:"text-xs text-muted-foreground",children:E})]}),e.jsx(K,{variant:"secondary",className:"text-[10px]",children:s(f?"channels.add.step2.linkedStatus":"channels.add.step2.notLinked")})]}),h?e.jsx("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:e.jsxs("span",{children:[h," ",s("marketplace.subscribers")]})}):null]})}),e.jsx(N,{className:"border-border/60 bg-card/80 shadow-sm",children:e.jsxs(y,{className:"space-y-3 p-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:s("channels.add.step2.title")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s("channels.add.step2.subtitle")})]}),e.jsxs("ol",{className:"space-y-2 text-xs text-muted-foreground",children:[e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-foreground",children:"1."}),s("channels.add.step2.instructions.1")]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-foreground",children:"2."}),s("channels.add.step2.instructions.2")]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-foreground",children:"3."}),s("channels.add.step2.instructions.3")]})]})]})}),e.jsxs("div",{className:"mt-auto flex flex-col gap-3",children:[e.jsx(j,{onClick:L,disabled:x,className:"w-full text-sm font-semibold",children:x?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4 animate-spin"}),s(f?"channels.add.step2.verifying":"channels.add.step2.connecting")]}):w}),e.jsx(j,{variant:"secondary",onClick:()=>t("/add-channel/step-1"),disabled:x,className:"w-full text-sm font-semibold",children:s("common.back")})]})]}):null};export{_ as default};
