import{c as U,r as d,a as V,j as e,u as _,e as H,f as G,g as O,R as S}from"./index-ybLFTs8B.js";import{a as q,b as $,c as T}from"./formatters-CG109iVp.js";import{a as Q,g as z,d as F,e as K,f as W}from"./labels-EEWNt0UM.js";import{U as g}from"./roles-CjDqvnis.js";import{C as J}from"./chevron-down-BS_lKzCN.js";import{E as X}from"./ErrorState-B1Jc3FHf.js";import{L as Y}from"./LoadingSkeleton-D6pEFm-W.js";import{P as Z}from"./PageContainer-BKz37zUv.js";import{g as ee}from"./errors-3kY4UU5q.js";import{a as te}from"./use-deals-DYEI7C-K.js";import{D as L}from"./ui-lReITsQM.js";import"./ton-ClBVV2oW.js";import"./skeleton-D3b6bNU7.js";import"./useQuery-C7nRNiff.js";import"./useMutation-BL1o5r2Q.js";import"./dealsApi-BjXNCFRV.js";import"./deals-gDsdDI1w.js";import"./channels-CCH0-4EZ.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]],ae=U("megaphone",se),ne={[g.ADVERTISER]:"bg-emerald-500/10 text-emerald-400",[g.PUBLISHER]:"bg-emerald-500/10 text-emerald-400",[g.PUBLISHER_MANAGER]:"bg-emerald-500/10 text-emerald-400"},oe=({deal:t,onSelect:r})=>{const{t:a,language:l}=V(),[i,f]=d.useState(!1),m=t.listing.lifetimeHours?Q(a,t.listing.lifetimeHours):null,h=t.listing.placementHours?z(a,t.listing.placementHours):null,b=[m,h].filter(Boolean).join(" • "),N=F(a,t.escrowStatus);return e.jsxs("div",{className:`w-full rounded-2xl border border-border/60 bg-card/80 p-4 text-left shadow-sm transition ${r?"cursor-pointer hover:border-primary/40 hover:bg-card":""}`,role:r?"button":void 0,tabIndex:r?0:void 0,onClick:()=>r(t),onKeyDown:c=>{r&&(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),r(t))},children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex min-w-0 items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center overflow-hidden rounded-full bg-secondary/60 text-lg font-semibold text-muted-foreground",children:t.channel.avatarUrl?e.jsx("img",{src:t.channel.avatarUrl,alt:t.channel.name,className:"h-full w-full object-cover"}):t.channel.name.slice(0,1)}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:e.jsx("span",{className:"truncate",children:t.channel.name})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",t.channel.username]})]})]}),e.jsx("span",{className:`max-w-[160px] truncate whitespace-nowrap rounded-full px-3 py-1 text-xs font-semibold ${ne[t.userRoleInDeal]}`,style:{textOverflow:"ellipsis"},children:a("deals.badge.youAreRole",{role:K(a,t.userRoleInDeal)})})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2 overflow-hidden",children:[e.jsx("span",{className:"max-w-[200px] truncate whitespace-nowrap rounded-full border border-border/60 bg-background/50 px-3 py-1 text-xs font-semibold text-muted-foreground",style:{textOverflow:"ellipsis"},children:N}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[q(t.listing.priceNano,l)," ",a("common.ton")]})]}),e.jsxs("div",{className:"mt-3 space-y-1",children:[b?e.jsx("p",{className:"text-xs text-muted-foreground",children:b}):null,t.scheduledAt?e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a("deals.scheduledAt"),": ",$(t.scheduledAt,l)]}):null]}),e.jsxs("button",{type:"button",onClick:c=>{c.stopPropagation(),f(o=>!o)},className:"mt-3 flex w-full items-center justify-between rounded-lg border border-border/60 bg-background/60 px-3 py-2 text-xs font-semibold text-muted-foreground transition hover:text-foreground",children:[e.jsx("span",{children:a(i?"common.hideDetails":"common.showDetails")}),e.jsx(J,{size:14,className:`transition-transform ${i?"rotate-180":""}`})]}),i?e.jsxs("div",{className:"mt-3 space-y-3 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium text-foreground",children:[a("common.createdAt"),":"]})," ",T(t.createdAt,l)||a("common.emptyValue")]}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium text-foreground",children:[a("deals.scheduledAt"),":"]})," ",T(t.scheduledAt,l)||a("common.emptyValue")]})]}),t.listing.tags.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:t.listing.tags.map(c=>e.jsxs("span",{className:"rounded-full bg-secondary/60 px-3 py-1 text-xs font-medium text-foreground",children:["#",c]},c))}):null,e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("span",{className:"rounded-full bg-secondary/60 px-3 py-1 text-xs font-medium text-foreground",children:[a("listings.formatLabel"),": ",W(a,t.listing.format)]}),e.jsx("span",{className:"rounded-full bg-secondary/60 px-3 py-1 text-xs font-medium text-foreground",children:h??a("listings.meta.notPinned")}),e.jsx("span",{className:"rounded-full bg-secondary/60 px-3 py-1 text-xs font-medium text-foreground",children:m??a("listings.meta.noVisibility")})]})]}):null]})},I=d.memo(oe),y=5,w=()=>({items:[],page:1,limit:y,total:0}),E=(t,r)=>{if(r.page<=1)return{...r,items:r.items};const a=new Set(t.items.map(i=>i.id)),l=[...t.items];return r.items.forEach(i=>{a.has(i.id)||l.push(i)}),{...r,items:l}},P={pending:L.PENDING,active:L.ACTIVE,completed:L.COMPLETED};function Le(){const t=_(),r=H(),a=G(),l=r.state?.activeTab,[i,f]=d.useState(l??"pending"),[m,h]=d.useState({pending:1,active:1,completed:1}),[b,N]=d.useState({pending:w(),active:w(),completed:w()}),c=d.useMemo(()=>({role:"all",pendingPage:m.pending,pendingLimit:y,activePage:m.active,activeLimit:y,completedPage:m.completed,completedLimit:y}),[m]),{data:o,isLoading:A,isFetching:x,error:v,refetch:k}=te(c);d.useEffect(()=>{if(!o)return;[...o.pending.items,...o.active.items,...o.completed.items].forEach(n=>{a.setQueryData(["dealById",n.id],n)}),N(n=>({pending:o.pending.page===n.pending.page&&o.pending.total===n.pending.total&&o.pending.items.length===n.pending.items.length?n.pending:E(n.pending,o.pending),active:o.active.page===n.active.page&&o.active.total===n.active.total&&o.active.items.length===n.active.items.length?n.active:E(n.active,o.active),completed:o.completed.page===n.completed.page&&o.completed.total===n.completed.total&&o.completed.items.length===n.completed.items.length?n.completed:E(n.completed,o.completed)}))},[o]),d.useEffect(()=>{l&&f(l)},[l]),d.useEffect(()=>{const s=O();!s?.MainButton?.showProgress||!s.MainButton.hideProgress||(x?s.MainButton.showProgress(!0):s.MainButton.hideProgress())},[x]);const M=d.useCallback(s=>{h(n=>({...n,[s]:n[s]+1}))},[]),R=d.useCallback(s=>{a.setQueryData(["dealById",s.id],s),t(S.DEAL_DETAILS(s.id),{state:{deal:s,rootBackTo:S.DEALS}})},[t,a]),u=b[i],{buyerDeals:j,sellerDeals:p}=d.useMemo(()=>{const s=u.items.filter(D=>D.userRoleInDeal===g.ADVERTISER),n=u.items.filter(D=>D.userRoleInDeal!==g.ADVERTISER);return{buyerDeals:s,sellerDeals:n}},[u.items]),C=u.items.length<u.total,B=!A&&!v&&j.length===0&&p.length===0&&!x;return e.jsx("div",{className:"w-full max-w-3xl mx-auto",children:e.jsxs(Z,{className:"pt-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-foreground",children:"Deals"}),e.jsx("div",{className:"mt-4 flex gap-6 border-b border-border/60",children:Object.keys(P).map(s=>e.jsx("button",{type:"button",onClick:()=>f(s),className:`pb-3 text-sm font-semibold transition-colors ${i===s?"border-b-2 border-primary text-primary":"text-muted-foreground"}`,children:P[s]},s))})]}),A&&u.items.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"border-t border-border/60"}),e.jsx("div",{className:"space-y-3",children:e.jsx(Y,{items:2})})]}):v?e.jsx(X,{message:ee(v,"Unable to load deals"),description:"Please try again in a moment.",onRetry:()=>k()}):B?e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-8 text-center",children:[e.jsx("h2",{className:"text-base font-semibold text-foreground",children:"No deals in this section"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Deals in this section will appear here once they are created."})]}):e.jsxs("div",{className:"space-y-5",children:[j.length>0?e.jsx("div",{className:"space-y-3",children:e.jsx("div",{className:"space-y-3",children:j.map(s=>e.jsx(I,{deal:s,onSelect:R},s.id))})}):null,j.length>0&&p.length>0?e.jsx("div",{className:"border-t border-border/60"}):null,p.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold text-muted-foreground",children:[e.jsx(ae,{size:14}),"Selling ads",e.jsx("span",{className:"text-[11px] font-normal",children:"·"}),e.jsx("span",{className:"text-[11px] font-normal",children:p.length})]}),e.jsx("div",{className:"space-y-3",children:p.map(s=>e.jsx(I,{deal:s,onSelect:R},s.id))})]}):null,C?e.jsx("button",{type:"button",onClick:()=>M(i),disabled:x,className:"w-full rounded-lg border border-border/60 bg-background px-4 py-2 text-sm font-semibold text-foreground transition hover:bg-secondary/40 disabled:opacity-60",children:x?"Loading...":"Load more"}):null]})]})})}export{Le as default};
