import{c as U,r as b,j as e,f as x,e as v,a as m,p as j,b as F,d as W}from"./index-zAfQEn9H.js";import{u as I}from"./useQuery-CSXGqviw.js";import{C as q}from"./chevron-left-Db8Y05e0.js";import{a as G,f as H}from"./dealsApi-CSTXWWzU.js";import{L as V}from"./LoadingSkeleton-CGJkyIjQ.js";import{E as Y}from"./ErrorState-1ucR_w2H.js";import{P as $}from"./PageContainer-DDyL6h17.js";import{g as N}from"./errors-3kY4UU5q.js";import{u as E}from"./useMutation-c8BVbBBw.js";import{o as R}from"./telegramLinks-DFMIlj7w.js";import"./skeleton-B5Y_OuaW.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Q=U("chevron-right",B),K=t=>{try{const r=BigInt(t),s=r/1000000000n,o=r%1000000000n;if(o===0n)return s.toString();const n=o.toString().padStart(9,"0").slice(0,2);return`${s.toString()}.${n}`}catch{return t}},X=t=>t?t.toLowerCase().replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase()):"Post";function z({deal:t}){const[r,s]=b.useState(!1),o=`${K(t.listing.priceNano)} TON`,n=X(t.listing.format),i=t.listing.tags??[],a=t.listing.pinDurationHours??t.listing.placementHours,u=t.listing.visibilityDurationHours??t.listing.lifetimeHours,l=b.useMemo(()=>[{label:"Pin hours",value:a?`${a}h`:"None"},{label:"Lifetime hours",value:u?`${u}h`:"—"},{label:"Edits",value:t.listing.allowEdits===void 0?"—":t.listing.allowEdits?"Allowed":"No edits"},{label:"Link tracking",value:t.listing.allowLinkTracking===void 0?"—":t.listing.allowLinkTracking?"Enabled":"Disabled"}],[t.listing.allowEdits,t.listing.allowLinkTracking,a,u]);return e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center overflow-hidden rounded-full bg-secondary/60 text-lg font-semibold text-muted-foreground",children:t.channel.avatarUrl?e.jsx("img",{src:t.channel.avatarUrl,alt:t.channel.name,className:"h-full w-full object-cover"}):t.channel.name.slice(0,1)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:[e.jsx("span",{className:"truncate",children:t.channel.name}),t.channel.verified?e.jsx("span",{className:"rounded-full bg-emerald-500/10 px-2 py-0.5 text-[10px] font-semibold text-emerald-400",children:"Verified"}):null]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",t.channel.username]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:o}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("button",{type:"button",onClick:()=>s(d=>!d),className:"flex w-full items-center justify-between rounded-lg border border-border/60 bg-background/60 px-3 py-2 text-xs font-semibold text-muted-foreground transition hover:text-foreground",children:[e.jsx("span",{children:r?"Hide details":"More"}),e.jsx("span",{className:x("text-xs",r?"text-foreground":"text-muted-foreground"),children:r?"▴":"▾"})]})}),r?e.jsxs("div",{className:"mt-4 space-y-3 text-xs text-muted-foreground",children:[i.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(d=>e.jsxs("span",{className:"rounded-full bg-secondary/60 px-3 py-1 text-xs font-medium text-foreground",children:["#",d]},d))}):null,e.jsx("div",{className:"grid gap-2 sm:grid-cols-2",children:l.map(d=>e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-[11px] uppercase tracking-wide text-muted-foreground",children:d.label}),e.jsx("span",{className:"font-semibold text-foreground",children:d.value})]},d.label))}),t.listing.contentRulesText?e.jsxs("div",{className:"rounded-lg border border-border/60 bg-background/50 p-3 text-xs text-muted-foreground",children:[e.jsx("p",{className:"text-[11px] font-semibold uppercase tracking-wide text-foreground/80",children:"Content rules"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:t.listing.contentRulesText})]}):null]}):null]})}const S=["SCHEDULE","SEND_POST","CONFIRM_POST","ADMIN_APPROVAL","PAYMENT_WINDOW","PAYMENT","PAYMENT_PENDING","SCHEDULED","VERIFYING","DONE"],J={SCHEDULING_PENDING:"SCHEDULE",CREATIVE_AWAITING_SUBMIT:"SEND_POST",CREATIVE_AWAITING_CONFIRM:"CONFIRM_POST",ADMIN_REVIEW:"ADMIN_APPROVAL",PAYMENT_WINDOW_PENDING:"PAYMENT_WINDOW",PAYMENT_AWAITING:"PAYMENT",FUNDS_PENDING:"PAYMENT_PENDING",FUNDS_CONFIRMED:"SCHEDULED",APPROVED_SCHEDULED:"SCHEDULED",POSTED_VERIFYING:"VERIFYING",COMPLETED:"DONE",CANCELED:"DONE",REFUNDED:"DONE",DISPUTED:"DONE"},Z={SCHEDULE:"Schedule time",SEND_POST:"Send post",CONFIRM_POST:"Confirm post",ADMIN_APPROVAL:"Admin approval",PAYMENT_WINDOW:"Payment window",PAYMENT:"Payment",PAYMENT_PENDING:"Payment pending",SCHEDULED:"Scheduled",VERIFYING:"Verifying",DONE:"Done"},ee={SCHEDULING_PENDING:"Scheduling pending",CREATIVE_AWAITING_SUBMIT:"Creative awaiting submit",CREATIVE_AWAITING_CONFIRM:"Creative awaiting confirm",ADMIN_REVIEW:"Admin review",PAYMENT_WINDOW_PENDING:"Payment window pending",PAYMENT_AWAITING:"Payment awaiting",FUNDS_PENDING:"Funds pending",FUNDS_CONFIRMED:"Funds confirmed",APPROVED_SCHEDULED:"Approved & scheduled",POSTED_VERIFYING:"Posted verifying",COMPLETED:"Completed",CANCELED:"Canceled",REFUNDED:"Refunded",DISPUTED:"Disputed"},w=t=>J[t]??"SCHEDULE",te=t=>{const r=w(t),s=S.indexOf(r);return s===-1?["SCHEDULE"]:S.slice(0,s+1)},re=t=>Z[t]??t,se=t=>ee[t]??t.replace(/_/g," "),ne=(t,r)=>{const s=w(r);return S.indexOf(t)<=S.indexOf(s)};function oe({stages:t,selectedStage:r,escrowStatus:s,onSelect:o}){const n=t.indexOf(r),i=n>0?t[n-1]:null,a=n>=0&&n<t.length-1?t[n+1]:null,u=!!o;return e.jsxs("div",{className:"rounded-2xl border border-border/50 bg-card/80 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Timeline"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.length," steps"]})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>i&&o?.(i),disabled:!i||!u,className:x("flex h-9 w-9 items-center justify-center rounded-full border border-border/60 text-muted-foreground transition",i&&u?"hover:text-foreground":"cursor-not-allowed opacity-40"),"aria-label":"Previous stage",children:e.jsx(q,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex flex-1 flex-wrap gap-2",children:t.map(l=>{const d=l===r,p=!ne(l,s);return e.jsx("button",{type:"button",onClick:()=>o?.(l),disabled:p||!u,className:x("rounded-full border px-3 py-1 text-xs font-semibold transition",d?"border-primary/50 bg-primary/15 text-primary-foreground":"border-border/60 bg-background/50 text-muted-foreground",p||!u?"cursor-not-allowed opacity-40":"hover:border-primary/40 hover:text-foreground"),children:re(l)},l)})}),e.jsx("button",{type:"button",onClick:()=>a&&o?.(a),disabled:!a||!u,className:x("flex h-9 w-9 items-center justify-center rounded-full border border-border/60 text-muted-foreground transition",a&&u?"hover:text-foreground":"cursor-not-allowed opacity-40"),"aria-label":"Next stage",children:e.jsx(Q,{className:"h-4 w-4"})})]})]})}function g({title:t,children:r}){return e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("p",{className:"text-sm font-semibold text-foreground",children:t})}),e.jsx("div",{className:"mt-3 space-y-2 text-xs text-muted-foreground",children:r})]})}const P=t=>{if(!t)return"";const r=new Date(t);if(Number.isNaN(r.getTime()))return"";const s=l=>l.toString().padStart(2,"0"),o=r.getFullYear(),n=s(r.getMonth()+1),i=s(r.getDate()),a=s(r.getHours()),u=s(r.getMinutes());return`${o}-${n}-${i}T${a}:${u}`};function ae({deal:t,readonly:r,onAction:s}){const o=v(),[n,i]=b.useState(P(t.scheduledAt));b.useEffect(()=>{i(P(t.scheduledAt))},[t.scheduledAt]);const a=E({mutationFn:async()=>{if(!n)throw new Error("Select a date and time before saving.");return j("/deals/schedule",{dealId:t.id,scheduledAt:n})},onSuccess:()=>{m.success("Schedule updated"),o.invalidateQueries({queryKey:["deal",t.id]})},onError:l=>{m.error(N(l,"Unable to save schedule"))}});if(r)return e.jsxs(g,{title:"Schedule time",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Waiting for advertiser to complete this step."}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Scheduled:"," ",e.jsx("span",{className:"font-semibold text-foreground",children:t.scheduledAt?new Date(t.scheduledAt).toLocaleString():"Not scheduled yet"})]})]});const u=()=>{if(!n){m.error("Select a date and time before saving.");return}if(s?.onConfirmSchedule){s.onConfirmSchedule(n);return}a.mutate()};return e.jsxs(g,{title:"Schedule time",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Choose when this post should go live. The time is saved to the deal schedule."}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsx("input",{type:"datetime-local",value:n,onChange:l=>i(l.target.value),className:"w-full rounded-lg border border-border/60 bg-background/60 px-3 py-2 text-xs text-foreground"}),e.jsx("button",{type:"button",onClick:u,disabled:a.isPending,className:x("rounded-lg bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground transition",a.isPending?"cursor-not-allowed opacity-60":"hover:bg-primary/90"),children:"Confirm schedule"})]})]})}const ie="postgramx_bot";function de({deal:t,readonly:r,onAction:s}){const o=v(),n=`https://t.me/${ie}?start=deal_${t.id}`,i=!!t.creativeText,a=E({mutationFn:async()=>j("/deals/creative/submit",{dealId:t.id}),onSuccess:()=>{m.success("Post submitted"),o.invalidateQueries({queryKey:["deal",t.id]})},onError:d=>{m.error(N(d,"Unable to submit post"))}});if(r)return e.jsxs(g,{title:"Send post",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Waiting for advertiser to complete this step."}),i?e.jsx("div",{className:"rounded-lg border border-border/60 bg-background/50 p-3 text-xs text-foreground",children:"Creative submitted."}):e.jsx("p",{className:"text-xs text-muted-foreground",children:"No creative submitted yet."})]});const u=()=>{if(s?.onOpenBot){s.onOpenBot();return}R(n)},l=()=>{if(s?.onConfirmSent){s.onConfirmSent();return}a.mutate()};return e.jsxs(g,{title:"Send post",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Send your creative to the PostgramX bot so the publisher can review it. Include any required links or assets."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:u,className:"rounded-lg bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground transition hover:bg-primary/90",children:"Open bot"}),e.jsx("button",{type:"button",onClick:l,disabled:a.isPending,className:x("rounded-lg border border-border/60 px-4 py-2 text-xs font-semibold text-foreground",a.isPending&&"cursor-not-allowed opacity-60"),children:"I sent the post"})]}),i?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Creative submitted. Waiting for review."}):null]})}function le({deal:t,readonly:r,onAction:s}){const o=v(),n=t.creativeText,i=E({mutationFn:async()=>j("/deals/creative/confirm",{dealId:t.id}),onSuccess:()=>{m.success("Creative confirmed"),o.invalidateQueries({queryKey:["deal",t.id]})},onError:d=>{m.error(N(d,"Unable to confirm creative"))}}),a=E({mutationFn:async()=>j("/deals/creative/reject",{dealId:t.id}),onSuccess:()=>{m.success("Requested changes"),o.invalidateQueries({queryKey:["deal",t.id]})},onError:d=>{m.error(N(d,"Unable to request changes"))}});if(r)return e.jsxs(g,{title:"Confirm post",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Waiting for advertiser to complete this step."}),n?e.jsx("div",{className:"rounded-lg border border-border/60 bg-background/50 p-3 text-xs text-foreground",children:n}):e.jsx("div",{className:"rounded-lg border border-dashed border-border/60 bg-background/40 p-3 text-xs text-muted-foreground",children:"Waiting for creative submission."})]});const u=()=>{if(s?.onConfirm){s.onConfirm();return}i.mutate()},l=()=>{if(s?.onRequestChanges){s.onRequestChanges();return}a.mutate()};return e.jsxs(g,{title:"Confirm post",children:[n?e.jsx("div",{className:"rounded-lg border border-border/60 bg-background/50 p-3 text-xs text-foreground",children:n}):e.jsx("div",{className:"rounded-lg border border-dashed border-border/60 bg-background/40 p-3 text-xs text-muted-foreground",children:"Waiting for creative submission."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:u,disabled:!n||i.isPending,className:x("rounded-lg bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground transition",!n||i.isPending?"cursor-not-allowed opacity-60":"hover:bg-primary/90"),children:"Confirm"}),e.jsx("button",{type:"button",onClick:l,disabled:!n||a.isPending,className:x("rounded-lg border border-border/60 px-4 py-2 text-xs font-semibold text-foreground",!n||a.isPending?"cursor-not-allowed opacity-60":"hover:border-primary/40"),children:"Request changes"})]})]})}function ce({deal:t,readonly:r,onAction:s}){const o=v(),n=E({mutationFn:async()=>j("/deals/creative/approve",{dealId:t.id}),onSuccess:()=>{m.success("Approved"),o.invalidateQueries({queryKey:["deal",t.id]})},onError:p=>{m.error(N(p,"Unable to approve"))}}),i=E({mutationFn:async()=>j("/deals/creative/edits",{dealId:t.id}),onSuccess:()=>{m.success("Requested changes"),o.invalidateQueries({queryKey:["deal",t.id]})},onError:p=>{m.error(N(p,"Unable to request changes"))}}),a=E({mutationFn:async()=>j("/deals/creative/reject",{dealId:t.id}),onSuccess:()=>{m.success("Rejected"),o.invalidateQueries({queryKey:["deal",t.id]})},onError:p=>{m.error(N(p,"Unable to reject"))}});if(r)return e.jsx(g,{title:"Admin review",children:e.jsx("p",{className:"text-xs text-muted-foreground",children:"Waiting for admin review."})});const u=()=>{if(s?.onApprove){s.onApprove();return}n.mutate()},l=()=>{if(s?.onRequestChanges){s.onRequestChanges();return}i.mutate()},d=()=>{if(s?.onReject){s.onReject();return}a.mutate()};return e.jsxs(g,{title:"Admin review",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Review the submitted creative and decide whether to approve, request changes, or reject."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:u,disabled:n.isPending,className:x("rounded-lg bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground",n.isPending&&"cursor-not-allowed opacity-60"),children:"Approve"}),e.jsx("button",{type:"button",onClick:l,disabled:i.isPending,className:x("rounded-lg border border-border/60 px-4 py-2 text-xs font-semibold text-foreground",i.isPending&&"cursor-not-allowed opacity-60"),children:"Request changes"}),e.jsx("button",{type:"button",onClick:d,disabled:a.isPending,className:x("rounded-lg border border-border/60 px-4 py-2 text-xs font-semibold text-foreground",a.isPending&&"cursor-not-allowed opacity-60"),children:"Reject"})]})]})}const T=[1,2,24],ue=t=>{if(!t)return null;const r=new Date(t).getTime();if(Number.isNaN(r))return null;const s=Math.max(0,r-Date.now()),o=Math.floor(s/36e5),n=Math.floor(s%36e5/6e4);return`${o}h ${n}m`};function me({deal:t,readonly:r,onAction:s}){const o=v(),[n,i]=b.useState(T[0]),a=E({mutationFn:async()=>j("/deals/payment-window",{dealId:t.id,hours:n}),onSuccess:()=>{m.success("Payment window updated"),o.invalidateQueries({queryKey:["deal",t.id]})},onError:d=>{m.error(N(d,"Unable to set payment window"))}}),u=b.useMemo(()=>ue(t.escrowExpiresAt),[t.escrowExpiresAt]),l=()=>{if(s?.onSetWindow){s.onSetWindow(n);return}a.mutate()};return e.jsxs(g,{title:"Payment window",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Choose how long the advertiser has to complete payment once approved."}),e.jsx("div",{className:"flex flex-wrap gap-2",children:T.map(d=>e.jsxs("button",{type:"button",onClick:()=>i(d),disabled:r,className:x("rounded-full border px-3 py-1 text-xs font-semibold",d===n?"border-primary/50 bg-primary/15 text-primary-foreground":"border-border/60 bg-background/50 text-muted-foreground",r&&"cursor-not-allowed opacity-60"),children:[d,"h"]},d))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:l,disabled:r||a.isPending,className:x("rounded-lg bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground transition",r||a.isPending?"cursor-not-allowed opacity-60":"hover:bg-primary/90"),children:"Set window"}),u?e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Expires in ",u]}):null]})]})}const xe=t=>{try{const r=BigInt(t),s=r/1000000000n,o=r%1000000000n;if(o===0n)return s.toString();const n=o.toString().padStart(9,"0").slice(0,2);return`${s.toString()}.${n}`}catch{return t}};function ge({deal:t,readonly:r,onAction:s}){const[o,n]=b.useState(!1),i=()=>{if(!r){if(s?.onPay){s.onPay();return}n(!0),setTimeout(()=>n(!1),1200)}};return e.jsxs(g,{title:"Payment",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Confirm payment to lock funds in escrow."}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"rounded-full bg-secondary/60 px-3 py-1 text-xs font-semibold text-foreground",children:["Amount: ",xe(t.listing.priceNano)," TON"]}),e.jsx("span",{className:"rounded-full border border-border/60 bg-background/50 px-3 py-1 text-xs font-semibold text-muted-foreground",children:"Wallet via TonConnect"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsx("button",{type:"button",disabled:r||o,onClick:i,className:x("rounded-lg bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground transition",r||o?"cursor-not-allowed opacity-60":"hover:bg-primary/90"),children:o?"Sending...":"Pay"})})]})}function pe({onAction:t,isRefreshing:r}){return e.jsxs(g,{title:"Payment pending",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Payment is being confirmed on-chain. We will update this screen automatically."}),e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsx("button",{type:"button",onClick:t?.onRefresh,disabled:r||!t?.onRefresh,className:x("rounded-lg border border-border/60 px-4 py-2 text-xs font-semibold text-foreground",r||!t?.onRefresh?"cursor-not-allowed opacity-60":"hover:border-primary/40"),children:r?"Refreshing...":"Refresh"})})]})}const fe=t=>{if(!t)return"Not scheduled yet";const r=new Date(t);return Number.isNaN(r.getTime())?t:r.toLocaleString(void 0,{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})};function A({deal:t}){return e.jsxs(g,{title:"Scheduled",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Scheduled time: ",e.jsx("span",{className:"font-semibold text-foreground",children:fe(t.scheduledAt)})]}),t.scheduledAt?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Waiting for the post to go live."}):e.jsx("p",{className:"text-xs text-muted-foreground",children:"No schedule selected yet. Switch back to the schedule step to pick a time."})]})}function he({deal:t}){const r=()=>{t.postUrl&&R(t.postUrl)};return e.jsxs(g,{title:"Verifying post",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"The post has been published. We are verifying it remains visible for the required duration."}),t.postUrl?e.jsx("button",{type:"button",onClick:r,className:x("rounded-lg border border-border/60 px-4 py-2 text-xs font-semibold text-foreground","hover:border-primary/40"),children:"Open post"}):e.jsx("p",{className:"text-xs text-muted-foreground",children:"Post link will appear once available."})]})}const _=t=>{if(!t)return"-";const r=new Date(t);return Number.isNaN(r.getTime())?t:r.toLocaleString(void 0,{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})};function D({deal:t}){return e.jsxs(g,{title:"Deal complete",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Status: ",e.jsx("span",{className:"font-semibold text-foreground",children:se(t.escrowStatus)})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Last update: ",e.jsx("span",{className:"font-semibold text-foreground",children:_(t.lastActivityAt)})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Created: ",e.jsx("span",{className:"font-semibold text-foreground",children:_(t.createdAt)})]})]})}function Te(){const{dealId:t}=F(),r=W(),s=v(),o=r.state?.deal,n=t?s.getQueryData(["deal",t]):void 0,i=o?.id===t?o:n,{data:a,isLoading:u,error:l,refetch:d,isFetching:p}=I({queryKey:["deal",t],queryFn:async()=>{if(!t)throw new Error("Missing deal id");return G(t)},enabled:!!t,initialData:i,refetchInterval:y=>y&&["PAYMENT_AWAITING","FUNDS_PENDING","POSTED_VERIFYING"].includes(y.escrowStatus)?5e3:!1}),h=I({queryKey:["deals","list","detail-fallback",t],queryFn:()=>H({role:"all",pendingLimit:20,activeLimit:20,completedLimit:20}),enabled:!!t&&!a,staleTime:2e4}),O=b.useMemo(()=>!h.data||!t?null:[...h.data.pending.items,...h.data.active.items,...h.data.completed.items].find(C=>C.id===t)??null,[t,h.data]),c=a??O;b.useEffect(()=>{(l||h.error)&&m.error(N(l??h.error,"Unable to load deal"))},[l,h.error]);const M=c?w(c.escrowStatus):"SCHEDULE",L=c?te(c.escrowStatus):[],k=b.useMemo(()=>{if(!c)return null;const y=c.userRoleInDeal==="advertiser",C=c.userRoleInDeal==="publisher"||c.userRoleInDeal==="publisher_manager",f=!y;return{SCHEDULING_PENDING:e.jsx(ae,{deal:c,readonly:!y}),CREATIVE_AWAITING_SUBMIT:e.jsx(de,{deal:c,readonly:!y}),CREATIVE_AWAITING_CONFIRM:e.jsx(le,{deal:c,readonly:!y}),ADMIN_REVIEW:e.jsx(ce,{deal:c,readonly:!C}),PAYMENT_WINDOW_PENDING:e.jsx(me,{deal:c,readonly:f}),PAYMENT_AWAITING:e.jsx(ge,{deal:c,readonly:f}),FUNDS_PENDING:e.jsx(pe,{deal:c,readonly:f,onAction:f?void 0:{onRefresh:()=>d()},isRefreshing:p}),FUNDS_CONFIRMED:e.jsx(A,{deal:c,readonly:f}),APPROVED_SCHEDULED:e.jsx(A,{deal:c,readonly:f}),POSTED_VERIFYING:e.jsx(he,{deal:c,readonly:f}),COMPLETED:e.jsx(D,{deal:c,readonly:f}),CANCELED:e.jsx(D,{deal:c,readonly:f}),REFUNDED:e.jsx(D,{deal:c,readonly:f}),DISPUTED:e.jsx(D,{deal:c,readonly:f})}[c.escrowStatus]},[p,d,c]);return e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx($,{className:"py-6 space-y-4",children:u?e.jsx(V,{items:3}):l||h.error||!c?e.jsx(Y,{message:N(l??h.error,"Deal not found"),description:"We couldn't load this deal right now.",onRetry:()=>d()}):e.jsxs(e.Fragment,{children:[e.jsx(z,{deal:c}),e.jsx(oe,{stages:L,selectedStage:M,escrowStatus:c.escrowStatus}),k]})})})}export{Te as default};
