import{c as C,r as l,j as e,u as R,e as q,f as G,g as H}from"./index-CNlQVYbv.js";import{E as Q}from"./ErrorState-C_OkNGrk.js";import{L as w}from"./LoadingSkeleton-BMXRuOCs.js";import{g as U}from"./errors-3kY4UU5q.js";import{a as F}from"./use-deals-BtNGKGyj.js";import"./skeleton-j0tNNSnh.js";import"./useQuery-BD1DWeuI.js";import"./useMutation-Ch9KhK4u.js";import"./dealsApi-D-HHdXjd.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]],k=C("megaphone",V);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]],D=C("shopping-cart",Y),O=t=>{try{const r=BigInt(t),i=r/1000000000n,o=r%1000000000n;if(o===0n)return i.toString();const c=o.toString().padStart(9,"0").slice(0,2);return`${i.toString()}.${c}`}catch{return t}},L=t=>{if(!t)return"-";const r=new Date(t);return Number.isNaN(r.getTime())?t:r.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})},W={advertiser:"You are advertiser",publisher:"You are publisher",publisher_manager:"You manage this channel"},J={advertiser:"bg-primary/10 text-primary",publisher:"bg-emerald-500/10 text-emerald-400",publisher_manager:"bg-emerald-500/10 text-emerald-400"},S=t=>t.replace(/_/g," "),K=({deal:t,onSelect:r})=>e.jsxs("button",{type:"button",onClick:()=>r(t),className:"w-full rounded-2xl border border-border/60 bg-card/80 p-4 text-left shadow-sm transition hover:border-primary/40 hover:bg-card",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center overflow-hidden rounded-full bg-secondary/60 text-lg font-semibold text-muted-foreground",children:t.channel.avatarUrl?e.jsx("img",{src:t.channel.avatarUrl,alt:t.channel.name,className:"h-full w-full object-cover"}):t.channel.name.slice(0,1)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:[e.jsx("span",{children:t.channel.name}),t.channel.verified?e.jsx("span",{className:"inline-flex items-center rounded-full bg-primary/15 px-2 py-0.5 text-[10px] font-semibold text-primary",children:"Verified"}):null]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",t.channel.username]})]})]}),e.jsxs("div",{className:"mt-4 grid gap-3 text-sm text-muted-foreground sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Price"}),e.jsxs("p",{className:"text-base font-semibold text-foreground",children:[O(t.listing.priceNano)," TON"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Format"}),e.jsx("p",{className:"text-sm font-semibold text-foreground",children:t.listing.format})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Placement"}),e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:["Pinned ",t.listing.placementHours,"h"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Lifetime"}),e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:["Visible ",t.listing.lifetimeHours,"h"]})]})]}),t.listing.tags.length>0?e.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:t.listing.tags.map(i=>e.jsxs("span",{className:"rounded-full bg-secondary/60 px-3 py-1 text-xs font-medium text-foreground",children:["#",i]},i))}):null,e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[e.jsx("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${J[t.userRoleInDeal]}`,children:W[t.userRoleInDeal]}),e.jsx("span",{className:"rounded-full bg-primary/10 px-3 py-1 text-xs font-semibold text-primary",children:S(t.status)}),e.jsx("span",{className:"rounded-full bg-foreground/5 px-3 py-1 text-xs font-semibold text-foreground",children:S(t.escrowStatus)})]}),e.jsxs("div",{className:"mt-4 grid gap-2 text-xs text-muted-foreground sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-foreground",children:"Created:"})," ",L(t.createdAt)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-foreground",children:"Scheduled:"})," ",L(t.scheduledAt)]})]})]}),M=l.memo(K),g=5,b=()=>({items:[],page:1,limit:g,total:0}),j=(t,r)=>{if(r.page<=1)return{...r,items:r.items};const i=new Set(t.items.map(c=>c.id)),o=[...t.items];return r.items.forEach(c=>{i.has(c.id)||o.push(c)}),{...r,items:o}},P={pending:"Pending",active:"Active",completed:"Completed"};function le(){const t=R(),r=q(),i=G(),o=r.state?.activeTab,[c,N]=l.useState(o??"pending"),[u,E]=l.useState({pending:1,active:1,completed:1}),[I,T]=l.useState({pending:b(),active:b(),completed:b()}),A=l.useMemo(()=>({role:"all",pendingPage:u.pending,pendingLimit:g,activePage:u.active,activeLimit:g,completedPage:u.completed,completedLimit:g}),[u]),{data:n,isLoading:y,isFetching:m,error:h,refetch:B}=F(A);l.useEffect(()=>{if(!n)return;[...n.pending.items,...n.active.items,...n.completed.items].forEach(a=>{i.setQueryData(["dealById",a.id],a)}),T(a=>({pending:n.pending.page===a.pending.page&&n.pending.total===a.pending.total&&n.pending.items.length===a.pending.items.length?a.pending:j(a.pending,n.pending),active:n.active.page===a.active.page&&n.active.total===a.active.total&&n.active.items.length===a.active.items.length?a.active:j(a.active,n.active),completed:n.completed.page===a.completed.page&&n.completed.total===a.completed.total&&n.completed.items.length===a.completed.items.length?a.completed:j(a.completed,n.completed)}))},[n]),l.useEffect(()=>{o&&N(o)},[o]),l.useEffect(()=>{const s=H();!s?.MainButton?.showProgress||!s.MainButton.hideProgress||(m?s.MainButton.showProgress(!0):s.MainButton.hideProgress())},[m]);const _=l.useCallback(s=>{E(a=>({...a,[s]:a[s]+1}))},[]),v=l.useCallback(s=>{i.setQueryData(["dealById",s.id],s),t(`/deals/${s.id}`,{state:{deal:s,rootBackTo:"/deals"}})},[t,i]),d=I[c],{buyerDeals:x,sellerDeals:p}=l.useMemo(()=>{const s=d.items.filter(f=>f.userRoleInDeal==="advertiser"),a=d.items.filter(f=>f.userRoleInDeal!=="advertiser");return{buyerDeals:s,sellerDeals:a}},[d.items]),$=d.items.length<d.total,z=!y&&!h&&x.length===0&&p.length===0&&!m;return e.jsxs("div",{className:"w-full max-w-3xl mx-auto",children:[e.jsxs("div",{className:"px-4 pt-6",children:[e.jsx("h1",{className:"text-lg font-semibold text-foreground",children:"Deals"}),e.jsx("div",{className:"mt-4 flex gap-6 border-b border-border/60",children:Object.keys(P).map(s=>e.jsx("button",{type:"button",onClick:()=>N(s),className:`pb-3 text-sm font-semibold transition-colors ${c===s?"border-b-2 border-primary text-primary":"text-muted-foreground"}`,children:P[s]},s))})]}),e.jsx("div",{className:"px-4 py-6 space-y-4",children:y&&d.items.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:[e.jsx(D,{size:14}),"Buying ads",e.jsx("span",{className:"text-[11px] font-normal",children:"路"}),e.jsx("span",{className:"text-[11px] font-normal",children:"--"})]}),e.jsx(w,{items:2})]}),e.jsx("div",{className:"border-t border-border/60"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:[e.jsx(k,{size:14}),"Selling ads",e.jsx("span",{className:"text-[11px] font-normal",children:"路"}),e.jsx("span",{className:"text-[11px] font-normal",children:"--"})]}),e.jsx(w,{items:2})]})]}):h?e.jsx(Q,{message:U(h,"Unable to load deals"),description:"Please try again in a moment.",onRetry:()=>B()}):z?e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-8 text-center",children:[e.jsx("h2",{className:"text-base font-semibold text-foreground",children:"No deals in this section"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Deals in this section will appear here once they are created."})]}):e.jsxs("div",{className:"space-y-5",children:[x.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:[e.jsx(D,{size:14}),"Buying ads",e.jsx("span",{className:"text-[11px] font-normal",children:"路"}),e.jsx("span",{className:"text-[11px] font-normal",children:x.length})]}),e.jsx("div",{className:"space-y-3",children:x.map(s=>e.jsx(M,{deal:s,onSelect:v},s.id))})]}):null,x.length>0&&p.length>0?e.jsx("div",{className:"border-t border-border/60"}):null,p.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:[e.jsx(k,{size:14}),"Selling ads",e.jsx("span",{className:"text-[11px] font-normal",children:"路"}),e.jsx("span",{className:"text-[11px] font-normal",children:p.length})]}),e.jsx("div",{className:"space-y-3",children:p.map(s=>e.jsx(M,{deal:s,onSelect:v},s.id))})]}):null,$?e.jsx("button",{type:"button",onClick:()=>_(c),disabled:m,className:"w-full rounded-xl border border-border/60 bg-background px-4 py-2 text-sm font-semibold text-foreground transition hover:bg-secondary/40 disabled:opacity-60",children:m?"Loading...":"Load more"}):null]})})]})}export{le as default};
