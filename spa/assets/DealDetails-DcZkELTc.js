import{j as e,h as C,a as I,b as P,f as k,r as f,u as F}from"./index-gsGCTaQ6.js";import{u as R,E as $}from"./ErrorState-OFiSxt5I.js";import{f as V}from"./dealsApi-Dwc_0XoF.js";import{L as M}from"./LoadingSkeleton-CvXfI40b.js";import{g as y}from"./errors-3kY4UU5q.js";import{f as q,n as H}from"./ton-ClBVV2oW.js";import"./skeleton-BhXiUYeb.js";const Q={primary:"bg-primary/20 text-primary",warning:"bg-yellow-500/20 text-yellow-300",info:"bg-sky-500/15 text-sky-200",success:"bg-emerald-500/20 text-emerald-300",neutral:"bg-muted text-muted-foreground",danger:"bg-rose-500/20 text-rose-300"};function W({label:s,tone:r,className:n}){return e.jsx("span",{className:C("inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold",Q[r],n),children:s})}function Y({status:s,tone:r,title:n,username:d,verified:u,price:o,dealId:c,avatarUrl:a,statusDescription:g}){return e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-secondary/60 text-xl",children:a?a.startsWith("http")?e.jsx("img",{src:a,alt:n,className:"h-full w-full rounded-full object-cover"}):a:n.slice(0,1)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:[e.jsx("span",{children:n}),u?e.jsx("span",{className:"inline-flex h-4 w-4 items-center justify-center rounded-full bg-primary/20 text-[10px] text-primary",children:"✓"}):null]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",d]})]}),e.jsxs("div",{className:"text-right text-xs text-muted-foreground",children:[e.jsx("p",{className:"font-semibold text-foreground",children:o}),e.jsx("p",{children:c})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx(W,{label:s,tone:r}),e.jsx("p",{className:"text-xs text-muted-foreground",children:g})]})]})}function x({title:s,children:r}){return e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("p",{className:"text-sm font-semibold text-foreground",children:s})}),e.jsx("div",{className:"mt-3 space-y-2 text-xs text-muted-foreground",children:r})]})}function _({items:s}){return e.jsxs("div",{className:"rounded-2xl border border-border/50 bg-card/80 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Timeline"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.length," steps"]})]}),e.jsx("div",{className:"mt-3 grid grid-cols-2 gap-2 sm:grid-cols-3 lg:grid-cols-1",children:s.map(r=>e.jsxs("div",{className:`flex items-center gap-2 rounded-xl border px-2.5 py-2 text-xs ${r.state==="completed"?"border-emerald-500/40 bg-emerald-500/10 text-emerald-100":r.state==="current"?"border-primary/50 bg-primary/10 text-primary-foreground":"border-border/60 bg-background/40 text-muted-foreground"}`,children:[e.jsx("div",{className:`flex h-5 w-5 items-center justify-center rounded-full text-[10px] font-semibold ${r.state==="completed"?"bg-emerald-500/80 text-emerald-950":r.state==="current"?"bg-primary/80 text-primary-foreground":"border border-border/70 text-muted-foreground"}`,children:r.state==="completed"?"✓":r.state==="current"?"•":""}),e.jsx("p",{className:"text-xs font-medium",children:r.label})]},r.label))})]})}const B=s=>{if(!s)return"Waiting for scheduling";const r=new Date(s);return`${r.toLocaleDateString("en-US",{month:"short",day:"numeric"})} · ${r.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`},h=s=>{if(!s)return"-";const r=new Date(s);return Number.isNaN(r.getTime())?s:r.toLocaleString(void 0,{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})};function Z(){const{dealId:s}=I(),r=P(),n=k(),d=r.state?.deal,u=s?n.getQueryData(["dealById",s]):void 0,o=d?.id===s?d:u,c=!!s&&!o,{data:a,isLoading:g,error:i,refetch:v}=R({queryKey:["deals","list","detail-fallback",s],queryFn:()=>V({role:"all",pendingLimit:20,activeLimit:20,completedLimit:20}),enabled:c,staleTime:2e4});f.useEffect(()=>{i&&F.error(y(i,"Unable to load deals"))},[i]);const D=f.useMemo(()=>!a||!s?null:[...a.pending.items,...a.active.items,...a.completed.items].find(m=>m.id===s)??null,[s,a]),t=o??D??null,w=c&&g,b=t?.status?t.status.replace(/_/g," "):"",p=t?.escrowStatus?t.escrowStatus.replace(/_/g," "):"",L=(()=>{if(!t)return"neutral";switch(t.status){case"COMPLETED":return"success";case"CANCELED":return"danger";case"ACTIVE":return"primary";case"PENDING":default:return"warning"}})(),E=f.useMemo(()=>{if(!t)return[];const l=t.status==="CANCELED"?["Pending","Active","Canceled"]:["Pending","Active","Completed"],m=t.status==="PENDING"?0:t.status==="ACTIVE"?1:2;return l.map((T,N)=>({label:T,state:N<m?"completed":N===m?"current":"upcoming"}))},[t]),j=t?`${q(H(t.listing.priceNano))} TON`:"--",S=t?t.userRoleInDeal==="advertiser"?"You are advertiser":t.userRoleInDeal==="publisher"?"You are publisher":"You manage this channel":"",A=t?t.initiatorSide==="ADVERTISER"?"Advertiser initiated":"Publisher initiated":"";return e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx("div",{className:"px-4 py-6 space-y-4",children:w?e.jsx(M,{items:3}):i||!t?e.jsx($,{message:y(i,"Deal not found"),description:"We couldn't load this deal right now.",onRetry:()=>v()}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-4 lg:grid-cols-[minmax(0,1fr)_240px] lg:items-start",children:[e.jsx(Y,{status:b||"Deal",tone:L,title:t.channel.name,username:t.channel.username,verified:t.channel.verified,price:j,dealId:t.id,avatarUrl:t.channel.avatarUrl??void 0,statusDescription:p?`Escrow: ${p}`:"Escrow status pending"}),e.jsx(_,{items:E})]}),e.jsxs(x,{title:"Status",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs font-semibold text-foreground",children:[e.jsx("span",{className:"rounded-full bg-foreground/5 px-3 py-1",children:b}),e.jsx("span",{className:"rounded-full bg-primary/10 px-3 py-1 text-primary",children:p})]}),e.jsxs("p",{className:"mt-2 text-xs text-muted-foreground",children:["Created ",h(t.createdAt)," · Last activity"," ",h(t.lastActivityAt)]})]}),e.jsxs(x,{title:"Listing",children:[e.jsxs("div",{className:"grid gap-2 text-sm text-foreground sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Price"}),e.jsx("p",{className:"font-semibold",children:j})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Format"}),e.jsx("p",{className:"font-semibold",children:t.listing.format})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Placement"}),e.jsxs("p",{className:"font-semibold",children:["Pinned ",t.listing.placementHours,"h"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Visibility"}),e.jsxs("p",{className:"font-semibold",children:["Visible ",t.listing.lifetimeHours,"h"]})]})]}),t.listing.tags.length>0?e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:t.listing.tags.map(l=>e.jsxs("span",{className:"rounded-full bg-secondary/60 px-3 py-1 text-xs font-medium text-foreground",children:["#",l]},l))}):null]}),e.jsxs(x,{title:"Participants",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:S}),e.jsx("p",{className:"text-xs text-muted-foreground",children:A})]}),e.jsxs(x,{title:"Schedule",children:[e.jsx("p",{className:"text-sm text-foreground",children:B(t.scheduledAt)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Last activity ",h(t.lastActivityAt)]})]})]})})})}export{Z as default};
