import{l as E,m as O,n as T,c as v,j as e,X as I,f as _,r as i,a as z,d as N,L as $,o as B}from"./index-khrU9Nrc.js";import{Q,u as K,g as y,E as G}from"./errors-Da30d63E.js";import{p as Y,u as q}from"./channelsApi-Do2GJKyS.js";import{R as X,P as Z,O as H,C as J,T as W,a as ee}from"./index-Bok7lzRO.js";import{S as l}from"./skeleton-BguXjPrY.js";import{P as te}from"./plus-C1X_TnL6.js";var se=class extends Q{constructor(t,n){super(t,n)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(t){super.setOptions({...t,behavior:E()})}getOptimisticResult(t){return t.behavior=E(),super.getOptimisticResult(t)}fetchNextPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"backward"}}})}createResult(t,n){const{state:r}=t,a=super.createResult(t,n),{isFetching:o,isRefetching:u,isError:c,isRefetchError:x}=a,d=r.fetchMeta?.fetchMore?.direction,b=c&&d==="forward",h=o&&d==="forward",p=c&&d==="backward",f=o&&d==="backward";return{...a,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:T(n,r.data),hasPreviousPage:O(n,r.data),isFetchNextPageError:b,isFetchingNextPage:h,isFetchPreviousPageError:p,isFetchingPreviousPage:f,isRefetchError:x&&!b&&!p,isRefetching:u&&!h&&!f}}};function re(t,n){return K(t,se)}/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ae=v("badge-check",ne);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],ie=v("shield",oe);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]],le=v("users-round",de),ce={DRAFT:{label:"Draft",className:"bg-muted/40 text-muted-foreground border-border/60"},PENDING_VERIFY:{label:"Pending verification",className:"bg-yellow-500/20 text-yellow-300 border-yellow-500/40"},VERIFIED:{label:"Verified",className:"bg-emerald-500/15 text-emerald-300 border-emerald-500/30",icon:e.jsx(ae,{size:12,className:"text-emerald-300"})},FAILED:{label:"Verification failed",className:"bg-red-500/20 text-red-300 border-red-500/40"},REVOKED:{label:"Revoked",className:"bg-orange-500/20 text-orange-300 border-orange-500/40"}},R=t=>t==null?"‚Äì":t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString(),xe=t=>t||"Untitled channel",me=({channel:t,onClick:n,onVerify:r,onUnlink:a})=>{const o=ce[t.status],u=t.status==="PENDING_VERIFY"&&r,c=!!a;return e.jsxs("button",{type:"button",onClick:n,className:"block w-full rounded-2xl border border-border/50 bg-card/80 p-4 text-left shadow-sm transition hover:border-border/80 hover:bg-card",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:xe(t.title)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",t.username]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[c?e.jsx("button",{type:"button",onClick:x=>{x.stopPropagation(),a?.()},className:"rounded-full border border-border/60 bg-background/70 p-1.5 text-muted-foreground transition hover:text-foreground","aria-label":"Unlink channel",children:e.jsx(I,{size:14})}):null,e.jsxs("span",{className:_("inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[11px] font-medium",o.className),children:[o.icon,o.label]})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"rounded-xl bg-muted/30 p-3",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(le,{size:12}),"Members"]}),e.jsx("p",{className:"mt-1 text-sm font-semibold text-foreground",children:R(t.memberCount)})]}),e.jsxs("div",{className:"rounded-xl bg-muted/30 p-3",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(ie,{size:12}),"Avg. Views"]}),e.jsx("p",{className:"mt-1 text-sm font-semibold text-foreground",children:R(t.avgViews)})]}),e.jsxs("div",{className:"rounded-xl bg-muted/30 p-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Role"}),e.jsx("p",{className:"mt-1 text-sm font-semibold text-foreground",children:t.membership.telegramAdminStatus})]})]}),e.jsx("div",{className:"mt-4 flex items-center justify-between text-xs text-muted-foreground",children:e.jsx("div",{className:"flex items-center gap-2",children:u?e.jsx("button",{type:"button",onClick:x=>{x.stopPropagation(),r()},className:"rounded-full border border-yellow-500/40 bg-yellow-500/15 px-2 py-0.5 text-[11px] font-semibold text-yellow-200 transition hover:bg-yellow-500/25",children:"Verify"}):null})})]})},ue=t=>["channelsList",t],he=(t,n=10)=>re({queryKey:ue(t),queryFn:({pageParam:r=1})=>Y({...t,page:Number(r),limit:n}),getNextPageParam:r=>r.hasNext?r.page+1:void 0,initialPageParam:1});function fe({open:t,onOpenChange:n,title:r,children:a}){return e.jsx(X,{open:t,onOpenChange:n,children:e.jsxs(Z,{children:[e.jsx(H,{className:"fixed inset-0 z-40 bg-black/60"}),e.jsxs(J,{className:"fixed inset-x-0 bottom-0 z-50 rounded-t-3xl border border-border/60 bg-card p-4 pb-[calc(var(--tg-content-safe-area-inset-bottom)+16px)] shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between pb-2",children:[e.jsx(W,{className:"text-sm font-semibold text-foreground",children:r}),e.jsx(ee,{className:"rounded-full p-2 text-muted-foreground hover:text-foreground",children:e.jsx(I,{size:16})})]}),e.jsx("div",{className:"pt-2",children:a})]})]})})}const ge="recent",be="desc",pe=["DRAFT","PENDING_VERIFY","FAILED","REVOKED"],Ne=()=>e.jsxs("div",{className:"rounded-2xl border border-border/50 bg-card/80 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"h-4 w-32"}),e.jsx(l,{className:"h-3 w-20"})]}),e.jsx(l,{className:"h-5 w-24 rounded-full"})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-2",children:[e.jsx(l,{className:"h-16 rounded-xl"}),e.jsx(l,{className:"h-16 rounded-xl"}),e.jsx(l,{className:"h-16 rounded-xl"})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsx(l,{className:"h-3 w-24"}),e.jsx(l,{className:"h-3 w-20"})]})]});function Ce(){const[t,n]=i.useState("verified"),[r,a]=i.useState(null),[o,u]=i.useState(!1),[c,x]=i.useState(()=>new Set),d=z(),b=i.useMemo(()=>({sort:ge,order:be}),[]),{data:h,isLoading:p,isFetchingNextPage:f,fetchNextPage:k,hasNextPage:F,refetch:M,error:g}=he(b,10),P=i.useMemo(()=>h?.pages.flatMap(s=>s.items)??[],[h]),m=i.useMemo(()=>P.filter(s=>!c.has(s.id)),[P,c]),S=h?.pages?.[0]?.total??0;i.useEffect(()=>{g&&N.error(y(g,"Unable to load channels."))},[g]);const D=i.useMemo(()=>m.filter(s=>s.status==="VERIFIED"),[m]),A=i.useMemo(()=>m.filter(s=>pe.includes(s.status)),[m]),w=t==="verified"?D:A,L=t==="pending"?"No pending channels right now.":"No verified channels yet.",U=s=>{if(s.status==="PENDING_VERIFY"){d(`/channels/pending/${s.id}`,{state:{channel:s}});return}d(`/channel-manage/${s.id}/overview`,{state:{channel:s}})},V=async()=>{if(r){u(!0);try{const s=await q({channelId:r.id});s.unlinked?(x(j=>{const C=new Set(j);return C.add(s.channelId),C}),N.success("Channel unlinked.")):N.error("Unable to unlink channel."),a(null)}catch(s){N.error(y(s,"Unable to unlink channel."))}finally{u(!1)}}};return e.jsxs("div",{className:"mx-auto flex w-full max-w-2xl flex-col gap-6 px-4 pb-16 pt-4",children:[p?e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((s,j)=>e.jsx(Ne,{},`channel-skeleton-${j}`))}):g?e.jsx(G,{message:y(g,"Unable to load channels"),description:"Please try again in a moment.",onRetry:()=>M()}):m.length===0?e.jsxs("div",{className:"rounded-2xl border border-dashed border-border/60 bg-card/70 p-8 text-center",children:[e.jsx("div",{className:"mx-auto mb-3 flex h-14 w-14 items-center justify-center rounded-full bg-primary/10 text-2xl",children:"üì°"}),e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"No channels yet"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Connect your first Telegram channel to get started."}),e.jsx($,{to:"/add-channel/step-1",className:"mt-4 inline-flex items-center justify-center rounded-full bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground",children:"Add Channel"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"border-t border-border/50",children:e.jsx("div",{className:"flex gap-6 bg-background/90 backdrop-blur-glass",children:["verified","pending"].map(s=>e.jsxs("button",{onClick:()=>n(s),className:`py-3 text-sm font-medium border-b-2 transition-colors ${t===s?"text-primary border-b-primary":"text-muted-foreground border-b-transparent"}`,children:[s.charAt(0).toUpperCase()+s.slice(1)," "]},s))})}),w.length>0?e.jsx("div",{className:"space-y-3",children:w.map(s=>e.jsx(me,{channel:s,onClick:()=>U(s),onVerify:()=>d(`/channels/pending/${s.id}`,{state:{channel:s}}),onUnlink:t==="pending"?()=>{a(s)}:void 0},s.id))}):e.jsx("p",{className:"rounded-xl border border-dashed border-border/60 bg-card/70 px-4 py-3 text-xs text-muted-foreground",children:L})]}),m.length>0?e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Showing ",m.length," of ",S]}),F?e.jsxs("button",{type:"button",onClick:()=>k(),disabled:f,className:"inline-flex items-center gap-2 rounded-full border border-border/60 bg-card/80 px-4 py-2 text-xs font-semibold text-foreground transition hover:bg-card",children:[f?e.jsx(B,{size:14,className:"animate-spin"}):null,f?"Loading":"Load more"]}):null]}):null,e.jsx("button",{type:"button",onClick:()=>d("/add-channel/step-1"),className:"fixed bottom-[calc(var(--tg-content-safe-area-inset-bottom)+120px)] right-4 z-40 flex h-12 w-12 items-center justify-center rounded-full bg-primary text-primary-foreground shadow-lg shadow-primary/30 transition hover:bg-primary/90","aria-label":"Add channel",children:e.jsx(te,{size:18})}),e.jsxs(fe,{open:!!r,onOpenChange:s=>{s||a(null)},title:"–û—Ç–∫—Ä–µ–ø–∏—Ç—å –∫–∞–Ω–∞–ª?",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["–í—ã —Ö–æ—Ç–∏—Ç–µ –æ—Ç–∫—Ä–µ–ø–∏—Ç—å –∫–∞–Ω–∞–ª"," ",e.jsxs("span",{className:"font-semibold text-foreground",children:["@",r?.username]}),"?"]}),e.jsxs("div",{className:"mt-4 flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>a(null),className:"flex-1 rounded-full border border-border/60 bg-background px-4 py-2 text-sm font-semibold text-foreground",disabled:o,children:"–û—Ç–º–µ–Ω–∞"}),e.jsx("button",{type:"button",onClick:V,className:"flex-1 rounded-full bg-red-500 px-4 py-2 text-sm font-semibold text-white transition hover:bg-red-600 disabled:cursor-not-allowed disabled:opacity-70",disabled:o,children:o?"–û—Ç–∫—Ä–µ–ø–ª—è–µ–º...":"–û—Ç–∫—Ä–µ–ø–∏—Ç—å"})]})]})]})}export{Ce as default};
