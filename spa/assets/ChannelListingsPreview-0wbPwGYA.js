import{c as R,a as j,r as b,j as e,h as v,e as _,E as H,R as B}from"./index-DlDxQsQy.js";import{a as y,f as M}from"./formatters-CG109iVp.js";import{b as V,c as q,h as P,f as z,g as F,a as U}from"./labels-EEWNt0UM.js";import{g as w}from"./tagOptions-DHtvjoWf.js";import{C as G}from"./chevron-down-BoQ5C1rB.js";import{u as K}from"./useQuery-Cn0tRff1.js";import{l as O}from"./listingsApi-CLtGxVxv.js";import{S as N}from"./skeleton-BigKY-_w.js";import{g as W}from"./errors-3kY4UU5q.js";import{R as Q}from"./refresh-ccw-DzJotPdu.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],J=R("pencil-line",X),E=3,C=s=>{const r=s.map(t=>t.trim()).filter(Boolean),d=Array.from(new Set(r));return{visible:d.slice(0,E),hiddenCount:Math.max(d.length-E,0)}},Y=({listings:s})=>{const{t:r,language:d}=j();return s.length===0?e.jsx("div",{className:"rounded-xl border border-dashed border-border/60 bg-background/50 px-4 py-4 text-center text-xs text-muted-foreground",children:r("marketplace.emptyPlacements")}):e.jsx("div",{className:"space-y-3",children:s.map(t=>{const o=C(t.tags??[]),l=[t.allowEdits?V(r,!0):null,t.allowLinkTracking?q(r,!0):null].filter(Boolean),n=y(t.priceNano,d)??t.priceNano,a=t.pinDurationHours?`${r("listings.meta.pinned")} ${P(t.pinDurationHours,r)}`:r("listings.meta.notPinned"),i=`${r("listings.meta.visible")} ${P(t.visibilityDurationHours,r)}`,u=t.contentRulesText?.trim();return e.jsxs("div",{className:"rounded-xl border border-border/60 bg-card/80 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-sm font-semibold text-foreground",children:[n," ",r("common.ton")]}),e.jsx("span",{className:"rounded-full border border-border/60 bg-muted/40 px-2 py-0.5 text-[10px] font-semibold text-muted-foreground",children:z(r,t.format)})]}),e.jsxs("div",{className:"mt-2 text-[11px] text-muted-foreground",children:[a," • ",i]}),l.length>0?e.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-[11px] text-muted-foreground",children:l.map(c=>e.jsx("span",{className:"rounded-full border border-border/60 bg-muted/30 px-2 py-0.5",children:c},c))}):null,o.visible.length>0?e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-[11px] text-muted-foreground",children:[o.visible.map(c=>e.jsx("span",{className:"rounded-full border border-border/60 bg-card px-2 py-0.5 text-foreground",children:w(c,r)},`${t.id}-${c}`)),o.hiddenCount>0?e.jsxs("span",{className:"rounded-full border border-border/60 bg-card px-2 py-0.5",children:["+",o.hiddenCount]}):null]}):null,u?e.jsx("p",{className:"mt-2 line-clamp-2 text-[11px] text-muted-foreground",children:u}):null]},t.id)})})};function xe({channel:s,onClick:r,actions:d,isExpanded:t,onToggleExpand:o,expandedContent:l}){const{t:n,language:a}=j(),[i,u]=b.useState(!1),[c,x]=b.useState(!1),m=t??i,g=!!(o||l||s.listingsPreview),f=b.useMemo(()=>s.minPriceNano?y(s.minPriceNano,a):null,[s.minPriceNano,a]),h=C(s.tags??[]),L=s.username?`@${s.username.replace(/^@/,"")}`:null,A=s.name?.[0]?.toUpperCase()??n("common.avatarFallback"),k=!c&&s.avatarUrl?s.avatarUrl:null,D=s.placementsCount!=null?s.placementsCount.toString():n("common.emptyValue"),S=typeof s.subscribers=="number"?M(s.subscribers,a):n("common.emptyValue"),I=p=>{p.stopPropagation(),o?o():u($=>!$)};return e.jsxs("div",{className:v("w-full rounded-2xl border border-border/50 bg-card/80 p-4 text-left shadow-sm transition",r&&"cursor-pointer hover:border-border/80 hover:bg-card"),role:r?"button":void 0,tabIndex:r?0:void 0,onClick:r,onKeyDown:p=>{r&&(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),r())},children:[e.jsxs("div",{className:"flex items-start gap-3",children:[k?e.jsx("img",{src:k,alt:s.name,className:"h-12 w-12 rounded-full object-cover",onError:()=>x(!0)}):e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-primary/30 via-secondary/50 to-secondary text-lg text-foreground",children:A}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:s.name}),L?e.jsx("span",{className:"text-xs text-muted-foreground",children:L}):null]}),e.jsxs("div",{className:"flex items-center gap-2",children:[d,g?e.jsx("button",{type:"button",onClick:I,"aria-expanded":m,className:"inline-flex h-8 w-8 items-center justify-center rounded-lg border border-border/60 bg-secondary/40 text-muted-foreground transition hover:text-foreground",children:e.jsx(G,{size:16,className:v("transition-transform duration-200",m&&"rotate-180")})}):null]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[D," ",n("marketplace.placements")]}),e.jsx("span",{children:"·"}),e.jsxs("span",{children:[S," ",n("marketplace.subscribers")]})]}),e.jsx("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:e.jsxs("span",{children:[n("common.from")," ",e.jsxs("span",{className:"font-semibold text-primary",children:[f??n("common.emptyValue")," ",n("common.ton")]})]})}),h.visible.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px] text-muted-foreground",children:[h.visible.map(p=>e.jsx("span",{className:"rounded-full border border-border/60 bg-card px-2.5 py-1 text-foreground",children:w(p,n)},`${s.id}-${p}`)),h.hiddenCount>0?e.jsxs("span",{className:"rounded-full border border-border/60 bg-card px-2.5 py-1 text-muted-foreground",children:["+",h.hiddenCount]}):null]}):null]})]}),g?e.jsx("div",{className:v("overflow-hidden transition-all duration-300",m?"mt-4 max-h-[1200px] opacity-100":"max-h-0 opacity-0"),children:e.jsx("div",{className:"rounded-2xl border border-border/60 bg-background/60 p-3",children:l||e.jsx(Y,{listings:s.listingsPreview??[]})})}):null]})}const Z=5,ee=3,re=s=>{const r=s.slice(0,2),d=s.length-r.length;return{shown:r,remaining:d}},T=b.memo(({channelId:s,listing:r,rootBackTo:d,mode:t})=>{const{t:o,language:l}=j(),n=r.pinDurationHours?F(o,r.pinDurationHours):o("listings.meta.notPinned"),a=U(o,r.visibilityDurationHours),i=re(r.tags??[]),u=r.isActive===!1;return e.jsxs("div",{className:v("flex items-center gap-3 py-3",t==="owner"&&u&&"opacity-60"),children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"text-sm font-semibold text-foreground",children:[y(r.priceNano,l)," ",o("common.ton")]}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:[n," • ",a]}),i.shown.length>0?e.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[i.shown.map(c=>e.jsx("span",{className:"rounded-full border border-border/60 bg-muted/30 px-2 py-0.5 text-[10px] text-muted-foreground",children:w(c,o)},c)),i.remaining>0?e.jsxs("span",{className:"rounded-full border border-border/60 bg-muted/30 px-2 py-0.5 text-[10px] text-muted-foreground",children:["+",i.remaining]}):null]}):null]}),t==="owner"?e.jsx(H,{to:B.CHANNEL_MANAGE_LISTINGS_EDIT(s,r.id),state:d?{rootBackTo:d}:void 0,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-border/60 bg-background text-muted-foreground transition hover:text-foreground","aria-label":o("listings.editAction"),children:e.jsx(J,{size:14})}):null]})});T.displayName="ListingPreviewRow";const se=b.memo(({channelId:s,isExpanded:r,onSummaryChange:d,mode:t="owner"})=>{const o=_(),{t:l}=j(),n=o.state?.rootBackTo,a=K({queryKey:["channelListingsPreview",s],queryFn:()=>O({channelId:s,page:1,limit:Z,onlyActive:!0,sort:"recent"}),enabled:r,staleTime:1e3*60*5}),i=a.data?.items??[],u=a.data?.total??i.length;b.useEffect(()=>{if(!a.data)return;const x=i.reduce((m,g)=>{try{const f=BigInt(g.priceNano);return m===null||f<m?f:m}catch{return m}},null);d?.({placementsCount:u,minPriceNano:x?x.toString():null})},[i,d,a.data,u]);const c=b.useMemo(()=>i.slice(0,ee),[i]);return e.jsx("div",{className:"space-y-3",children:a.isLoading?e.jsx("div",{className:"space-y-2",children:Array.from({length:2}).map((x,m)=>e.jsxs("div",{className:"rounded-xl border border-border/50 bg-background/60 px-3 py-3",children:[e.jsx(N,{className:"h-4 w-24"}),e.jsx(N,{className:"mt-2 h-3 w-40"}),e.jsx(N,{className:"mt-2 h-3 w-28"})]},`listing-skeleton-${m}`))}):a.isError?e.jsxs("div",{className:"rounded-xl border border-border/60 bg-red-500/5 px-4 py-3 text-xs text-red-200",children:[e.jsx("p",{children:W(a.error,l("marketplace.listingsLoadFailed"))}),e.jsxs("button",{type:"button",onClick:()=>a.refetch(),className:"mt-2 inline-flex items-center gap-2 rounded-lg border border-red-500/40 bg-red-500/10 px-3 py-1 text-[11px] font-semibold text-red-200",children:[e.jsx(Q,{size:12}),l("common.retry")]})]}):c.length>0?e.jsx("div",{className:"rounded-xl border border-border/60 bg-background/60 px-3 divide-y divide-border/40",children:c.map(x=>e.jsx(T,{channelId:s,listing:x,rootBackTo:n,mode:t},x.id))}):e.jsxs("div",{className:"rounded-xl border border-dashed border-border/60 bg-background/50 px-4 py-4 text-center",children:[e.jsx("p",{className:"text-xs font-semibold text-foreground",children:l("channels.emptyListingsTitle")}),e.jsx("p",{className:"mt-1 text-[11px] text-muted-foreground",children:l("channels.emptyListingsSubtitle")})]})})});se.displayName="ChannelListingsPreview";export{xe as C,se as a};
