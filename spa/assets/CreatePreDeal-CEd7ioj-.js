import{b as x,u as p,r as d,j as e,a as l}from"./index-DznSTR-0.js";import{u as h}from"./useMutation-yBuAOlfa.js";import{p as f}from"./predealsApi-v383Rh2U.js";import{E as g}from"./ErrorState-BS490bnf.js";import{P as i}from"./PageContainer-DGqX0_6Q.js";import{g as b}from"./errors-3kY4UU5q.js";const N=r=>{const s=new Date(r);return Number.isNaN(s.getTime())?null:s.toISOString()};function C(){const{listingId:r}=x(),s=p(),[a,u]=d.useState(""),o=h({mutationFn:f,onSuccess:t=>{s(`/deals/predeal/${t.id}`)},onError:t=>{l.error(b(t,"Unable to create pre-deal"))}}),n=d.useMemo(()=>a?N(a):null,[a]),c=d.useMemo(()=>n?new Date(n).getTime()>Date.now():!1,[n]),m=async()=>{if(r){if(!n){l.error("Please select a valid date and time.");return}if(!c){l.error("Scheduled time must be in the future.");return}o.mutate({listingId:r,scheduledAt:n})}};return r?e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsxs(i,{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground",children:"Schedule ad post"}),e.jsx("h1",{className:"text-xl font-semibold text-foreground",children:"Choose when the post should be published"})]}),e.jsx("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-4 space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-semibold text-foreground",children:"Scheduled date & time"}),e.jsx("input",{type:"datetime-local",value:a,onChange:t=>u(t.target.value),className:"w-full rounded-lg border border-border/60 bg-background px-3 py-2 text-sm text-foreground"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"We will remind the channel owner at the scheduled time."})]})}),e.jsx("button",{type:"button",onClick:m,disabled:!a||o.isPending,className:"w-full rounded-lg bg-primary px-4 py-3 text-sm font-semibold text-primary-foreground transition disabled:opacity-60",children:o.isPending?"Scheduling...":"Continue"})]})}):e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx(i,{className:"py-6",children:e.jsx(g,{message:"Listing not selected",description:"Please return to the marketplace and select a listing to continue.",onRetry:()=>s("/marketplace")})})})}export{C as default};
