import{u as g,e as b,r as i,g as h,j as e,R as j}from"./index-hL3AzeaV.js";import{u as y}from"./use-deals-CTFFoudr.js";import{E as N}from"./ErrorState-CWOptztJ.js";import{S as v}from"./ScheduleDatePicker-CSpa0Yxc.js";import{P as c}from"./PageContainer-Cm-a9C2U.js";import{t as S}from"./date-DTgQQEB1.js";import"./useQuery-84lU0rAQ.js";import"./useMutation-D8gLmmlu.js";import"./dealsApi-COpTXnfA.js";import"./button-BUfQU0W0.js";import"./chevron-left-BfQy29tv.js";import"./input-DG6tBJtM.js";import"./Combination-BTwFOyC8.js";import"./index-DhSgTxf3.js";function K(){const u=g(),s=b().state?.listingId,[d,m]=i.useState(""),[t,x]=i.useState(null),l=y(),o=l.isPending,n=!t||t.getTime()>Date.now()+3600*1e3,p=!!s&&!o&&n,a=i.useMemo(()=>{if(t)try{return S(t)}catch{return}},[t]);i.useEffect(()=>{const r=h();!r?.MainButton?.showProgress||!r.MainButton.hideProgress||(o?r.MainButton.showProgress(!0):r.MainButton.hideProgress())},[o]);const f=async()=>{if(s&&n)try{if(a&&!a.endsWith("Z"))throw console.error("Scheduled date must be UTC ISO:",a),new Error("Invalid datetime format");await l.mutateAsync({listingId:s,brief:d.trim()||void 0,scheduledAt:a})}catch{return}};return s?e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsxs(c,{className:"py-6 space-y-4",children:[e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Listing"}),e.jsx("p",{className:"mt-1 text-sm font-semibold text-foreground",children:s}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ready to create a deal"})]}),e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-semibold text-foreground",children:"Brief (optional)"}),e.jsx("textarea",{value:d,onChange:r=>m(r.target.value),placeholder:"Describe your product, key message, and desired tone.",className:"min-h-[120px] w-full rounded-xl border border-border/60 bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-primary/30"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-semibold text-foreground",children:"Schedule datetime (optional)"}),e.jsx("div",{className:"pb-safe-bottom rounded-2xl border border-border/60 bg-card/80 p-3",children:e.jsx(v,{value:t,onChange:x})}),!n&&e.jsx("p",{className:"text-xs text-destructive",children:"Scheduled time must be at least 1 hour from now."})]})]}),e.jsx("button",{type:"button",onClick:f,disabled:!p,className:"w-full rounded-lg bg-primary px-4 py-3 text-sm font-semibold text-primary-foreground disabled:opacity-60",children:o?"Creating deal...":"Create deal"})]})}):e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx(c,{className:"py-6",children:e.jsx(N,{message:"Listing not selected",description:"Please return to the marketplace and select a listing to continue.",onRetry:()=>u(j.MARKETPLACE)})})})}export{K as default};
