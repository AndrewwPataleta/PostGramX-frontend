import{j as e,b as I,d as P,e as T,r as p,a as k}from"./index-DznSTR-0.js";import{u as F}from"./useQuery-DJlT6xZy.js";import{f as R}from"./dealsApi-B0veKOsV.js";import{L as $}from"./LoadingSkeleton-Z9N-si3N.js";import{E as V}from"./ErrorState-BS490bnf.js";import{P as M}from"./PageContainer-DGqX0_6Q.js";import{g as N}from"./errors-3kY4UU5q.js";import{f as q,n as H}from"./ton-ClBVV2oW.js";import"./skeleton-C4og3_zg.js";function Q({status:s,tone:r,title:n,username:o,price:u,dealId:x,avatarUrl:a,statusDescription:i}){return e.jsx("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-secondary/60 text-xl",children:a?a.startsWith("http")?e.jsx("img",{src:a,alt:n,className:"h-full w-full rounded-full object-cover"}):a:n.slice(0,1)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:e.jsx("span",{children:n})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",o]})]}),e.jsx("div",{className:"text-right text-xs text-muted-foreground",children:e.jsx("p",{className:"font-semibold text-foreground",children:u})})]})})}function m({title:s,children:r}){return e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("p",{className:"text-sm font-semibold text-foreground",children:s})}),e.jsx("div",{className:"mt-3 space-y-2 text-xs text-muted-foreground",children:r})]})}function W({items:s}){return e.jsxs("div",{className:"rounded-2xl border border-border/50 bg-card/80 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Timeline"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.length," steps"]})]}),e.jsx("div",{className:"mt-3 grid grid-cols-2 gap-2 sm:grid-cols-3 lg:grid-cols-1",children:s.map(r=>e.jsxs("div",{className:`flex items-center gap-2 rounded-xl border px-2.5 py-2 text-xs ${r.state==="completed"?"border-emerald-500/40 bg-emerald-500/10 text-emerald-100":r.state==="current"?"border-primary/50 bg-primary/10 text-primary-foreground":"border-border/60 bg-background/40 text-muted-foreground"}`,children:[e.jsx("div",{className:`flex h-5 w-5 items-center justify-center rounded-full text-[10px] font-semibold ${r.state==="completed"?"bg-emerald-500/80 text-emerald-950":r.state==="current"?"bg-primary/80 text-primary-foreground":"border border-border/70 text-muted-foreground"}`,children:r.state==="completed"?"✓":r.state==="current"?"•":""}),e.jsx("p",{className:"text-xs font-medium",children:r.label})]},r.label))})]})}const Y=s=>{if(!s)return"Waiting for scheduling";const r=new Date(s);return`${r.toLocaleDateString("en-US",{month:"short",day:"numeric"})} · ${r.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`},f=s=>{if(!s)return"-";const r=new Date(s);return Number.isNaN(r.getTime())?s:r.toLocaleString(void 0,{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})};function Z(){const{dealId:s}=I(),r=P(),n=T(),o=r.state?.deal,u=s?n.getQueryData(["dealById",s]):void 0,x=o?.id===s?o:u,a=!!s&&!x,{data:i,isLoading:y,error:l,refetch:v}=F({queryKey:["deals","list","detail-fallback",s],queryFn:()=>R({role:"all",pendingLimit:20,activeLimit:20,completedLimit:20}),enabled:a,staleTime:2e4});p.useEffect(()=>{l&&k.error(N(l,"Unable to load deals"))},[l]);const D=p.useMemo(()=>!i||!s?null:[...i.pending.items,...i.active.items,...i.completed.items].find(c=>c.id===s)??null,[s,i]),t=x??D??null,w=a&&y,h=t?.status?t.status.replace(/_/g," "):"",g=t?.escrowStatus?t.escrowStatus.replace(/_/g," "):"",L=(()=>{if(!t)return"neutral";switch(t.status){case"COMPLETED":return"success";case"CANCELED":return"danger";case"ACTIVE":return"primary";case"PENDING":default:return"warning"}})(),E=p.useMemo(()=>{if(!t)return[];const d=t.status==="CANCELED"?["Pending","Active","Canceled"]:["Pending","Active","Completed"],c=t.status==="PENDING"?0:t.status==="ACTIVE"?1:2;return d.map((C,b)=>({label:C,state:b<c?"completed":b===c?"current":"upcoming"}))},[t]),j=t?`${q(H(t.listing.priceNano))} TON`:"--",S=t?t.userRoleInDeal==="advertiser"?"You are advertiser":t.userRoleInDeal==="publisher"?"You are publisher":"You manage this channel":"",A=t?t.initiatorSide==="ADVERTISER"?"Advertiser initiated":"Publisher initiated":"";return e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx(M,{className:"py-6 space-y-4",children:w?e.jsx($,{items:3}):l||!t?e.jsx(V,{message:N(l,"Deal not found"),description:"We couldn't load this deal right now.",onRetry:()=>v()}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-4 lg:grid-cols-[minmax(0,1fr)_240px] lg:items-start",children:[e.jsx(Q,{status:h||"Deal",tone:L,title:t.channel.name,username:t.channel.username,price:j,dealId:t.id,avatarUrl:t.channel.avatarUrl??void 0,statusDescription:g?`Escrow: ${g}`:"Escrow status pending"}),e.jsx(W,{items:E})]}),e.jsxs(m,{title:"Status",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs font-semibold text-foreground",children:[e.jsx("span",{className:"rounded-full bg-foreground/5 px-3 py-1",children:h}),e.jsx("span",{className:"rounded-full bg-primary/10 px-3 py-1 text-primary",children:g})]}),e.jsxs("p",{className:"mt-2 text-xs text-muted-foreground",children:["Created ",f(t.createdAt)," · Last activity"," ",f(t.lastActivityAt)]})]}),e.jsxs(m,{title:"Listing",children:[e.jsxs("div",{className:"grid gap-2 text-sm text-foreground sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Price"}),e.jsx("p",{className:"font-semibold",children:j})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Format"}),e.jsx("p",{className:"font-semibold",children:t.listing.format})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Placement"}),e.jsxs("p",{className:"font-semibold",children:["Pinned ",t.listing.placementHours,"h"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Visibility"}),e.jsxs("p",{className:"font-semibold",children:["Visible ",t.listing.lifetimeHours,"h"]})]})]}),t.listing.tags.length>0?e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:t.listing.tags.map(d=>e.jsxs("span",{className:"rounded-full bg-secondary/60 px-3 py-1 text-xs font-medium text-foreground",children:["#",d]},d))}):null]}),e.jsxs(m,{title:"Participants",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:S}),e.jsx("p",{className:"text-xs text-muted-foreground",children:A})]}),e.jsxs(m,{title:"Schedule",children:[e.jsx("p",{className:"text-sm text-foreground",children:Y(t.scheduledAt)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Last activity ",f(t.lastActivityAt)]})]})]})})})}export{Z as default};
