import{r as i,j as e,a as M,b as T,g as C}from"./index-CUXtzWzq.js";import{E as A,g as I}from"./errors-FjOkXebu.js";import{L as B}from"./LoadingSkeleton-DxwaaTw3.js";import{a as $}from"./use-deals-B2kYXj88.js";import"./skeleton-BQV2oYLP.js";import"./useQuery-GNtWry-E.js";import"./useMutation-BH6Tq1UL.js";const G=t=>{try{const n=BigInt(t),a=n/1000000000n,o=n%1000000000n;if(o===0n)return a.toString();const l=o.toString().padStart(9,"0").slice(0,2);return`${a.toString()}.${l}`}catch{return t}},b=t=>{if(!t)return"-";const n=new Date(t);return Number.isNaN(n.getTime())?t:n.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})},R={advertiser:"You are advertiser",publisher:"You are publisher",publisher_manager:"You manage this channel"},j=t=>t.replace(/_/g," "),U=({deal:t,onSelect:n})=>e.jsxs("button",{type:"button",onClick:()=>n(t.id),className:"w-full rounded-2xl border border-border/60 bg-card/80 p-4 text-left shadow-sm transition hover:border-primary/40 hover:bg-card",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center overflow-hidden rounded-full bg-secondary/60 text-lg font-semibold text-muted-foreground",children:t.channel.avatarUrl?e.jsx("img",{src:t.channel.avatarUrl,alt:t.channel.name,className:"h-full w-full object-cover"}):t.channel.name.slice(0,1)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:[e.jsx("span",{children:t.channel.name}),t.channel.verified?e.jsx("span",{className:"inline-flex items-center rounded-full bg-primary/15 px-2 py-0.5 text-[10px] font-semibold text-primary",children:"Verified"}):null]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",t.channel.username]})]})]}),e.jsxs("div",{className:"mt-4 grid gap-3 text-sm text-muted-foreground sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Price"}),e.jsxs("p",{className:"text-base font-semibold text-foreground",children:[G(t.listing.priceNano)," TON"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Format"}),e.jsx("p",{className:"text-sm font-semibold text-foreground",children:t.listing.format})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Placement"}),e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:["Pinned ",t.listing.placementHours,"h"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Lifetime"}),e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:["Visible ",t.listing.lifetimeHours,"h"]})]})]}),t.listing.tags.length>0?e.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:t.listing.tags.map(a=>e.jsxs("span",{className:"rounded-full bg-secondary/60 px-3 py-1 text-xs font-medium text-foreground",children:["#",a]},a))}):null,e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[e.jsx("span",{className:"rounded-full bg-primary/10 px-3 py-1 text-xs font-semibold text-primary",children:j(t.status)}),e.jsx("span",{className:"rounded-full bg-foreground/5 px-3 py-1 text-xs font-semibold text-foreground",children:j(t.escrowStatus)})]}),e.jsxs("div",{className:"mt-4 grid gap-2 text-xs text-muted-foreground sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-foreground",children:"Created:"})," ",b(t.createdAt)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-foreground",children:"Scheduled:"})," ",b(t.scheduledAt)]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Role:"})," ",R[t.userRoleInDeal]]})]})]}),F=i.memo(U),x=5,u=()=>({items:[],page:1,limit:x,total:0}),g=(t,n)=>{if(n.page<=1)return{...n,items:n.items};const a=new Set(t.items.map(l=>l.id)),o=[...t.items];return n.items.forEach(l=>{a.has(l.id)||o.push(l)}),{...n,items:o}},N={pending:"Pending",active:"Active",completed:"Completed"};function W(){const t=M(),a=T().state?.activeTab,[o,l]=i.useState(a??"pending"),[m,v]=i.useState({pending:1,active:1,completed:1}),[y,w]=i.useState({pending:u(),active:u(),completed:u()}),L=i.useMemo(()=>({role:"all",pendingPage:m.pending,pendingLimit:x,activePage:m.active,activeLimit:x,completedPage:m.completed,completedLimit:x}),[m]),{data:r,isLoading:h,isFetching:c,error:p,refetch:S}=$(L);i.useEffect(()=>{r&&w(s=>({pending:r.pending.page===s.pending.page&&r.pending.total===s.pending.total&&r.pending.items.length===s.pending.items.length?s.pending:g(s.pending,r.pending),active:r.active.page===s.active.page&&r.active.total===s.active.total&&r.active.items.length===s.active.items.length?s.active:g(s.active,r.active),completed:r.completed.page===s.completed.page&&r.completed.total===s.completed.total&&r.completed.items.length===s.completed.items.length?s.completed:g(s.completed,r.completed)}))},[r]),i.useEffect(()=>{a&&l(a)},[a]),i.useEffect(()=>{const s=C();!s?.MainButton?.showProgress||!s.MainButton.hideProgress||(c?s.MainButton.showProgress(!0):s.MainButton.hideProgress())},[c]);const P=i.useCallback(s=>{v(f=>({...f,[s]:f[s]+1}))},[]),k=i.useCallback(s=>{t(`/deals/${s}`)},[t]),d=y[o],D=d.items.length<d.total,E=!h&&!p&&d.items.length===0&&!c;return e.jsxs("div",{className:"w-full max-w-3xl mx-auto",children:[e.jsxs("div",{className:"px-4 pt-6",children:[e.jsx("h1",{className:"text-lg font-semibold text-foreground",children:"Deals"}),e.jsx("div",{className:"mt-4 flex gap-6 border-b border-border/60",children:Object.keys(N).map(s=>e.jsx("button",{type:"button",onClick:()=>l(s),className:`pb-3 text-sm font-semibold transition-colors ${o===s?"border-b-2 border-primary text-primary":"text-muted-foreground"}`,children:N[s]},s))})]}),e.jsx("div",{className:"px-4 py-6 space-y-4",children:h&&d.items.length===0?e.jsx(B,{items:3}):p?e.jsx(A,{message:I(p,"Unable to load deals"),description:"Please try again in a moment.",onRetry:()=>S()}):E?e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-8 text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-14 w-14 items-center justify-center rounded-full bg-primary/10 text-2xl",children:"ðŸ“­"}),e.jsx("h2",{className:"text-base font-semibold text-foreground",children:"No deals yet"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Deals in this section will appear here once they are created."})]}):e.jsxs("div",{className:"space-y-4",children:[d.items.map(s=>e.jsx(F,{deal:s,onSelect:k},s.id)),D?e.jsx("button",{type:"button",onClick:()=>P(o),disabled:c,className:"w-full rounded-xl border border-border/60 bg-background px-4 py-2 text-sm font-semibold text-foreground transition hover:bg-secondary/40 disabled:opacity-60",children:c?"Loading...":"Load more"}):null]})})]})}export{W as default};
