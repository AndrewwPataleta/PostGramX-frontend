import{c as N,j as e,m as w,d as P,e as k,r as x,b as L,h}from"./index-CY7JS-uu.js";import{u as T}from"./useQuery-DPUkYSXs.js";import{f as M,n as C}from"./ton-ClBVV2oW.js";import{L as S}from"./LoadingSkeleton-DYaUhSxw.js";import{l as $}from"./listingsApi-Dey7XfNA.js";import{g as A}from"./errors-3kY4UU5q.js";import{P as D}from"./plus-B7d6EZHO.js";import"./skeleton-FSO82CAS.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],z=N("square-pen",E),j=t=>t>=168&&t%24===0?`${t/24}d`:`${t}h`;function q({listing:t,variant:d="full",actionSlot:m}){const o=t.tags??[],s=[...new Set([...o.filter(r=>r==="Must be pre-approved"),...o.filter(r=>r!=="Must be pre-approved")])],l=d==="compact"?3:s.length,n=s.slice(0,l),i=Math.max(0,s.length-n.length),c=t.visibilityDurationHours??24,u=t.pinDurationHours?j(t.pinDurationHours):null,p=j(c),g=(()=>{if("priceNano"in t)try{return M(C(t.priceNano))}catch{return t.priceNano}return String(t.priceTon)})();return e.jsxs("div",{className:`rounded-2xl border border-border/60 bg-card/80 p-4 ${d==="compact"?"space-y-3":"space-y-4"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:["Post â€¢ ",g," TON"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:d==="compact"?"Per post":"Per post offer"})]}),e.jsx("span",{className:`rounded-full px-2.5 py-1 text-[11px] font-semibold ${t.isActive?"bg-emerald-500/15 text-emerald-400":"bg-rose-500/15 text-rose-400"}`,children:t.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px]",children:[e.jsx("span",{className:"rounded-full bg-secondary/60 px-2.5 py-1 text-foreground",children:t.allowEdits?"Edits allowed":"No edits"}),e.jsx("span",{className:"rounded-full bg-secondary/60 px-2.5 py-1 text-foreground",children:t.allowLinkTracking?"Tracking allowed":"No tracking"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px] text-foreground",children:[u?e.jsxs("span",{className:"rounded-full bg-secondary/60 px-2.5 py-1",children:["Pinned: ",u]}):e.jsx("span",{className:"rounded-full bg-secondary/60 px-2.5 py-1",children:"Pinned: none"}),e.jsxs("span",{className:"rounded-full bg-secondary/60 px-2.5 py-1",children:["Visible: ",p]})]}),s.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px] text-foreground",children:[n.map(r=>{const f=r==="Must be pre-approved";return e.jsx("span",{className:`rounded-full border px-2.5 py-1 ${f?"border-primary/40 bg-primary/10 text-primary":"border-border/60 bg-card text-foreground"}`,children:r},r)}),i>0?e.jsxs("span",{className:"rounded-full border border-border/60 bg-card px-2.5 py-1 text-muted-foreground",children:["+",i]}):null]}):null,d==="full"&&m?e.jsx("div",{className:"flex gap-2",children:m}):null]})}const R=()=>{const{channel:t}=w(),{id:d}=P(),m=k(),o=d??t.id,s=m.state?.rootBackTo,[l,n]=x.useState(1),[i]=x.useState(10),[c,u]=x.useState(!0),[p,g]=x.useState("recent"),r=T({queryKey:["listingsByChannel",o,{page:l,limit:i,onlyActive:c,sort:p}],queryFn:()=>$({channelId:o,page:l,limit:i,onlyActive:c,sort:p})});x.useEffect(()=>{r.error&&L.error(A(r.error,"Unable to load listings"))},[r.error]);const f=r.data?.items??[],y=r.data?.total??0,b=x.useMemo(()=>Math.max(1,Math.ceil(y/i)),[y,i]),v=f.length>0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex gap-2 rounded-full bg-secondary/40 p-1",children:[e.jsx("button",{type:"button",onClick:()=>{u(!0),n(1)},className:`rounded-full px-3 py-2 text-xs font-semibold transition-colors ${c?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground"}`,children:"Active only"}),e.jsx("button",{type:"button",onClick:()=>{u(!1),n(1)},className:`rounded-full px-3 py-2 text-xs font-semibold transition-colors ${c?"text-muted-foreground hover:text-foreground":"bg-primary text-primary-foreground"}`,children:"All listings"})]}),e.jsxs("select",{value:p,onChange:a=>{g(a.target.value),n(1)},className:"rounded-full border border-border/60 bg-card px-3 py-2 text-xs text-foreground",children:[e.jsx("option",{value:"recent",children:"Most recent"}),e.jsx("option",{value:"price_asc",children:"Price: low to high"}),e.jsx("option",{value:"price_desc",children:"Price: high to low"})]})]}),r.isLoading?e.jsx(S,{items:3}):v?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:f.map(a=>e.jsx(q,{listing:a,variant:"full",actionSlot:e.jsxs(h,{to:`/channel-manage/${o}/listings/${a.id}/edit`,state:s?{rootBackTo:s}:void 0,className:"flex-1 flex items-center justify-center gap-2 bg-secondary hover:bg-secondary/80 text-foreground font-medium py-2 rounded-lg border border-border transition-colors text-sm",children:[e.jsx(z,{size:16}),"Edit"]})},a.id))}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Page ",l," of ",b]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>n(a=>Math.max(1,a-1)),disabled:l===1,className:"rounded-full border border-border/60 px-3 py-1 text-xs disabled:opacity-50",children:"Previous"}),e.jsx("button",{type:"button",onClick:()=>n(a=>Math.min(b,a+1)),disabled:l>=b,className:"rounded-full border border-border/60 px-3 py-1 text-xs disabled:opacity-50",children:"Next"})]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-secondary/30 flex items-center justify-center mx-auto mb-3",children:e.jsx("span",{className:"text-xl",children:"ðŸ“‹"})}),e.jsx("p",{className:"text-foreground font-semibold mb-2",children:"No listings yet"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-6",children:"Create your first listing to start receiving offers"}),e.jsx(h,{to:`/channel-manage/${o}/listings/create`,state:s?{rootBackTo:s}:void 0,className:"inline-flex items-center justify-center rounded-xl bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground",children:"Create listing"})]}),e.jsx(h,{to:`/channel-manage/${o}/listings/create`,state:s?{rootBackTo:s}:void 0,className:"fixed bottom-[calc(var(--tg-content-safe-area-inset-bottom)+120px)] right-4 z-40 flex h-12 w-12 items-center justify-center rounded-full bg-primary text-primary-foreground shadow-lg shadow-primary/30 transition hover:bg-primary/90","aria-label":"Create listing",children:e.jsx(D,{size:18})})]})};export{R as default};
