import{c as v,j as e,m as w,b as k,d as L,r as x,a as P,f as b}from"./index-DHmd0Tb8.js";import{u as T}from"./useQuery-g6gxkg7_.js";import{f as M,n as C}from"./ton-ClBVV2oW.js";import{L as S}from"./LoadingSkeleton-CY0NJUeH.js";import{l as $}from"./listingsApi-BmFm44Jn.js";import{g as A}from"./errors-3kY4UU5q.js";import{P as D}from"./plus-CidD_Xu7.js";import"./skeleton-Bv9AYYPG.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],z=v("square-pen",E),j=t=>t>=168&&t%24===0?`${t/24}d`:`${t}h`;function q({listing:t,variant:d="full",actionSlot:u}){const a=t.tags??[],r=[...new Set([...a.filter(s=>s==="Must be pre-approved"),...a.filter(s=>s!=="Must be pre-approved")])],n=d==="compact"?3:r.length,o=r.slice(0,n),i=Math.max(0,r.length-o.length),c=t.visibilityDurationHours??24,p=t.pinDurationHours?j(t.pinDurationHours):null,m=j(c),y=(()=>{if("priceNano"in t)try{return M(C(t.priceNano))}catch{return t.priceNano}return String(t.priceTon)})();return e.jsxs("div",{className:`rounded-2xl border border-border/60 bg-card/80 p-4 ${d==="compact"?"space-y-3":"space-y-4"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:["Post â€¢ ",y," TON"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:d==="compact"?"Per post":"Per post offer"})]}),e.jsx("span",{className:`rounded-full px-2.5 py-1 text-[11px] font-semibold ${t.isActive?"bg-emerald-500/15 text-emerald-400":"bg-rose-500/15 text-rose-400"}`,children:t.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px]",children:[e.jsx("span",{className:"rounded-full bg-secondary/60 px-2.5 py-1 text-foreground",children:t.allowEdits?"Edits allowed":"No edits"}),e.jsx("span",{className:"rounded-full bg-secondary/60 px-2.5 py-1 text-foreground",children:t.allowLinkTracking?"Tracking allowed":"No tracking"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px] text-foreground",children:[p?e.jsxs("span",{className:"rounded-full bg-secondary/60 px-2.5 py-1",children:["Pinned: ",p]}):e.jsx("span",{className:"rounded-full bg-secondary/60 px-2.5 py-1",children:"Pinned: none"}),e.jsxs("span",{className:"rounded-full bg-secondary/60 px-2.5 py-1",children:["Visible: ",m]})]}),r.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px] text-foreground",children:[o.map(s=>{const g=s==="Must be pre-approved";return e.jsx("span",{className:`rounded-full border px-2.5 py-1 ${g?"border-primary/40 bg-primary/10 text-primary":"border-border/60 bg-card text-foreground"}`,children:s},s)}),i>0?e.jsxs("span",{className:"rounded-full border border-border/60 bg-card px-2.5 py-1 text-muted-foreground",children:["+",i]}):null]}):null,d==="full"&&u?e.jsx("div",{className:"flex gap-2",children:u}):null]})}const R=()=>{const{channel:t}=w(),{id:d}=k(),u=L(),a=d??t.id,r=u.state?.rootBackTo,[n,o]=x.useState(1),[i]=x.useState(10),[c,p]=x.useState(!0),[m,y]=x.useState("recent"),s=T({queryKey:["listingsByChannel",a,{page:n,limit:i,onlyActive:c,sort:m}],queryFn:()=>$({channelId:a,page:n,limit:i,onlyActive:c,sort:m})});x.useEffect(()=>{s.error&&P.error(A(s.error,"Unable to load listings"))},[s.error]);const g=s.data?.items??[],h=s.data?.total??0,f=x.useMemo(()=>Math.max(1,Math.ceil(h/i)),[h,i]),N=g.length>0;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-wrap items-center justify-between gap-3",children:e.jsxs("div",{className:"flex gap-2 rounded-lg bg-secondary/40 p-1",children:[e.jsx("button",{type:"button",onClick:()=>{p(!0),o(1)},className:`rounded-lg px-3 py-2 text-xs font-semibold transition-colors ${c?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground"}`,children:"Active only"}),e.jsx("button",{type:"button",onClick:()=>{p(!1),o(1)},className:`rounded-lg px-3 py-2 text-xs font-semibold transition-colors ${c?"text-muted-foreground hover:text-foreground":"bg-primary text-primary-foreground"}`,children:"All listings"})]})}),s.isLoading?e.jsx(S,{items:3}):N?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:g.map(l=>e.jsx(q,{listing:l,variant:"full",actionSlot:e.jsxs(b,{to:`/channel-manage/${a}/listings/${l.id}/edit`,state:r?{rootBackTo:r}:void 0,className:"flex-1 flex items-center justify-center gap-2 bg-secondary hover:bg-secondary/80 text-foreground font-medium py-2 rounded-lg border border-border transition-colors text-sm",children:[e.jsx(z,{size:16}),"Edit"]})},l.id))}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Page ",n," of ",f]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>o(l=>Math.max(1,l-1)),disabled:n===1,className:"rounded-lg border border-border/60 px-3 py-1 text-xs disabled:opacity-50",children:"Previous"}),e.jsx("button",{type:"button",onClick:()=>o(l=>Math.min(f,l+1)),disabled:n>=f,className:"rounded-lg border border-border/60 px-3 py-1 text-xs disabled:opacity-50",children:"Next"})]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-secondary/30 flex items-center justify-center mx-auto mb-3",children:e.jsx("span",{className:"text-xl",children:"ðŸ“‹"})}),e.jsx("p",{className:"text-foreground font-semibold mb-2",children:"No listings yet"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-6",children:"Create your first listing to start receiving offers"}),e.jsx(b,{to:`/channel-manage/${a}/listings/create`,state:r?{rootBackTo:r}:void 0,className:"inline-flex items-center justify-center rounded-lg bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground",children:"Create listing"})]}),e.jsx(b,{to:`/channel-manage/${a}/listings/create`,state:r?{rootBackTo:r}:void 0,className:"fixed bottom-[calc(var(--tg-content-safe-area-inset-bottom)+120px)] right-4 z-40 flex h-12 w-12 items-center justify-center rounded-2xl bg-primary text-primary-foreground shadow-lg shadow-primary/30 transition hover:bg-primary/90","aria-label":"Create listing",children:e.jsx(D,{size:18})})]})};export{R as default};
