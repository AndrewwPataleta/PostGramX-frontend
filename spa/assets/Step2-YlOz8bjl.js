import{j as e,h as A,a9 as I,u as S,a as U,r as b,b as l,L as M}from"./index-C_Plwl7D.js";import{u as v}from"./useMutation-B_NBooLI.js";import{A as F,a as V,b as B}from"./avatar-D5RVgaR_.js";import{B as j}from"./button-D-21_Gzp.js";import{C as N,a as y}from"./card-CLgZ2zpT.js";import{l as P,v as R}from"./channelsApi-BrAHnYqp.js";import{g as C}from"./errorMapping-DMqPqVoJ.js";import{u as z}from"./useAddChannelFlow-CbltDk8S.js";import{f as D}from"./formatters-B6oyEeL1.js";const K=I("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function O({className:t,variant:s,...m}){return e.jsx("div",{className:A(K({variant:s}),t),...m})}const T=(t,s)=>t==null?null:D(t,s,{notation:"compact"}),W=t=>{const s=String(t.status??"").toUpperCase();return["VERIFIED","SUCCESS","OK"].includes(s)},_=()=>{const t=S(),{t:s,language:m}=U(),{state:c,setLinkedChannelId:k,setLinkStatus:d,setVerifyStatus:i,setLastError:o}=z(),a=c.preview;b.useEffect(()=>{a||t("/add-channel/step-1",{replace:!0})},[t,a]);const E=b.useMemo(()=>a?.username?a.username.startsWith("@")?a.username:`@${a.username}`:s("common.emptyValue"),[a?.username,s]),p=v({mutationFn:n=>P({username:n}),onMutate:()=>{d("loading"),o(null)},onSuccess:n=>{const r=n.channelId??n.id;if(!r){const g=s("channels.add.step2.missingLinkId");d("error"),o(g),l.error(g);return}d("success"),k(r),i("idle"),l.success(s("channels.add.step2.linkedToast")),u.mutate(r)},onError:n=>{const r=C(n);d("error"),o(r),l.error(r)}}),u=v({mutationFn:n=>R({id:n}),onMutate:()=>{i("loading"),o(null)},onSuccess:n=>{if(W(n)){i("success"),o(null),t("/add-channel/step-3");return}const r=typeof n.error=="string"?n.error:n.error?.message||s("channels.add.step2.verifyError");i("error"),o(r),l.error(r)},onError:n=>{const r=C(n);i("error"),o(r),l.error(r)}}),L=()=>{if(!a)return;const n=(a.normalizedUsername||a.username||"").replace(/^@/,"");if(!c.linkedChannelId){if(!n){l.error(s("channels.add.step2.missingUsername"));return}p.mutate(n);return}u.mutate(c.linkedChannelId)},x=p.isPending||u.isPending,f=!!c.linkedChannelId,w=s(f?"channels.add.step2.verifyAction":"channels.add.step2.connectAction"),h=T(a?.memberCount,m);return a?e.jsxs("div",{className:"flex flex-1 flex-col gap-4",children:[e.jsx(N,{className:"border-border/60 bg-card/80 shadow-sm",children:e.jsxs(y,{className:"space-y-4 p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(F,{className:"h-12 w-12",children:[a.photoUrl||a.avatarUrl?e.jsx(V,{src:a.photoUrl??a.avatarUrl??""}):null,e.jsx(B,{className:"bg-secondary text-sm font-semibold text-foreground",children:(a.title||s("common.avatarFallback")).charAt(0)})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-sm font-semibold text-foreground",children:a.title}),e.jsx("p",{className:"text-xs text-muted-foreground",children:E})]}),e.jsx(O,{variant:"secondary",className:"text-[10px] uppercase",children:s(f?"channels.add.step2.linkedStatus":"channels.add.step2.notLinked")})]}),h?e.jsx("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:e.jsxs("span",{children:[h," ",s("marketplace.subscribers")]})}):null]})}),e.jsx(N,{className:"border-border/60 bg-card/80 shadow-sm",children:e.jsxs(y,{className:"space-y-3 p-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:s("channels.add.step2.title")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s("channels.add.step2.subtitle")})]}),e.jsxs("ol",{className:"space-y-2 text-xs text-muted-foreground",children:[e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-foreground",children:"1."}),s("channels.add.step2.instructions.1")]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-foreground",children:"2."}),s("channels.add.step2.instructions.2")]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-foreground",children:"3."}),s("channels.add.step2.instructions.3")]})]})]})}),e.jsxs("div",{className:"mt-auto flex flex-col gap-3",children:[e.jsx(j,{onClick:L,disabled:x,className:"w-full text-sm font-semibold",children:x?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4 animate-spin"}),s(f?"channels.add.step2.verifying":"channels.add.step2.connecting")]}):w}),e.jsx(j,{variant:"secondary",onClick:()=>t("/add-channel/step-1"),disabled:x,className:"w-full text-sm font-semibold",children:s("common.back")})]})]}):null};export{_ as default};
