import{c as Q,r as c,u as X,j as e,g as W,a as q,X as O,p as J,b as Y}from"./index-CNlQVYbv.js";import{u as V}from"./useQuery-BD1DWeuI.js";import{l as Z}from"./listingsApi-CpishWiF.js";import{S as M}from"./skeleton-j0tNNSnh.js";import{f as U,n as G}from"./ton-ClBVV2oW.js";import{C as ee}from"./check-CJ-1up9F.js";import{C as A}from"./chevron-down-SzEbv2LZ.js";import{f as re,l as se}from"./tagOptions-DoUmU6u5.js";import{E as te}from"./ErrorState-C_OkNGrk.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],ae=Q("search",ne);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]],le=Q("sliders-horizontal",oe),D="Must be pre-approved",P=3,H=24,ie=5,K=r=>r>=168&&r%24===0?`${r/24}d`:`${r}h`,de=r=>{try{return U(G(r))}catch{return r}},ce=r=>{try{return U(G(r))}catch{return r}},ue=r=>{const a=r.map(l=>l.trim()).filter(l=>l.length>0&&l.length<=H),i=Array.from(new Set(a));return{visible:i.slice(0,P),hiddenCount:Math.max(i.length-P,0)}},xe=r=>{const a=r.map(n=>n.trim()).filter(n=>n.length>0&&n.length<=H),i=a.filter(n=>n.toLowerCase()===D.toLowerCase()),l=a.filter(n=>n.toLowerCase()!==D.toLowerCase()),g=Array.from(new Set([...i,...l]));return{visible:g.slice(0,P),hiddenCount:Math.max(g.length-P,0)}},me=r=>{const a=[...r.allowEdits?["Edits allowed"]:[],...r.allowLinkTracking?["Tracking allowed"]:[],...r.allowPinnedPlacement||r.pinDurationHours!==null?["Pinned available"]:[]];return a.length===0?["Standard placement"]:a},ge=r=>[...r.requiresApproval?["Pre-approval required"]:[],`Pinned: ${r.pinDurationHours?K(r.pinDurationHours):"none"}`,`Visible: ${K(r.visibilityDurationHours)}`];function pe({channel:r}){const[a,i]=c.useState(!1),[l,g]=c.useState(!1),n=X(),o=r.username?.replace(/^@/,""),N=o?`https://t.me/${o}`:null,f=V({queryKey:["marketplaceListingsByChannel",r.id],queryFn:()=>Z({channelId:r.id,page:1,limit:ie,onlyActive:!0,sort:"price_asc"}),enabled:a,staleTime:1e3*60*5,refetchOnMount:!1}),u=f.data?.items??[],C=c.useMemo(()=>ce(r.minPriceNano),[r.minPriceNano]),w=typeof r.subscribers=="number"?`${r.subscribers.toLocaleString()} subscribers`:"— subscribers",T=r.name?.[0]?.toUpperCase()??r.username?.[0]?.toUpperCase(),v=r.username?`@${r.username}`:null,S=!l&&r.avatarUrl?r.avatarUrl:null,R=ue(r.tags??[]);return e.jsxs("div",{className:"rounded-2xl border border-border/50 bg-card/80 p-4 transition-colors hover:border-primary/40 cursor-pointer",role:"button",tabIndex:0,onClick:()=>n(`/channels/${r.id}`,{state:{channel:r,rootBackTo:"/marketplace"}}),onKeyDown:d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),n(`/channels/${r.id}`,{state:{channel:r,rootBackTo:"/marketplace"}}))},children:[e.jsxs("div",{className:"flex items-start gap-3",children:[S?e.jsx("img",{src:S,alt:r.name,className:"h-12 w-12 rounded-full object-cover",onError:()=>g(!0)}):e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-primary/30 via-secondary/50 to-secondary text-lg text-foreground",children:T??"?"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:r.name}),r.verified?e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-primary/20 p-1",children:e.jsx(ee,{size:12,className:"text-primary"})}):null]}),v?e.jsx("span",{className:"text-xs text-muted-foreground",children:v}):null]}),e.jsxs("div",{className:"flex items-center gap-2",children:[N?e.jsx("button",{type:"button",onClick:d=>{d.stopPropagation();const b=W();if(b?.openTelegramLink){b.openTelegramLink(N);return}window.open(N,"_blank","noopener,noreferrer")},className:"rounded-full border border-border/60 bg-secondary/40 px-3 py-1 text-[11px] font-semibold text-primary transition hover:text-primary/90",children:"Open channel"}):null,e.jsx("button",{type:"button",onClick:d=>{d.stopPropagation(),i(b=>!b)},"aria-expanded":a,className:"inline-flex h-8 w-8 items-center justify-center rounded-full border border-border/60 bg-secondary/40 text-muted-foreground transition hover:text-foreground",children:e.jsx(A,{size:16,className:q("transition-transform duration-200",a&&"rotate-180")})})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[r.placementsCount," placements"]}),e.jsx("span",{children:"·"}),e.jsx("span",{children:w})]}),e.jsx("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:e.jsxs("span",{children:["From ",e.jsxs("span",{className:"font-semibold text-primary",children:[C," TON"]})]})}),R.visible.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px] text-muted-foreground",children:[R.visible.map(d=>e.jsx("span",{className:"rounded-full border border-border/60 bg-card px-2.5 py-1 text-foreground",children:d},`${r.id}-${d}`)),R.hiddenCount>0?e.jsxs("span",{className:"rounded-full border border-border/60 bg-card px-2.5 py-1 text-muted-foreground",children:["+",R.hiddenCount]}):null]}):null]})]}),e.jsx("div",{className:q("overflow-hidden transition-all duration-300",a?"mt-4 max-h-[1200px] opacity-100":"max-h-0 opacity-0"),children:e.jsx("div",{className:"rounded-2xl border border-border/60 bg-background/60 p-3",children:f.isLoading?e.jsx("div",{className:"mt-3 space-y-3",children:Array.from({length:2}).map((d,b)=>e.jsxs("div",{className:"rounded-xl border border-border/50 bg-card/80 p-3",children:[e.jsx(M,{className:"h-4 w-24"}),e.jsx(M,{className:"mt-2 h-3 w-40"}),e.jsx(M,{className:"mt-2 h-3 w-28"})]},`listing-skeleton-${r.id}-${b}`))}):f.isError?e.jsx("div",{className:"mt-3 rounded-xl border border-border/60 bg-red-500/5 p-3 text-xs text-red-200",children:"Failed to load placements."}):u.length>0?e.jsx("div",{className:"mt-3 space-y-3",children:u.map(d=>{const b=xe(d.tags??[]),j=me(d),x=ge(d),L=d.contentRulesText?.trim();return e.jsxs("div",{className:"rounded-xl border border-border/60 bg-card/80 p-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[de(d.priceNano)," TON"]}),e.jsx("span",{className:"rounded-full border border-border/60 bg-muted/40 px-2 py-0.5 text-[10px] font-semibold text-muted-foreground",children:d.format}),d.isActive?e.jsx("span",{className:"rounded-full border border-emerald-500/40 bg-emerald-500/15 px-2 py-0.5 text-[10px] font-semibold text-emerald-300",children:"Active"}):null]}),b.visible.length>0?e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-[11px] text-foreground",children:[b.visible.map(y=>e.jsx("span",{className:q("rounded-full border px-2.5 py-1",y.toLowerCase()===D.toLowerCase()?"border-primary/40 bg-primary/10 text-primary":"border-border/60 bg-card text-foreground"),children:y},y)),b.hiddenCount>0?e.jsxs("span",{className:"rounded-full border border-border/60 bg-card px-2.5 py-1 text-muted-foreground",children:["+",b.hiddenCount]}):null]}):null,e.jsxs("div",{className:"mt-3 grid gap-3 text-[11px] text-muted-foreground sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-wide text-muted-foreground/80",children:"Allowed"}),e.jsx("div",{className:"mt-1 space-y-1",children:j.map(y=>e.jsx("p",{children:y},y))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-wide text-muted-foreground/80",children:"Requires"}),e.jsxs("div",{className:"mt-1 space-y-1",children:[x.map(y=>e.jsx("p",{children:y},y)),L?e.jsxs("div",{className:"pt-1",children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-wide text-muted-foreground/70",children:"Requirements"}),e.jsx("p",{className:"truncate text-[11px] text-muted-foreground",children:L})]}):null]})]})]})]},d.id)})}):e.jsx("div",{className:"mt-3 rounded-xl border border-dashed border-border/60 bg-card/60 p-4 text-center text-xs text-muted-foreground",children:"No placements available yet."})})})]})}const be=({filters:r,onRemoveFilter:a})=>r.priceRange[0]>0||r.priceRange[1]<10||r.subscribersRange[0]>0||r.subscribersRange[1]<1e6||r.languages.length>0||r.categories.length>0||r.tags.length>0||r.verifiedOnly?e.jsx("div",{className:"px-4 py-3 bg-secondary/30 border-b border-border/30 space-y-2",children:e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[r.priceRange[0]>0||r.priceRange[1]<10?e.jsxs("button",{onClick:()=>a("priceRange"),className:"inline-flex items-center gap-1.5 bg-primary/20 hover:bg-primary/30 text-primary px-3 py-1.5 rounded-full text-xs font-medium transition-colors",children:["Price: ",r.priceRange[0].toFixed(1),"-",r.priceRange[1].toFixed(1)," TON",e.jsx(O,{size:14})]}):null,r.subscribersRange[0]>0||r.subscribersRange[1]<1e6?e.jsxs("button",{onClick:()=>a("subscribersRange"),className:"inline-flex items-center gap-1.5 bg-accent/20 hover:bg-accent/30 text-accent px-3 py-1.5 rounded-full text-xs font-medium transition-colors",children:["Subs: ",(r.subscribersRange[0]/1e3).toFixed(0),"K-",(r.subscribersRange[1]/1e3).toFixed(0),"K",e.jsx(O,{size:14})]}):null,r.verifiedOnly?e.jsxs("button",{onClick:()=>a("verifiedOnly"),className:"inline-flex items-center gap-1.5 bg-primary/20 hover:bg-primary/30 text-primary px-3 py-1.5 rounded-full text-xs font-medium transition-colors",children:["Verified Only",e.jsx(O,{size:14})]}):null,r.languages.map(l=>e.jsxs("button",{onClick:()=>a("languages",l),className:"inline-flex items-center gap-1.5 bg-primary/20 hover:bg-primary/30 text-primary px-3 py-1.5 rounded-full text-xs font-medium transition-colors",children:[l,e.jsx(O,{size:14})]},l)),r.categories.map(l=>e.jsxs("button",{onClick:()=>a("categories",l),className:"inline-flex items-center gap-1.5 bg-accent/20 hover:bg-accent/30 text-accent px-3 py-1.5 rounded-full text-xs font-medium transition-colors",children:[l,e.jsx(O,{size:14})]},l)),r.tags.map(l=>e.jsxs("button",{onClick:()=>a("tags",l),className:"inline-flex items-center gap-1.5 bg-secondary/70 hover:bg-secondary text-foreground px-3 py-1.5 rounded-full text-xs font-medium transition-colors",children:[l,e.jsx(O,{size:14})]},l))]})}):null,fe=["EN","RU","ES","AR","DE","Other"],he=["Crypto","Finance","Gaming","Tech","Lifestyle","News"],ye=({isOpen:r,onClose:a,filters:i,onApply:l,onReset:g})=>{const[n,o]=c.useState(i),N=(s,t=1)=>new Intl.NumberFormat("en",{maximumFractionDigits:t}).format(s),f=s=>new Intl.NumberFormat("en",{notation:"compact",maximumFractionDigits:1}).format(s),[u,C]=c.useState({pricing:!0,audience:!0,language:!1,category:!1,tags:!1,availability:!1,verification:!1}),[w,T]=c.useState(""),[v,S]=c.useState(""),R=re(se),d=[{label:"Any",range:[0,10]},{label:"0-1 TON",range:[0,1]},{label:"1-5 TON",range:[1,5]},{label:"5-10 TON",range:[5,10]}],b=[{label:"Any",range:[0,1e6]},{label:"0-10K",range:[0,1e4]},{label:"10-100K",range:[1e4,1e5]},{label:"100K-1M",range:[1e5,1e6]}];c.useEffect(()=>{o(i)},[i,r]);const j=s=>{C(t=>({...t,[s]:!t[s]}))},x=(s,t)=>{const m=[...n.priceRange];m[s]=t,o(E=>({...E,priceRange:m}))},L=(s,t)=>{const m=[...n.subscribersRange];m[s]=t,o(E=>({...E,subscribersRange:m}))},y=s=>{o(t=>({...t,languages:t.languages.includes(s)?t.languages.filter(m=>m!==s):[...t.languages,s]}))},z=s=>{o(t=>({...t,categories:t.categories.includes(s)?t.categories.filter(m=>m!==s):[...t.categories,s]}))},I=()=>{l(n),a()},_=()=>{g(),o({priceRange:[0,10],subscribersRange:[0,1e6],languages:[],categories:[],tags:[],verifiedOnly:!1,dateRange:["",""]})};return r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/40 z-40",onClick:a}),e.jsxs("div",{className:"fixed inset-x-0 bottom-0 top-0 bg-card rounded-t-2xl z-50 animate-in slide-in-from-bottom-10 duration-300 flex flex-col h-[100dvh] sm:h-auto sm:top-auto sm:max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-card border-b border-border/50 px-4 py-4 flex items-center justify-between rounded-t-2xl shrink-0",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Filters"}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-secondary rounded-lg transition-colors",children:e.jsx(O,{size:20,className:"text-foreground"})})]}),e.jsxs("div",{className:"px-4 py-4 space-y-4 flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>j("pricing"),className:"w-full flex items-center justify-between p-3 hover:bg-secondary/50 rounded-lg transition-colors",children:[e.jsx("span",{className:"font-semibold text-foreground",children:"Pricing (TON)"}),e.jsx(A,{size:18,className:`text-muted-foreground transition-transform ${u.pricing?"rotate-180":""}`})]}),u.pricing&&e.jsxs("div",{className:"px-3 space-y-3 pb-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:d.map(s=>e.jsx("button",{onClick:()=>o(t=>({...t,priceRange:s.range})),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-all ${n.priceRange[0]===s.range[0]&&n.priceRange[1]===s.range[1]?"bg-primary text-primary-foreground":"bg-secondary text-foreground hover:bg-secondary/80"}`,children:s.label},s.label))}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row",children:[e.jsx("input",{type:"number",value:n.priceRange[0],onChange:s=>x(0,parseFloat(s.target.value)||0),className:"w-full min-w-0 flex-1 bg-input border border-border rounded-lg px-3 py-2 text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/50",placeholder:"Min"}),e.jsx("input",{type:"number",value:n.priceRange[1],onChange:s=>x(1,parseFloat(s.target.value)||10),className:"w-full min-w-0 flex-1 bg-input border border-border rounded-lg px-3 py-2 text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/50",placeholder:"Max"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[N(n.priceRange[0])," -"," ",N(n.priceRange[1])," TON"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>j("audience"),className:"w-full flex items-center justify-between p-3 hover:bg-secondary/50 rounded-lg transition-colors",children:[e.jsx("span",{className:"font-semibold text-foreground",children:"Audience"}),e.jsx(A,{size:18,className:`text-muted-foreground transition-transform ${u.audience?"rotate-180":""}`})]}),u.audience&&e.jsx("div",{className:"px-3 space-y-4 pb-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Subscribers"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:b.map(s=>e.jsx("button",{onClick:()=>o(t=>({...t,subscribersRange:s.range})),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-all ${n.subscribersRange[0]===s.range[0]&&n.subscribersRange[1]===s.range[1]?"bg-primary text-primary-foreground":"bg-secondary text-foreground hover:bg-secondary/80"}`,children:s.label},s.label))}),e.jsxs("div",{className:"flex flex-col gap-2 mb-2 sm:flex-row",children:[e.jsx("input",{type:"number",value:n.subscribersRange[0],onChange:s=>L(0,parseInt(s.target.value)||0),className:"w-full min-w-0 flex-1 bg-input border border-border rounded-lg px-3 py-2 text-xs text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/50",placeholder:"Min"}),e.jsx("input",{type:"number",value:n.subscribersRange[1],onChange:s=>L(1,parseInt(s.target.value)||1e6),className:"w-full min-w-0 flex-1 bg-input border border-border rounded-lg px-3 py-2 text-xs text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/50",placeholder:"Max"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[f(n.subscribersRange[0])," -"," ",f(n.subscribersRange[1])]})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>j("language"),className:"w-full flex items-center justify-between p-3 hover:bg-secondary/50 rounded-lg transition-colors",children:[e.jsx("span",{className:"font-semibold text-foreground",children:"Language"}),e.jsx(A,{size:18,className:`text-muted-foreground transition-transform ${u.language?"rotate-180":""}`})]}),u.language&&e.jsx("div",{className:"px-3 pb-3",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:fe.map(s=>e.jsx("button",{onClick:()=>y(s),className:`px-4 py-2 rounded-full text-sm font-medium transition-all ${n.languages.includes(s)?"bg-primary text-primary-foreground":"bg-secondary text-foreground hover:bg-secondary/80"}`,children:s},s))})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>j("category"),className:"w-full flex items-center justify-between p-3 hover:bg-secondary/50 rounded-lg transition-colors",children:[e.jsx("span",{className:"font-semibold text-foreground",children:"Category"}),e.jsx(A,{size:18,className:`text-muted-foreground transition-transform ${u.category?"rotate-180":""}`})]}),u.category&&e.jsx("div",{className:"px-3 pb-3",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:he.map(s=>e.jsx("button",{onClick:()=>z(s),className:`px-4 py-2 rounded-full text-sm font-medium transition-all ${n.categories.includes(s)?"bg-accent text-accent-foreground":"bg-secondary text-foreground hover:bg-secondary/80"}`,children:s},s))})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>j("tags"),className:"w-full flex items-center justify-between p-3 hover:bg-secondary/50 rounded-lg transition-colors",children:[e.jsx("span",{className:"font-semibold text-foreground",children:"Tags"}),e.jsx(A,{size:18,className:`text-muted-foreground transition-transform ${u.tags?"rotate-180":""}`})]}),u.tags&&e.jsxs("div",{className:"px-3 pb-3 space-y-3",children:[e.jsx("input",{type:"text",value:w,onChange:s=>T(s.target.value),placeholder:"Search tags",className:"w-full rounded-lg border border-border bg-input px-3 py-2 text-sm text-foreground"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:v,onChange:s=>S(s.target.value),placeholder:"Add custom tag",className:"flex-1 rounded-lg border border-border bg-input px-3 py-2 text-sm text-foreground"}),e.jsx("button",{type:"button",onClick:()=>{const s=v.trim();s&&(o(t=>({...t,tags:t.tags.includes(s)?t.tags:[...t.tags,s]})),S(""))},className:"rounded-lg border border-primary/40 bg-primary/10 px-3 py-2 text-xs font-semibold text-primary",children:"Add"})]}),n.tags.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:n.tags.map(s=>e.jsxs("button",{type:"button",onClick:()=>o(t=>({...t,tags:t.tags.filter(m=>m!==s)})),className:"rounded-full bg-secondary px-3 py-1 text-xs text-foreground hover:bg-secondary/80",children:[s," ×"]},s))}):null,e.jsx("div",{className:"flex flex-wrap gap-2",children:R.filter(s=>s.toLowerCase().includes(w.trim().toLowerCase())).map(s=>{const t=n.tags.includes(s);return e.jsx("button",{type:"button",onClick:()=>o(m=>({...m,tags:t?m.tags.filter(E=>E!==s):[...m.tags,s]})),className:`rounded-full border px-3 py-1 text-xs transition-colors ${t?"border-primary/60 bg-primary/20 text-primary":"border-border/60 bg-card text-muted-foreground hover:text-foreground"}`,children:s},s)})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>j("availability"),className:"w-full flex items-center justify-between p-3 hover:bg-secondary/50 rounded-lg transition-colors",children:[e.jsx("span",{className:"font-semibold text-foreground",children:"Availability"}),e.jsx(A,{size:18,className:`text-muted-foreground transition-transform ${u.availability?"rotate-180":""}`})]}),u.availability&&e.jsxs("div",{className:"px-3 pb-3 space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:"From date"}),e.jsx("input",{type:"date",value:n.dateRange[0],onChange:s=>o(t=>({...t,dateRange:[s.target.value,t.dateRange[1]]})),className:"w-full bg-input border border-border rounded-lg px-3 py-2 text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/50"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:"To date"}),e.jsx("input",{type:"date",value:n.dateRange[1],onChange:s=>o(t=>({...t,dateRange:[t.dateRange[0],s.target.value]})),className:"w-full bg-input border border-border rounded-lg px-3 py-2 text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/50"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>j("verification"),className:"w-full flex items-center justify-between p-3 hover:bg-secondary/50 rounded-lg transition-colors",children:[e.jsx("span",{className:"font-semibold text-foreground",children:"Verification"}),e.jsx(A,{size:18,className:`text-muted-foreground transition-transform ${u.verification?"rotate-180":""}`})]}),u.verification&&e.jsx("div",{className:"px-3 pb-3",children:e.jsxs("label",{className:"flex items-center gap-3 p-3 cursor-pointer hover:bg-secondary/50 rounded-lg transition-colors",children:[e.jsx("input",{type:"checkbox",checked:n.verifiedOnly,onChange:s=>o(t=>({...t,verifiedOnly:s.target.checked})),className:"w-5 h-5 bg-secondary border border-border rounded accent-primary cursor-pointer"}),e.jsx("span",{className:"text-foreground font-medium",children:"Verified channels only"})]})})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-card border-t border-border/50 px-4 py-4 space-y-3",children:[e.jsx("button",{onClick:I,className:"button-primary w-full py-3 text-base font-semibold",children:"Apply Filters"}),e.jsx("button",{onClick:_,className:"button-secondary w-full py-3 text-base font-semibold",children:"Reset"})]})]})]}):null},je=async r=>J("/marketplace/channels/list",r),F={priceRange:[0,100],subscribersRange:[0,1e6],languages:[],categories:[],tags:[],verifiedOnly:!0,dateRange:["",""]},Ne={channels:(r,a,i,l,g)=>["marketplaceChannels",r,a,i,l,g]},ve=()=>{const[r,a]=c.useState(""),[i,l]=c.useState(""),[g,n]=c.useState(!1),[o,N]=c.useState(F),[f,u]=c.useState(1),[C]=c.useState(20),[w]=c.useState("recent"),[T]=c.useState("desc"),[v,S]=c.useState([]),[R,d]=c.useState(0);c.useEffect(()=>{const h=window.setTimeout(()=>{l(r.trim())},300);return()=>{window.clearTimeout(h)}},[r]);const b=c.useMemo(()=>{const h=o.priceRange[0]===F.priceRange[0]&&o.priceRange[1]===F.priceRange[1],k=o.subscribersRange[0]===F.subscribersRange[0]&&o.subscribersRange[1]===F.subscribersRange[1];return{q:i||void 0,tags:o.tags.length>0?o.tags:void 0,minSubscribers:k?void 0:o.subscribersRange[0],maxSubscribers:k?void 0:o.subscribersRange[1],minPriceTon:h?void 0:o.priceRange[0],maxPriceTon:h?void 0:o.priceRange[1],verifiedOnly:o.verifiedOnly,page:f,limit:C,sort:w,order:T}},[i,o,C,T,f,w]),j=c.useMemo(()=>({...o,q:i||void 0}),[i,o]);c.useEffect(()=>{u(1),S([]),d(0)},[j,C,T,w]);const x=V({queryKey:Ne.channels(j,f,C,w,T),queryFn:()=>je(b)});c.useEffect(()=>{x.data&&(d(x.data.total),S(h=>{if(f===1)return x.data.items;const k=new Map(h.map(p=>[p.id,p]));return x.data.items.forEach(p=>k.set(p.id,p)),Array.from(k.values())}))},[f,x.data]),c.useEffect(()=>{if(!x.error)return;const h=x.error instanceof Error?x.error.message:"Unable to load channels";Y.error(h)},[x.error]);const L=v.length<R,y=x.isLoading&&f===1&&v.length===0,z=x.isFetching&&f>1,I=c.useMemo(()=>v,[v]),_=()=>{x.isFetching||!L||u(h=>h+1)},s=(h,k)=>{N(p=>{switch(h){case"priceRange":return{...p,priceRange:F.priceRange};case"subscribersRange":return{...p,subscribersRange:F.subscribersRange};case"verifiedOnly":return{...p,verifiedOnly:!1};case"languages":return{...p,languages:p.languages.filter($=>$!==k)};case"categories":return{...p,categories:p.categories.filter($=>$!==k)};case"tags":return{...p,tags:p.tags.filter($=>$!==k)};default:return p}})},t=()=>n(!0),m=()=>n(!1),E=h=>N(h),B=()=>N(F);return{state:{searchQuery:r,isFilterOpen:g,filters:o,isLoading:y,isLoadingMore:z,error:x.error,total:R},computed:{channels:I,hasMore:L},actions:{setSearchQuery:a,openFilters:t,closeFilters:m,applyFilters:E,resetFilters:B,removeFilter:s,refetch:()=>x.refetch(),loadMore:_}}};function Me(){const{state:r,computed:a,actions:i}=ve(),l=r.error instanceof Error?r.error.message:"Unable to load channels";return e.jsxs("div",{className:"w-full max-w-2xl mx-auto",children:[e.jsxs("div",{className:"px-4 pt-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-base font-semibold text-foreground",children:"Marketplace"}),e.jsxs("button",{type:"button",onClick:i.openFilters,className:"inline-flex items-center gap-2 rounded-full bg-secondary/60 px-3 py-1 text-xs text-muted-foreground",children:[e.jsx(le,{size:14}),"Filters"]})]}),e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-border/60 bg-card px-3 py-2",children:[e.jsx(ae,{size:16,className:"text-muted-foreground"}),e.jsx("input",{value:r.searchQuery,onChange:g=>i.setSearchQuery(g.target.value),placeholder:"Search channels or @username",className:"flex-1 bg-transparent text-sm text-foreground placeholder:text-muted-foreground focus:outline-none"})]}),e.jsx(be,{filters:r.filters,onRemoveFilter:i.removeFilter})]}),e.jsxs("div",{className:"px-4 py-6 space-y-3",children:[r.isLoading?Array.from({length:5}).map((g,n)=>e.jsx("div",{className:"rounded-2xl border border-border/50 bg-card/80 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(M,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(M,{className:"h-4 w-40"}),e.jsx(M,{className:"h-3 w-24"}),e.jsx(M,{className:"h-3 w-32"})]}),e.jsx(M,{className:"h-4 w-16"})]})},`marketplace-skeleton-${n}`)):a.channels.map(g=>e.jsx(pe,{channel:g},g.id)),!r.isLoading&&r.error&&a.channels.length===0?e.jsx(te,{message:l,description:"Please try again when you have a stable connection.",onRetry:i.refetch}):null,!r.isLoading&&r.error&&a.channels.length>0?e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-red-500/5 p-4 text-sm text-red-200",children:[e.jsx("p",{className:"font-medium",children:l}),e.jsx("button",{type:"button",onClick:i.refetch,className:"mt-3 inline-flex items-center rounded-full border border-red-500/40 bg-red-500/10 px-3 py-1 text-xs font-semibold text-red-100",children:"Retry"})]}):null,!r.isLoading&&!r.error&&a.channels.length===0?e.jsx("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-6 text-center text-sm text-muted-foreground",children:"No channels found. Try a new search."}):null,!r.isLoading&&a.channels.length>0?e.jsx("div",{className:"flex justify-center pt-2",children:a.hasMore?e.jsx("button",{type:"button",onClick:i.loadMore,disabled:r.isLoadingMore,className:"inline-flex items-center gap-2 rounded-full border border-border/60 bg-secondary/50 px-4 py-2 text-xs font-semibold text-foreground disabled:opacity-60",children:r.isLoadingMore?"Loading more...":"Load more"}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"No more channels"})}):null]}),e.jsx(ye,{isOpen:r.isFilterOpen,onClose:i.closeFilters,filters:r.filters,onApply:i.applyFilters,onReset:i.resetFilters})]})}export{Me as default};
