import{c as L,r as u,j as e,f as g,d as D,h as I}from"./index-53kr_7Yp.js";import{f as M,n as _}from"./ton-ClBVV2oW.js";import{C as O}from"./chevron-down-DKDz8OER.js";import{u as R}from"./useQuery-BxgdRvsh.js";import{l as B}from"./listingsApi-v_TUNH-b.js";import{S as h}from"./skeleton-kSUtZSp3.js";import{g as q}from"./errors-3kY4UU5q.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],z=L("pencil-line",H);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],V=L("refresh-ccw",U),j=3,$=r=>{if(!r)return null;try{return M(_(r))}catch{return r}},k=r=>{const t=r.map(a=>a.trim()).filter(Boolean),o=Array.from(new Set(t));return{visible:o.slice(0,j),hiddenCount:Math.max(o.length-j,0)}},y=r=>r>=168&&r%24===0?`${r/24}d`:`${r}h`,F=({listings:r})=>r.length===0?e.jsx("div",{className:"rounded-xl border border-dashed border-border/60 bg-background/50 px-4 py-4 text-center text-xs text-muted-foreground",children:"No placements available yet."}):e.jsx("div",{className:"space-y-3",children:r.map(t=>{const o=k(t.tags??[]),a=[t.allowEdits?"Edits allowed":null,t.allowLinkTracking?"Tracking allowed":null].filter(Boolean),d=$(t.priceNano)??t.priceNano,s=t.pinDurationHours?`Pinned ${y(t.pinDurationHours)}`:"Not pinned",n=`Visible ${y(t.visibilityDurationHours)}`,m=t.contentRulesText?.trim();return e.jsxs("div",{className:"rounded-xl border border-border/60 bg-card/80 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-sm font-semibold text-foreground",children:[d," TON"]}),e.jsx("span",{className:"rounded-full border border-border/60 bg-muted/40 px-2 py-0.5 text-[10px] font-semibold text-muted-foreground",children:t.format})]}),e.jsxs("div",{className:"mt-2 text-[11px] text-muted-foreground",children:[s," • ",n]}),a.length>0?e.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-[11px] text-muted-foreground",children:a.map(i=>e.jsx("span",{className:"rounded-full border border-border/60 bg-muted/30 px-2 py-0.5",children:i},i))}):null,o.visible.length>0?e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-[11px] text-muted-foreground",children:[o.visible.map(i=>e.jsx("span",{className:"rounded-full border border-border/60 bg-card px-2 py-0.5 text-foreground",children:i},`${t.id}-${i}`)),o.hiddenCount>0?e.jsxs("span",{className:"rounded-full border border-border/60 bg-card px-2 py-0.5",children:["+",o.hiddenCount]}):null]}):null,m?e.jsx("p",{className:"mt-2 line-clamp-2 text-[11px] text-muted-foreground",children:m}):null]},t.id)})});function oe({channel:r,onClick:t,actions:o,isExpanded:a,onToggleExpand:d,expandedContent:s}){const[n,m]=u.useState(!1),[i,c]=u.useState(!1),l=a??n,p=!!(d||s||r.listingsPreview),b=u.useMemo(()=>$(r.minPriceNano),[r.minPriceNano]),f=k(r.tags??[]),N=r.username?`@${r.username.replace(/^@/,"")}`:null,T=r.name?.[0]?.toUpperCase()??"?",v=!i&&r.avatarUrl?r.avatarUrl:null,E=r.placementsCount!=null?r.placementsCount.toString():"—",S=typeof r.subscribers=="number"?r.subscribers.toLocaleString():"—",C=x=>{x.stopPropagation(),d?d():m(A=>!A)};return e.jsxs("div",{className:g("w-full rounded-2xl border border-border/50 bg-card/80 p-4 text-left shadow-sm transition",t&&"cursor-pointer hover:border-border/80 hover:bg-card"),role:t?"button":void 0,tabIndex:t?0:void 0,onClick:t,onKeyDown:x=>{t&&(x.key==="Enter"||x.key===" ")&&(x.preventDefault(),t())},children:[e.jsxs("div",{className:"flex items-start gap-3",children:[v?e.jsx("img",{src:v,alt:r.name,className:"h-12 w-12 rounded-full object-cover",onError:()=>c(!0)}):e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-primary/30 via-secondary/50 to-secondary text-lg text-foreground",children:T}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:r.name}),N?e.jsx("span",{className:"text-xs text-muted-foreground",children:N}):null]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o,p?e.jsx("button",{type:"button",onClick:C,"aria-expanded":l,className:"inline-flex h-8 w-8 items-center justify-center rounded-lg border border-border/60 bg-secondary/40 text-muted-foreground transition hover:text-foreground",children:e.jsx(O,{size:16,className:g("transition-transform duration-200",l&&"rotate-180")})}):null]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[E," placements"]}),e.jsx("span",{children:"·"}),e.jsxs("span",{children:[S," subscribers"]})]}),e.jsx("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:e.jsxs("span",{children:["From"," ",e.jsxs("span",{className:"font-semibold text-primary",children:[b??"—"," TON"]})]})}),f.visible.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px] text-muted-foreground",children:[f.visible.map(x=>e.jsx("span",{className:"rounded-full border border-border/60 bg-card px-2.5 py-1 text-foreground",children:x},`${r.id}-${x}`)),f.hiddenCount>0?e.jsxs("span",{className:"rounded-full border border-border/60 bg-card px-2.5 py-1 text-muted-foreground",children:["+",f.hiddenCount]}):null]}):null]})]}),p?e.jsx("div",{className:g("overflow-hidden transition-all duration-300",l?"mt-4 max-h-[1200px] opacity-100":"max-h-0 opacity-0"),children:e.jsx("div",{className:"rounded-2xl border border-border/60 bg-background/60 p-3",children:s||e.jsx(F,{listings:r.listingsPreview??[]})})}):null]})}const K=5,W=3,w=1000000000n,G=r=>{try{const t=BigInt(r),o=t/w,a=t%w;if(a===0n)return`${o.toString()} TON`;const s=a.toString().padStart(9,"0").slice(0,2).replace(/0+$/,"");return`${s?`${o.toString()}.${s}`:o.toString()} TON`}catch{return`${r} TON`}},Q=r=>{const t=r.slice(0,2),o=r.length-t.length;return{shown:t,remaining:o}},P=u.memo(({channelId:r,listing:t,rootBackTo:o})=>{const a=t.pinDurationHours?`Pinned ${t.pinDurationHours}h`:"No pin",d=`Visible ${t.visibilityDurationHours}h`,s=Q(t.tags??[]);return e.jsxs("div",{className:"flex items-center gap-3 py-3",children:[e.jsxs("div",{className:"flex flex-col items-start gap-1",children:[e.jsx("span",{className:"rounded-full border border-border/60 bg-muted/40 px-2 py-0.5 text-[10px] font-semibold text-muted-foreground",children:t.format}),e.jsx("span",{className:g("rounded-full border px-2 py-0.5 text-[10px] font-semibold",t.isActive?"border-emerald-500/40 bg-emerald-500/15 text-emerald-200":"border-muted-foreground/30 bg-muted/40 text-muted-foreground"),children:t.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:G(t.priceNano)}),e.jsxs("div",{className:"mt-1 text-[11px] text-muted-foreground",children:[a," • ",d]}),s.shown.length>0?e.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[s.shown.map(n=>e.jsx("span",{className:"rounded-full border border-border/60 bg-muted/30 px-2 py-0.5 text-[10px] text-muted-foreground",children:n},n)),s.remaining>0?e.jsxs("span",{className:"rounded-full border border-border/60 bg-muted/30 px-2 py-0.5 text-[10px] text-muted-foreground",children:["+",s.remaining]}):null]}):null]}),e.jsx(I,{to:`/channel-manage/${r}/listings/${t.id}/edit`,state:o?{rootBackTo:o}:void 0,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-border/60 bg-background text-muted-foreground transition hover:text-foreground","aria-label":"Edit listing",children:e.jsx(z,{size:14})})]})});P.displayName="ListingPreviewRow";const X=u.memo(({channelId:r,isExpanded:t,onSummaryChange:o})=>{const d=D().state?.rootBackTo,s=R({queryKey:["channelListingsPreview",r],queryFn:()=>B({channelId:r,page:1,limit:K,onlyActive:!0,sort:"recent"}),enabled:t,staleTime:1e3*60*5}),n=s.data?.items??[],m=s.data?.total??n.length;u.useEffect(()=>{if(!s.data)return;const c=n.reduce((l,p)=>{try{const b=BigInt(p.priceNano);return l===null||b<l?b:l}catch{return l}},null);o?.({placementsCount:m,minPriceNano:c?c.toString():null})},[n,o,s.data,m]);const i=u.useMemo(()=>n.slice(0,W),[n]);return e.jsx("div",{className:"space-y-3",children:s.isLoading?e.jsx("div",{className:"space-y-2",children:Array.from({length:2}).map((c,l)=>e.jsxs("div",{className:"rounded-xl border border-border/50 bg-background/60 px-3 py-3",children:[e.jsx(h,{className:"h-4 w-24"}),e.jsx(h,{className:"mt-2 h-3 w-40"}),e.jsx(h,{className:"mt-2 h-3 w-28"})]},`listing-skeleton-${l}`))}):s.isError?e.jsxs("div",{className:"rounded-xl border border-border/60 bg-red-500/5 px-4 py-3 text-xs text-red-200",children:[e.jsx("p",{children:q(s.error,"Unable to load placements.")}),e.jsxs("button",{type:"button",onClick:()=>s.refetch(),className:"mt-2 inline-flex items-center gap-2 rounded-lg border border-red-500/40 bg-red-500/10 px-3 py-1 text-[11px] font-semibold text-red-200",children:[e.jsx(V,{size:12}),"Retry"]})]}):i.length>0?e.jsx("div",{className:"rounded-xl border border-border/60 bg-background/60 px-3 divide-y divide-border/40",children:i.map(c=>e.jsx(P,{channelId:r,listing:c,rootBackTo:d},c.id))}):e.jsxs("div",{className:"rounded-xl border border-dashed border-border/60 bg-background/50 px-4 py-4 text-center",children:[e.jsx("p",{className:"text-xs font-semibold text-foreground",children:"No placements yet"}),e.jsx("p",{className:"mt-1 text-[11px] text-muted-foreground",children:"Create your first listing to start earning."})]})})});X.displayName="ChannelListingsPreview";export{oe as C,X as a};
