import{c as A,u as U,r as i,j as e,a as q,X as N,p as _,b as H}from"./index-Z0mf_gh5.js";import{C as V,a as B}from"./ChannelListingsPreview-_4hN6P7G.js";import{f as X,l as G}from"./tagOptions-DHtvjoWf.js";import{f as K}from"./formatters-B6oyEeL1.js";import{C as T}from"./chevron-down-B3TtA7Uk.js";import{S as L}from"./skeleton-B9_jJJr-.js";import{E as J}from"./ErrorState-CHIonT5P.js";import{P as W}from"./PageContainer-CQPTOrdE.js";import{u as Y}from"./useQuery-C1DzNwMP.js";import"./labels-EEWNt0UM.js";import"./listingsApi-Bbz28sfX.js";import"./errors-3kY4UU5q.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],ee=A("search",Z);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]],re=A("sliders-horizontal",se);function te({channel:s}){const a=U(),[o,m]=i.useState(!1);s.username?.replace(/^@/,"");const n=i.useMemo(()=>({id:s.id,name:s.name,username:s.username,about:s.about,avatarUrl:s.avatarUrl,subscribers:s.subscribers??null,placementsCount:s.placementsCount??null,minPriceNano:s.minPriceNano??null,currency:s.currency,tags:s.tags??[],listingsPreview:s.listingsPreview??null}),[s]),t=()=>{a(`/channels/${s.id}`,{state:{channel:n,listingsPreview:n.listingsPreview??null,placementsCount:n.placementsCount??null,minPriceNano:n.minPriceNano??null,tags:n.tags??[],subscribers:n.subscribers??null,avatarUrl:n.avatarUrl??null,rootBackTo:"/marketplace"}})};return e.jsx(V,{channel:n,onClick:t,isExpanded:o,onToggleExpand:()=>m(c=>!c),expandedContent:e.jsx(B,{channelId:s.id,isExpanded:o,mode:"viewer"})})}const ae=({filters:s,onRemoveFilter:a})=>{const{t:o}=q();return s.priceRange[0]>0||s.priceRange[1]<10||s.subscribersRange[0]>0||s.subscribersRange[1]<1e6||s.languages.length>0||s.categories.length>0||s.tags.length>0||s.verifiedOnly?e.jsx("div",{className:"px-4 py-3 bg-secondary/30 border-b border-border/30 space-y-2",children:e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[s.priceRange[0]>0||s.priceRange[1]<10?e.jsxs("button",{onClick:()=>a("priceRange"),className:"inline-flex items-center gap-1.5 bg-primary/20 hover:bg-primary/30 text-primary px-3 py-1.5 rounded-full text-xs font-medium transition-colors",children:[o("marketplace.filters.active.price"),": ",s.priceRange[0].toFixed(1),"-",s.priceRange[1].toFixed(1)," ",o("common.ton"),e.jsx(N,{size:14})]}):null,s.subscribersRange[0]>0||s.subscribersRange[1]<1e6?e.jsxs("button",{onClick:()=>a("subscribersRange"),className:"inline-flex items-center gap-1.5 bg-accent/20 hover:bg-accent/30 text-accent px-3 py-1.5 rounded-full text-xs font-medium transition-colors",children:[o("marketplace.filters.active.subscribers"),":"," ",(s.subscribersRange[0]/1e3).toFixed(0),"K-",(s.subscribersRange[1]/1e3).toFixed(0),"K",e.jsx(N,{size:14})]}):null,s.verifiedOnly?e.jsxs("button",{onClick:()=>a("verifiedOnly"),className:"inline-flex items-center gap-1.5 bg-primary/20 hover:bg-primary/30 text-primary px-3 py-1.5 rounded-full text-xs font-medium transition-colors",children:[o("marketplace.filters.verifiedOnly"),e.jsx(N,{size:14})]}):null,s.languages.map(n=>e.jsxs("button",{onClick:()=>a("languages",n),className:"inline-flex items-center gap-1.5 bg-primary/20 hover:bg-primary/30 text-primary px-3 py-1.5 rounded-full text-xs font-medium transition-colors",children:[n,e.jsx(N,{size:14})]},n)),s.categories.map(n=>e.jsxs("button",{onClick:()=>a("categories",n),className:"inline-flex items-center gap-1.5 bg-accent/20 hover:bg-accent/30 text-accent px-3 py-1.5 rounded-full text-xs font-medium transition-colors",children:[n,e.jsx(N,{size:14})]},n)),s.tags.map(n=>e.jsxs("button",{onClick:()=>a("tags",n),className:"inline-flex items-center gap-1.5 bg-secondary/70 hover:bg-secondary text-foreground px-3 py-1.5 rounded-full text-xs font-medium transition-colors",children:[n,e.jsx(N,{size:14})]},n))]})}):null},ne=({isOpen:s,onClose:a,filters:o,onApply:m,onReset:n})=>{const{t,language:c}=q(),[d,g]=i.useState(o),w=r=>K(r,c,{notation:"compact",maximumFractionDigits:1}),[b,k]=i.useState({pricing:!0,audience:!0,language:!1,category:!1,tags:!1,availability:!1,verification:!1}),[j,R]=i.useState(""),[C,S]=i.useState(""),P=i.useMemo(()=>X(G,t),[t]),z=[{label:t("common.any"),range:[0,10]},{label:`0-1 ${t("common.ton")}`,range:[0,1]},{label:`1-5 ${t("common.ton")}`,range:[1,5]},{label:`5-10 ${t("common.ton")}`,range:[5,10]}],E=[{label:t("common.any"),range:[0,1e6]},{label:"0-10K",range:[0,1e4]},{label:"10-100K",range:[1e4,1e5]},{label:"100K-1M",range:[1e5,1e6]}];i.useEffect(()=>{g(o)},[o,s]);const u=r=>{k(l=>({...l,[r]:!l[r]}))},F=(r,l)=>{const f=[...d.priceRange];f[r]=l,g(v=>({...v,priceRange:f}))},O=(r,l)=>{const f=[...d.subscribersRange];f[r]=l,g(v=>({...v,subscribersRange:f}))},$=()=>{m(d),a()},Q=()=>{n(),g({priceRange:[0,10],subscribersRange:[0,1e6],languages:[],categories:[],tags:[],verifiedOnly:!1,dateRange:["",""]})};return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/40 z-40",onClick:a,"aria-label":t("common.close")}),e.jsxs("div",{className:"fixed inset-x-0 bottom-0 top-0 bg-card rounded-t-2xl z-50 animate-in slide-in-from-bottom-10 duration-300 flex flex-col h-[100dvh] sm:h-auto sm:top-auto sm:max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-card border-b border-border/50 px-4 py-4 flex items-center justify-between rounded-t-2xl shrink-0",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:t("marketplace.filters.title")}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-secondary rounded-lg transition-colors","aria-label":t("common.close"),children:e.jsx(N,{size:20,className:"text-foreground"})})]}),e.jsxs("div",{className:"px-4 py-4 space-y-4 flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>u("pricing"),className:"w-full flex items-center justify-between p-3 hover:bg-secondary/50 rounded-lg transition-colors",children:[e.jsx("span",{className:"font-semibold text-foreground",children:t("marketplace.filters.pricingTitle")}),e.jsx(T,{size:18,className:`text-muted-foreground transition-transform ${b.pricing?"rotate-180":""}`})]}),b.pricing&&e.jsxs("div",{className:"px-3 space-y-3 pb-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:z.map(r=>e.jsx("button",{onClick:()=>g(l=>({...l,priceRange:r.range})),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-all ${d.priceRange[0]===r.range[0]&&d.priceRange[1]===r.range[1]?"bg-primary text-primary-foreground":"bg-secondary text-foreground hover:bg-secondary/80"}`,children:r.label},r.label))}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row",children:[e.jsx("input",{type:"number",value:d.priceRange[0],onChange:r=>F(0,parseFloat(r.target.value)||0),className:"w-full min-w-0 flex-1 bg-input border border-border rounded-lg px-3 py-2 text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/50",placeholder:t("common.min")}),e.jsx("input",{type:"number",value:d.priceRange[1],onChange:r=>F(1,parseFloat(r.target.value)||10),className:"w-full min-w-0 flex-1 bg-input border border-border rounded-lg px-3 py-2 text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/50",placeholder:t("common.max")})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[K(d.priceRange[0],c)," -"," ",K(d.priceRange[1],c)," ",t("common.ton")]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>u("audience"),className:"w-full flex items-center justify-between p-3 hover:bg-secondary/50 rounded-lg transition-colors",children:[e.jsx("span",{className:"font-semibold text-foreground",children:t("marketplace.filters.audienceTitle")}),e.jsx(T,{size:18,className:`text-muted-foreground transition-transform ${b.audience?"rotate-180":""}`})]}),b.audience&&e.jsx("div",{className:"px-3 space-y-4 pb-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:t("marketplace.filters.subscribersLabel")}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:E.map(r=>e.jsx("button",{onClick:()=>g(l=>({...l,subscribersRange:r.range})),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-all ${d.subscribersRange[0]===r.range[0]&&d.subscribersRange[1]===r.range[1]?"bg-primary text-primary-foreground":"bg-secondary text-foreground hover:bg-secondary/80"}`,children:r.label},r.label))}),e.jsxs("div",{className:"flex flex-col gap-2 mb-2 sm:flex-row",children:[e.jsx("input",{type:"number",value:d.subscribersRange[0],onChange:r=>O(0,parseInt(r.target.value)||0),className:"w-full min-w-0 flex-1 bg-input border border-border rounded-lg px-3 py-2 text-xs text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/50",placeholder:t("common.min")}),e.jsx("input",{type:"number",value:d.subscribersRange[1],onChange:r=>O(1,parseInt(r.target.value)||1e6),className:"w-full min-w-0 flex-1 bg-input border border-border rounded-lg px-3 py-2 text-xs text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/50",placeholder:t("common.max")})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[w(d.subscribersRange[0])," -"," ",w(d.subscribersRange[1])]})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>u("tags"),className:"w-full flex items-center justify-between p-3 hover:bg-secondary/50 rounded-lg transition-colors",children:[e.jsx("span",{className:"font-semibold text-foreground",children:t("marketplace.filters.tagsTitle")}),e.jsx(T,{size:18,className:`text-muted-foreground transition-transform ${b.tags?"rotate-180":""}`})]}),b.tags&&e.jsxs("div",{className:"px-3 pb-3 space-y-3",children:[e.jsx("input",{type:"text",value:j,onChange:r=>R(r.target.value),placeholder:t("marketplace.filters.tagsSearch"),className:"w-full rounded-lg border border-border bg-input px-3 py-2 text-sm text-foreground"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:C,onChange:r=>S(r.target.value),placeholder:t("marketplace.filters.tagsCustom"),className:"flex-1 rounded-lg border border-border bg-input px-3 py-2 text-sm text-foreground"}),e.jsx("button",{type:"button",onClick:()=>{const r=C.trim();r&&(g(l=>({...l,tags:l.tags.includes(r)?l.tags:[...l.tags,r]})),S(""))},className:"rounded-lg border border-primary/40 bg-primary/10 px-3 py-2 text-xs font-semibold text-primary",children:t("common.add")})]}),d.tags.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:d.tags.map(r=>e.jsxs("button",{type:"button",onClick:()=>g(l=>({...l,tags:l.tags.filter(f=>f!==r)})),className:"rounded-full bg-secondary px-3 py-1 text-xs text-foreground hover:bg-secondary/80",children:[r," ",t("common.removeTagSuffix")]},r))}):null,e.jsx("div",{className:"flex flex-wrap gap-2",children:P.filter(r=>r.label.toLowerCase().includes(j.trim().toLowerCase())).map(r=>{const l=d.tags.includes(r.value);return e.jsx("button",{type:"button",onClick:()=>g(f=>({...f,tags:l?f.tags.filter(v=>v!==r.value):[...f.tags,r.value]})),className:`rounded-full border px-3 py-1 text-xs transition-colors ${l?"border-primary/60 bg-primary/20 text-primary":"border-border/60 bg-card text-muted-foreground hover:text-foreground"}`,children:r.label},r.value)})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>u("verification"),className:"w-full flex items-center justify-between p-3 hover:bg-secondary/50 rounded-lg transition-colors",children:[e.jsx("span",{className:"font-semibold text-foreground",children:t("marketplace.filters.verificationTitle")}),e.jsx(T,{size:18,className:`text-muted-foreground transition-transform ${b.verification?"rotate-180":""}`})]}),b.verification&&e.jsx("div",{className:"px-3 pb-3",children:e.jsxs("label",{className:"flex items-center gap-3 p-3 cursor-pointer hover:bg-secondary/50 rounded-lg transition-colors",children:[e.jsx("input",{type:"checkbox",checked:d.verifiedOnly,onChange:r=>g(l=>({...l,verifiedOnly:r.target.checked})),className:"w-5 h-5 bg-secondary border border-border rounded accent-primary cursor-pointer"}),e.jsx("span",{className:"text-foreground font-medium",children:t("marketplace.filters.verifiedOnly")})]})})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-card border-t border-border/50 px-4 py-4 space-y-3",children:[e.jsx("button",{onClick:$,className:"button-primary w-full py-3 text-base font-semibold",children:t("marketplace.filters.apply")}),e.jsx("button",{onClick:Q,className:"button-secondary w-full py-3 text-base font-semibold",children:t("common.reset")})]})]})]}):null},oe=async s=>_("/marketplace/channels/list",s),h={priceRange:[0,100],subscribersRange:[0,1e6],languages:[],categories:[],tags:[],verifiedOnly:!1,dateRange:["",""]},le={channels:(s,a,o,m,n)=>["marketplaceChannels",s,a,o,m,n]},ie=()=>{const[s,a]=i.useState(""),[o,m]=i.useState(""),[n,t]=i.useState(!1),[c,d]=i.useState(h),[g,w]=i.useState(1),[b]=i.useState(20),[k]=i.useState("recent"),[j]=i.useState("desc"),[R,C]=i.useState([]),[S,P]=i.useState(0);i.useEffect(()=>{const p=window.setTimeout(()=>{m(s.trim())},300);return()=>{window.clearTimeout(p)}},[s]);const z=i.useMemo(()=>{const p=c.priceRange[0]===h.priceRange[0]&&c.priceRange[1]===h.priceRange[1],y=c.subscribersRange[0]===h.subscribersRange[0]&&c.subscribersRange[1]===h.subscribersRange[1];return{q:o||void 0,tags:c.tags.length>0?c.tags:void 0,minSubscribers:y?void 0:c.subscribersRange[0],maxSubscribers:y?void 0:c.subscribersRange[1],minPriceTon:p?void 0:c.priceRange[0],maxPriceTon:p?void 0:c.priceRange[1],...c.verifiedOnly?{verifiedOnly:!0}:{},page:g,limit:b,sort:k,order:j}},[o,c,b,j,g,k]),E=i.useMemo(()=>({...c,q:o||void 0}),[o,c]);i.useEffect(()=>{w(1),C([]),P(0)},[E,b,j,k]);const u=Y({queryKey:le.channels(E,g,b,k,j),queryFn:()=>oe(z)});i.useEffect(()=>{u.data&&(P(u.data.total),C(p=>{if(g===1)return u.data.items;const y=new Map(p.map(x=>[x.id,x]));return u.data.items.forEach(x=>y.set(x.id,x)),Array.from(y.values())}))},[g,u.data]),i.useEffect(()=>{if(!u.error)return;const p=u.error instanceof Error?u.error.message:"Unable to load channels";H.error(p)},[u.error]);const F=R.length<S,O=u.isLoading&&g===1&&R.length===0,$=u.isFetching&&g>1,Q=i.useMemo(()=>R,[R]),r=()=>{u.isFetching||!F||w(p=>p+1)},l=(p,y)=>{d(x=>{switch(p){case"priceRange":return{...x,priceRange:h.priceRange};case"subscribersRange":return{...x,subscribersRange:h.subscribersRange};case"verifiedOnly":return{...x,verifiedOnly:!1};case"languages":return{...x,languages:x.languages.filter(M=>M!==y)};case"categories":return{...x,categories:x.categories.filter(M=>M!==y)};case"tags":return{...x,tags:x.tags.filter(M=>M!==y)};default:return x}})},f=()=>t(!0),v=()=>t(!1),I=p=>d(p),D=()=>d(h);return{state:{searchQuery:s,isFilterOpen:n,filters:c,isLoading:O,isLoadingMore:$,error:u.error,total:S},computed:{channels:Q,hasMore:F},actions:{setSearchQuery:a,openFilters:f,closeFilters:v,applyFilters:I,resetFilters:D,removeFilter:l,refetch:()=>u.refetch(),loadMore:r}}};function ve(){const{t:s}=q(),{state:a,computed:o,actions:m}=ie(),n=a.error instanceof Error?a.error.message:s("marketplace.loadError");return e.jsxs("div",{className:"w-full max-w-2xl mx-auto",children:[e.jsxs(W,{className:"pt-4 space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("button",{type:"button",onClick:m.openFilters,className:"inline-flex items-center gap-2 rounded-lg bg-secondary/60 px-3 py-1 text-xs text-muted-foreground",children:[e.jsx(re,{size:14}),s("marketplace.filters.title")]})}),e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-border/60 bg-card px-3 py-2",children:[e.jsx(ee,{size:16,className:"text-muted-foreground"}),e.jsx("input",{value:a.searchQuery,onChange:t=>m.setSearchQuery(t.target.value),placeholder:s("marketplace.filters.searchPlaceholder"),className:"flex-1 bg-transparent text-sm text-foreground placeholder:text-muted-foreground focus:outline-none"})]}),e.jsx(ae,{filters:a.filters,onRemoveFilter:m.removeFilter})]}),e.jsxs("div",{className:"space-y-3",children:[a.isLoading?Array.from({length:5}).map((t,c)=>e.jsx("div",{className:"rounded-2xl border border-border/50 bg-card/80 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(L,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(L,{className:"h-4 w-40"}),e.jsx(L,{className:"h-3 w-24"}),e.jsx(L,{className:"h-3 w-32"})]}),e.jsx(L,{className:"h-4 w-16"})]})},`marketplace-skeleton-${c}`)):o.channels.map(t=>e.jsx(te,{channel:t},t.id)),!a.isLoading&&a.error&&o.channels.length===0?e.jsx(J,{message:n,description:s("marketplace.loadErrorHint"),onRetry:m.refetch}):null,!a.isLoading&&a.error&&o.channels.length>0?e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-red-500/5 p-4 text-sm text-red-200",children:[e.jsx("p",{className:"font-medium",children:n}),e.jsx("button",{type:"button",onClick:m.refetch,className:"mt-3 inline-flex items-center rounded-lg border border-red-500/40 bg-red-500/10 px-3 py-1 text-xs font-semibold text-red-100",children:s("common.retry")})]}):null,!a.isLoading&&!a.error&&o.channels.length===0?e.jsx("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-6 text-center text-sm text-muted-foreground",children:s("marketplace.empty.subtitle")}):null,!a.isLoading&&o.channels.length>0?e.jsx("div",{className:"flex justify-center pt-2",children:o.hasMore?e.jsx("button",{type:"button",onClick:m.loadMore,disabled:a.isLoadingMore,className:"inline-flex items-center gap-2 rounded-lg border border-border/60 bg-secondary/50 px-4 py-2 text-xs font-semibold text-foreground disabled:opacity-60",children:a.isLoadingMore?s("common.loadingMore"):s("common.loadMore")}):e.jsx("span",{className:"text-xs text-muted-foreground",children:s("marketplace.noMoreChannels")})}):null]})]}),e.jsx(ne,{isOpen:a.isFilterOpen,onClose:m.closeFilters,filters:a.filters,onApply:m.applyFilters,onReset:m.resetFilters})]})}export{ve as default};
