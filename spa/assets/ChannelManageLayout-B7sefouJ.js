import{u as k,b as M,a as R,r as a,j as e,o as P,a2 as F,$,d as D}from"./index-DPDWpLIH.js";import{u as A,R as S,g as z,a as O}from"./useVerifyChannel-CJUO6rjy.js";import{m as b}from"./managedChannels-D4p1C-jX.js";import{s as T,b as U}from"./mockStore-DpbrTi1Y.js";import"./useMutation-DO5HdRR2.js";import"./channelsApi-CPEccAtt.js";const W=s=>({id:s.id,name:s.title||"Untitled channel",username:s.username.startsWith("@")?s.username:`@${s.username}`,avatar:"ðŸ“£",status:s.status,verified:s.status==="VERIFIED",subscribers:s.memberCount??0,averageViews:s.avgViews??0,engagement:0,postsPerWeek:0,earnings:0,activeDeals:0,lastVerified:s.verifiedAt?"recently":"â€“",viewsTrend:[]}),J=()=>{const{id:s}=k(),m=M(),p=R(),{mutateAsync:h,isPending:u}=A(),[x,o]=a.useState(null),i=a.useMemo(()=>m.state?.channel??null,[m.state]),c=a.useMemo(()=>i?W(i):null,[i]),[r,f]=a.useState(()=>s?c??b[s]??null:null);a.useEffect(()=>{if(!s){f(null);return}const t=c??b[s]??null;f(n=>t||(n?.id===s?n:null))},[c,s]);const v=r?.status==="PENDING_VERIFY",[l,y]=a.useState([]),[j,w]=a.useState("active");a.useEffect(()=>{if(!s)return;const t=()=>{y(U(s))};return t(),T(t)},[s]);const d=a.useMemo(()=>l.filter(t=>t.isActive),[l]),N=a.useMemo(()=>l.filter(t=>!t.isActive),[l]),E=a.useMemo(()=>d.slice(0,3),[d]),C=!1;if(!r)return e.jsx("div",{className:"w-full max-w-2xl mx-auto px-4 py-6",children:e.jsx("p",{className:"text-muted-foreground",children:"Channel not found"})});const L=async()=>{if(s){o(null);try{const t=await h(s);if(t.status==="VERIFIED"){const g=i?{...i,status:"VERIFIED"}:void 0;p(`/channel-manage/${s}/overview`,{replace:!0,state:g?{channel:g}:void 0});return}const n=z(t,"Verification failed. Please check your bot permissions and retry.");o(n)}catch(t){const n=O(t,"Unable to verify the channel right now.");o(n),D.error(n)}}},V=`/channel-manage/${r.id}`,I={channel:r,listings:l,activeListings:d,inactiveListings:N,previewListings:E,listingFilter:j,setListingFilter:w,mockModeEnabled:C};return e.jsxs("div",{className:"w-full max-w-2xl mx-auto",children:[e.jsxs("div",{className:"px-4 py-6 bg-gradient-to-b from-card/50 to-transparent",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-primary/40 to-accent/40 flex items-center justify-center text-4xl flex-shrink-0",children:r.avatar}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("h2",{className:"text-xl font-bold text-foreground",children:r.name})}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:r.username}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Last verified ",r.lastVerified]})]})]}),v?e.jsxs("div",{className:"rounded-2xl border border-yellow-500/40 bg-yellow-500/10 px-4 py-3 text-xs text-yellow-100",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-yellow-100",children:"Channel not verified yet."}),e.jsx("p",{className:"text-yellow-100/80",children:"Add the bot as admin and enable â€œPost messagesâ€, then retry verification."})]}),e.jsxs("button",{type:"button",onClick:L,disabled:u,className:"inline-flex items-center justify-center gap-2 rounded-full bg-yellow-500/80 px-4 py-2 text-xs font-semibold text-yellow-950 transition disabled:cursor-not-allowed disabled:opacity-70",children:[u?e.jsx(P,{size:14,className:"animate-spin"}):e.jsx(S,{size:14}),"Retry verification"]})]}),x?e.jsx("p",{className:"mt-2 text-[11px] text-yellow-100/80",children:x}):null]}):null]}),e.jsx("div",{className:"border-b border-border/50 bg-card/80 backdrop-blur-glass px-4",children:e.jsx("div",{className:"flex gap-6",children:[{id:"overview",label:"Overview"},{id:"listings",label:"Listings"},{id:"settings",label:"Settings"}].map(t=>e.jsx(F,{to:`${V}/${t.id}`,state:i?{channel:i}:void 0,className:({isActive:n})=>`py-3 font-medium text-sm border-b-2 transition-colors ${n?"text-primary border-b-primary":"text-muted-foreground border-b-transparent hover:text-foreground"}`,children:t.label},t.id))})}),e.jsx("div",{className:"px-4 py-6 space-y-4",children:e.jsx($,{context:I})}),e.jsx("div",{className:"h-20"})]})};export{J as default};
