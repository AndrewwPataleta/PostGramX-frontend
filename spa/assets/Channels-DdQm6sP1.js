import{i as I,k as Q,l as G,c as C,r as i,j as e,h as f,X as $,L as v,e as Y,u as k,d as H}from"./index-gsGCTaQ6.js";import{C as W}from"./chevron-down-CfNpn-cr.js";import{Q as X,a as Z,u as J,E as ee}from"./ErrorState-OFiSxt5I.js";import{p as te}from"./listingsApi-BeZP6xl0.js";import{S as N}from"./skeleton-BhXiUYeb.js";import{g as P}from"./errors-3kY4UU5q.js";import{p as se,u as re}from"./channelsApi-B_IguScW.js";import{R as ne,P as ae,O as oe,C as ie,T as de,a as le}from"./index-bhr4xyIB.js";import{P as ce}from"./plus-BBdbGtin.js";var xe=class extends X{constructor(t,r){super(t,r)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(t){super.setOptions({...t,behavior:I()})}getOptimisticResult(t){return t.behavior=I(),super.getOptimisticResult(t)}fetchNextPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"backward"}}})}createResult(t,r){const{state:n}=t,a=super.createResult(t,r),{isFetching:o,isRefetching:d,isError:l,isRefetchError:g}=a,m=n.fetchMeta?.fetchMore?.direction,h=l&&m==="forward",u=o&&m==="forward",j=l&&m==="backward",b=o&&m==="backward";return{...a,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:G(r,n.data),hasPreviousPage:Q(r,n.data),isFetchNextPageError:h,isFetchingNextPage:u,isFetchPreviousPageError:j,isFetchingPreviousPage:b,isRefetchError:g&&!h&&!j,isRefetching:d&&!u&&!b}}};function me(t,r){return Z(t,xe)}/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],he=C("badge-check",ue);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],pe=C("pencil-line",be);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],ge=C("refresh-ccw",fe);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]],Ne=C("users-round",ye),je={DRAFT:{label:"Draft",className:"bg-muted/40 text-muted-foreground border-border/60"},PENDING_VERIFY:{label:"Pending verification",className:"bg-yellow-500/20 text-yellow-300 border-yellow-500/40"},VERIFIED:{label:"Verified",className:"bg-emerald-500/15 text-emerald-300 border-emerald-500/30",icon:e.jsx(he,{size:12,className:"text-emerald-300"})},FAILED:{label:"Verification failed",className:"bg-red-500/20 text-red-300 border-red-500/40"},REVOKED:{label:"Revoked",className:"bg-orange-500/20 text-orange-300 border-orange-500/40"}},ve=t=>t==null?"‚Äì":t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString(),we=t=>t||"Untitled channel",ke=({channel:t,onClick:r,onVerify:n,onUnlink:a,isExpanded:o=!1,onToggleExpand:d,expandDisabled:l=!1,expandTooltip:g,expandedContent:m})=>{const h=je[t.status],u=t.status==="PENDING_VERIFY"&&n,j=!!a,b=!!d;return e.jsxs("div",{className:f("w-full rounded-2xl border border-border/50 bg-card/80 p-4 text-left shadow-sm transition",r&&"cursor-pointer hover:border-border/80 hover:bg-card"),role:r?"button":void 0,tabIndex:r?0:void 0,onClick:r,onKeyDown:c=>{r&&(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),r())},children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:we(t.title)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",t.username]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[j?e.jsx("button",{type:"button",onClick:c=>{c.stopPropagation(),a?.()},className:"rounded-full border border-border/60 bg-background/70 p-1.5 text-muted-foreground transition hover:text-foreground","aria-label":"Unlink channel",children:e.jsx($,{size:14})}):null,e.jsxs("span",{className:f("inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[11px] font-medium",h.className),children:[h.icon,h.label]}),b?e.jsx("button",{type:"button",onClick:c=>{c.stopPropagation(),d?.()},disabled:l,title:g,"aria-label":o?"Collapse placements":"Expand placements","aria-expanded":o,className:f("flex h-9 w-9 items-center justify-center rounded-full border border-border/60 bg-background/70 text-muted-foreground transition",!l&&"hover:text-foreground",l&&"cursor-not-allowed opacity-60"),children:e.jsx(W,{size:16,className:f("transition-transform duration-300",o&&"rotate-180")})}):null]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"rounded-xl bg-muted/30 p-3",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(Ne,{size:12}),"Subscribers"]}),e.jsx("p",{className:"mt-1 text-sm font-semibold text-foreground",children:ve(t.memberCount)})]})}),e.jsx("div",{className:"mt-4 flex items-center justify-between text-xs text-muted-foreground",children:e.jsx("div",{className:"flex items-center gap-2",children:u?e.jsx("button",{type:"button",onClick:c=>{c.stopPropagation(),n()},className:"rounded-full border border-yellow-500/40 bg-yellow-500/15 px-2 py-0.5 text-[11px] font-semibold text-yellow-200 transition hover:bg-yellow-500/25",children:"Verify"}):null})}),m?e.jsx("div",{className:f("mt-4 grid transition-[grid-template-rows] duration-300 ease-out",o?"grid-rows-[1fr]":"grid-rows-[0fr]"),children:e.jsx("div",{className:f("overflow-hidden transition-all duration-300 ease-out",o?"opacity-100 translate-y-0":"opacity-0 -translate-y-1"),children:e.jsx("div",{className:"rounded-xl border border-border/50 bg-background/60 p-3",children:m})})}):null]})},Pe=i.memo(ke),Ce=5,M=3,S=1000000000n,Ee=t=>{try{const r=BigInt(t),n=r/S,a=r%S;if(a===0n)return`${n.toString()} TON`;const d=a.toString().padStart(9,"0").slice(0,2).replace(/0+$/,"");return`${d?`${n.toString()}.${d}`:n.toString()} TON`}catch{return`${t} TON`}},Re=t=>{const r=t.slice(0,2),n=t.length-r.length;return{shown:r,remaining:n}},T=i.memo(({channelId:t,listing:r})=>{const n=r.pinDurationHours?`Pinned ${r.pinDurationHours}h`:"No pin",a=`Visible ${r.visibilityDurationHours}h`,o=Re(r.tags??[]);return e.jsxs("div",{className:"flex items-center gap-3 py-3",children:[e.jsxs("div",{className:"flex flex-col items-start gap-1",children:[e.jsx("span",{className:"rounded-full border border-border/60 bg-muted/40 px-2 py-0.5 text-[10px] font-semibold text-muted-foreground",children:r.format}),e.jsx("span",{className:f("rounded-full border px-2 py-0.5 text-[10px] font-semibold",r.isActive?"border-emerald-500/40 bg-emerald-500/15 text-emerald-200":"border-muted-foreground/30 bg-muted/40 text-muted-foreground"),children:r.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:Ee(r.priceNano)}),e.jsxs("div",{className:"mt-1 text-[11px] text-muted-foreground",children:[n," ‚Ä¢ ",a]}),o.shown.length>0?e.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[o.shown.map(d=>e.jsx("span",{className:"rounded-full border border-border/60 bg-muted/30 px-2 py-0.5 text-[10px] text-muted-foreground",children:d},d)),o.remaining>0?e.jsxs("span",{className:"rounded-full border border-border/60 bg-muted/30 px-2 py-0.5 text-[10px] text-muted-foreground",children:["+",o.remaining]}):null]}):null]}),e.jsx(v,{to:`/channel-manage/${t}/listings/${r.id}/edit`,className:"flex h-9 w-9 items-center justify-center rounded-full border border-border/60 bg-background text-muted-foreground transition hover:text-foreground","aria-label":"Edit listing",children:e.jsx(pe,{size:14})})]})});T.displayName="ListingPreviewRow";const D=i.memo(({channelId:t,isExpanded:r})=>{const n=J({queryKey:["channelListingsPreview",t],queryFn:()=>te({channelId:t,page:1,limit:Ce,onlyActive:!0,sort:"recent"}),enabled:r,staleTime:3e5}),a=i.useMemo(()=>n.data?.items?.slice(0,M)??[],[n.data?.items]),d=(n.data?.total??n.data?.items?.length??0)>M;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Placements"}),d?e.jsx(v,{to:`/channel-manage/${t}/listings`,className:"text-[11px] font-semibold text-primary",children:"View all listings"}):null]}),n.isLoading?e.jsx("div",{className:"space-y-2",children:Array.from({length:2}).map((l,g)=>e.jsxs("div",{className:"rounded-xl border border-border/50 bg-background/60 px-3 py-3",children:[e.jsx(N,{className:"h-4 w-24"}),e.jsx(N,{className:"mt-2 h-3 w-40"}),e.jsx(N,{className:"mt-2 h-3 w-28"})]},`listing-skeleton-${g}`))}):n.isError?e.jsxs("div",{className:"rounded-xl border border-border/60 bg-red-500/5 px-4 py-3 text-xs text-red-200",children:[e.jsx("p",{children:P(n.error,"Unable to load placements.")}),e.jsxs("button",{type:"button",onClick:()=>n.refetch(),className:"mt-2 inline-flex items-center gap-2 rounded-full border border-red-500/40 bg-red-500/10 px-3 py-1 text-[11px] font-semibold text-red-200",children:[e.jsx(ge,{size:12}),"Retry"]})]}):a.length>0?e.jsx("div",{className:"rounded-xl border border-border/60 bg-background/60 px-3 divide-y divide-border/40",children:a.map(l=>e.jsx(T,{channelId:t,listing:l},l.id))}):e.jsxs("div",{className:"rounded-xl border border-dashed border-border/60 bg-background/50 px-4 py-4 text-center",children:[e.jsx("p",{className:"text-xs font-semibold text-foreground",children:"No placements yet"}),e.jsx("p",{className:"mt-1 text-[11px] text-muted-foreground",children:"Create your first listing to start earning."}),e.jsx(v,{to:`/channel-manage/${t}/listings/create`,className:"mt-3 inline-flex items-center justify-center rounded-full bg-primary px-4 py-1.5 text-[11px] font-semibold text-primary-foreground",children:"Create listing"})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row",children:[e.jsx(v,{to:`/channel-manage/${t}/listings/create`,className:"flex-1 rounded-full border border-primary/40 bg-primary/10 px-4 py-2 text-center text-xs font-semibold text-primary",children:"Create listing"}),e.jsx(v,{to:`/channel-manage/${t}/listings`,className:f("flex-1 rounded-full border border-border/60 bg-background px-4 py-2 text-center text-xs font-semibold text-foreground",n.isLoading&&"pointer-events-none opacity-70"),children:"View all"})]})]})});D.displayName="ChannelListingsPreview";const Le=t=>["channelsList",t],Ie=(t,r=10)=>me({queryKey:Le(t),queryFn:({pageParam:n=1})=>se({...t,page:Number(n),limit:r}),getNextPageParam:n=>n.hasNext?n.page+1:void 0,initialPageParam:1});function Me({open:t,onOpenChange:r,title:n,children:a}){return e.jsx(ne,{open:t,onOpenChange:r,children:e.jsxs(ae,{children:[e.jsx(oe,{className:"fixed inset-0 z-40 bg-black/60"}),e.jsxs(ie,{className:"fixed inset-x-0 bottom-0 z-50 rounded-t-3xl border border-border/60 bg-card p-4 pb-[calc(var(--tg-content-safe-area-inset-bottom)+16px)] shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between pb-2",children:[e.jsx(de,{className:"text-sm font-semibold text-foreground",children:n}),e.jsx(le,{className:"rounded-full p-2 text-muted-foreground hover:text-foreground",children:e.jsx($,{size:16})})]}),e.jsx("div",{className:"pt-2",children:a})]})]})})}const Se="recent",$e="desc",Te=["DRAFT","PENDING_VERIFY","FAILED","REVOKED"],De=()=>e.jsxs("div",{className:"rounded-2xl border border-border/50 bg-card/80 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{className:"h-4 w-32"}),e.jsx(N,{className:"h-3 w-20"})]}),e.jsx(N,{className:"h-5 w-24 rounded-full"})]}),e.jsx("div",{className:"mt-4",children:e.jsx(N,{className:"h-16 rounded-xl"})})]});function Ke(){const[t,r]=i.useState("verified"),[n,a]=i.useState(null),[o,d]=i.useState(!1),[l,g]=i.useState(()=>new Set),[m,h]=i.useState(()=>new Set),u=Y(),j=i.useMemo(()=>({sort:Se,order:$e}),[]),{data:b,isLoading:c,isFetchingNextPage:E,fetchNextPage:F,hasNextPage:A,refetch:O,error:w}=Ie(j,10),R=i.useMemo(()=>b?.pages.flatMap(s=>s.items)??[],[b]),y=i.useMemo(()=>R.filter(s=>!l.has(s.id)),[R,l]),V=b?.pages?.[0]?.total??0;i.useEffect(()=>{w&&k.error(P(w,"Unable to load channels."))},[w]);const _=i.useMemo(()=>y.filter(s=>s.status==="VERIFIED"),[y]),U=i.useMemo(()=>y.filter(s=>Te.includes(s.status)),[y]),L=t==="verified"?_:U,z=t==="pending"?"No pending channels right now.":"No verified channels yet.",B=s=>{if(s.status==="PENDING_VERIFY"){u(`/channels/pending/${s.id}`,{state:{channel:s}});return}u(`/channel-manage/${s.id}/overview`,{state:{channel:s}})},q=i.useCallback(s=>{h(p=>{const x=new Set(p);return x.has(s)?x.delete(s):x.add(s),x})},[]),K=async()=>{if(n){d(!0);try{const s=await re({channelId:n.id});s.unlinked?(g(p=>{const x=new Set(p);return x.add(s.channelId),x}),k.success("Channel unlinked.")):k.error("Unable to unlink channel."),a(null)}catch(s){k.error(P(s,"Unable to unlink channel."))}finally{d(!1)}}};return e.jsxs("div",{className:"mx-auto flex w-full max-w-2xl flex-col gap-6 px-4 pb-16 pt-4",children:[c?e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((s,p)=>e.jsx(De,{},`channel-skeleton-${p}`))}):w?e.jsx(ee,{message:P(w,"Unable to load channels"),description:"Please try again in a moment.",onRetry:()=>O()}):y.length===0?e.jsxs("div",{className:"rounded-2xl border border-dashed border-border/60 bg-card/70 p-8 text-center",children:[e.jsx("div",{className:"mx-auto mb-3 flex h-14 w-14 items-center justify-center rounded-full bg-primary/10 text-2xl",children:"üì°"}),e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"No channels yet"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Connect your first Telegram channel to get started."}),e.jsx(v,{to:"/add-channel/step-1",className:"mt-4 inline-flex items-center justify-center rounded-full bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground",children:"Add Channel"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"border-t border-border/50",children:e.jsx("div",{className:"flex gap-6 bg-background/90 backdrop-blur-glass",children:["verified","pending"].map(s=>e.jsxs("button",{onClick:()=>r(s),className:`py-3 text-sm font-medium border-b-2 transition-colors ${t===s?"text-primary border-b-primary":"text-muted-foreground border-b-transparent"}`,children:[s.charAt(0).toUpperCase()+s.slice(1)," "]},s))})}),L.length>0?e.jsx("div",{className:"space-y-3",children:L.map(s=>{const p=m.has(s.id),x=s.status==="VERIFIED";return e.jsx(Pe,{channel:s,onClick:()=>B(s),onVerify:()=>u(`/channels/pending/${s.id}`,{state:{channel:s}}),onUnlink:t==="pending"?()=>{a(s)}:void 0,isExpanded:p,onToggleExpand:x?()=>q(s.id):void 0,expandDisabled:!x,expandTooltip:x?void 0:"Verify channel to add placements",expandedContent:x?e.jsx(D,{channelId:s.id,isExpanded:p}):null},s.id)})}):e.jsx("p",{className:"rounded-xl border border-dashed border-border/60 bg-card/70 px-4 py-3 text-xs text-muted-foreground",children:z})]}),y.length>0?e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Showing ",y.length," of ",V]}),A?e.jsxs("button",{type:"button",onClick:()=>F(),disabled:E,className:"inline-flex items-center gap-2 rounded-full border border-border/60 bg-card/80 px-4 py-2 text-xs font-semibold text-foreground transition hover:bg-card",children:[E?e.jsx(H,{size:14,className:"animate-spin"}):null,E?"Loading":"Load more"]}):null]}):null,e.jsx("button",{type:"button",onClick:()=>u("/add-channel/step-1"),className:"fixed bottom-[calc(var(--tg-content-safe-area-inset-bottom)+120px)] right-4 z-40 flex h-12 w-12 items-center justify-center rounded-full bg-primary text-primary-foreground shadow-lg shadow-primary/30 transition hover:bg-primary/90","aria-label":"Add channel",children:e.jsx(ce,{size:18})}),e.jsxs(Me,{open:!!n,onOpenChange:s=>{s||a(null)},title:"–û—Ç–∫—Ä–µ–ø–∏—Ç—å –∫–∞–Ω–∞–ª?",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["–í—ã —Ö–æ—Ç–∏—Ç–µ –æ—Ç–∫—Ä–µ–ø–∏—Ç—å –∫–∞–Ω–∞–ª"," ",e.jsxs("span",{className:"font-semibold text-foreground",children:["@",n?.username]}),"?"]}),e.jsxs("div",{className:"mt-4 flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>a(null),className:"flex-1 rounded-full border border-border/60 bg-background px-4 py-2 text-sm font-semibold text-foreground",disabled:o,children:"–û—Ç–º–µ–Ω–∞"}),e.jsx("button",{type:"button",onClick:K,className:"flex-1 rounded-full bg-red-500 px-4 py-2 text-sm font-semibold text-white transition hover:bg-red-600 disabled:cursor-not-allowed disabled:opacity-70",disabled:o,children:o?"–û—Ç–∫—Ä–µ–ø–ª—è–µ–º...":"–û—Ç–∫—Ä–µ–ø–∏—Ç—å"})]})]})]})}export{Ke as default};
