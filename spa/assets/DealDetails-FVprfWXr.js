import{c as k,j as e,u as q,r as u,p as F,q as R,s as z,o as d}from"./index-BN4WV44g.js";import{D as O,a as $,f as H,b as G}from"./time-BRRagMMy.js";import{b as K,c as Y,d as B,e as J,f as Q,h as X,i as Z,g as ee,j as te,U as se}from"./hooks-Hi0FZaTa.js";import{b as re,a as ne}from"./payment-BuGK4VCJ.js";import{L as ae}from"./LoadingSkeleton-Czkd-jP0.js";import{E as ie,g as C}from"./errors-Bx3yXAW3.js";import"./useQuery-CY6gKigB.js";import"./useMutation-CrwBiL8O.js";import"./mockChannels-BOQTRySQ.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],P=k("copy",oe);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],de=k("link",le);function ce({status:n,tone:r,title:s,username:c,verified:x,price:p,dealId:f,avatarUrl:i,statusDescription:t}){return e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-secondary/60 text-xl",children:i?i.startsWith("http")?e.jsx("img",{src:i,alt:s,className:"h-full w-full rounded-full object-cover"}):i:s.slice(0,1)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:[e.jsx("span",{children:s}),x?e.jsx("span",{className:"inline-flex h-4 w-4 items-center justify-center rounded-full bg-primary/20 text-[10px] text-primary",children:"✓"}):null]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",c]})]}),e.jsxs("div",{className:"text-right text-xs text-muted-foreground",children:[e.jsx("p",{className:"font-semibold text-foreground",children:p}),e.jsx("p",{children:f})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx(O,{label:n,tone:r}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t})]})]})}function m({title:n,children:r}){return e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("p",{className:"text-sm font-semibold text-foreground",children:n})}),e.jsx("div",{className:"mt-3 space-y-2 text-xs text-muted-foreground",children:r})]})}function ue({items:n}){return e.jsxs("div",{className:"rounded-2xl border border-border/50 bg-card/80 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Timeline"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[n.length," steps"]})]}),e.jsx("div",{className:"mt-3 grid grid-cols-2 gap-2 sm:grid-cols-3 lg:grid-cols-1",children:n.map(r=>e.jsxs("div",{className:`flex items-center gap-2 rounded-xl border px-2.5 py-2 text-xs ${r.state==="completed"?"border-emerald-500/40 bg-emerald-500/10 text-emerald-100":r.state==="current"?"border-primary/50 bg-primary/10 text-primary-foreground":"border-border/60 bg-background/40 text-muted-foreground"}`,children:[e.jsx("div",{className:`flex h-5 w-5 items-center justify-center rounded-full text-[10px] font-semibold ${r.state==="completed"?"bg-emerald-500/80 text-emerald-950":r.state==="current"?"bg-primary/80 text-primary-foreground":"border border-border/70 text-muted-foreground"}`,children:r.state==="completed"?"✓":r.state==="current"?"•":""}),e.jsx("p",{className:"text-xs font-medium",children:r.label})]},r.label))})]})}function Ne(){const{dealId:n}=q(),[r,s]=u.useState(!1),[c,x]=u.useState(!1),p=F(),[f]=R(),{open:i}=z(),{data:t,isLoading:S,error:h,refetch:M}=K(n),y=Y(),g=B(),j=J(),N=Q(),v=X(),w=Z(),o=r||y.isPending||g.isPending||j.isPending||N.isPending||v.isPending||w.isPending,l=u.useMemo(()=>t?ee(t):null,[t]),E=u.useMemo(()=>t?te(t):[],[t]),T=$(t?.post?.verifyUntil),V=async()=>{if(t){s(!0);try{await y.mutateAsync(t.id)}finally{s(!1)}}},D=async()=>{if(t){s(!0);try{await g.mutateAsync({id:t.id,note:"Please tweak the CTA and shorten the headline."})}finally{s(!1)}}},I=async()=>{if(!t)return;const a=t.escrow?.depositAddress;if(!a){d.error("Payment address is missing");return}const b=t.escrow?.amountTon??t.priceTon;if(!Number.isFinite(b)||b<=0){d.error("Payment amount is invalid");return}if(!p){i(),d.info("Connect a TON wallet to continue");return}s(!0);try{await f.sendTransaction(ne({address:a,amountTon:b})),se&&await j.mutateAsync(t.id)}catch(W){d.error(C(W,"Unable to process payment"))}finally{s(!1)}},L=async()=>{if(t){s(!0);try{await N.mutateAsync(t.id)}finally{s(!1)}}},U=async()=>{if(t){s(!0);try{await v.mutateAsync(t.id)}finally{s(!1)}}},_=async()=>{if(t){s(!0);try{await w.mutateAsync(t.id)}finally{s(!1)}}},A=async a=>{a&&(await navigator.clipboard.writeText(a),d.success("Copied to clipboard"))};return e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx("div",{className:"px-4 py-6 space-y-4",children:S?e.jsx(ae,{items:3}):h||!t||!l?e.jsx(ie,{message:C(h,"Deal not found"),description:"We couldn't load this deal right now.",onRetry:()=>M()}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-4 lg:grid-cols-[minmax(0,1fr)_240px] lg:items-start",children:[e.jsx(ce,{status:l.label,tone:l.tone,title:t.channel.title,username:t.channel.username,verified:t.channel.isVerified,price:`${t.priceTon} TON`,dealId:t.id,avatarUrl:t.channel.avatarUrl,statusDescription:l.description}),e.jsx(ue,{items:E})]}),e.jsxs(m,{title:"Escrow",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-foreground",children:[e.jsx("span",{children:t.escrow?.status??"Awaiting payment"}),e.jsxs("span",{className:"font-semibold",children:[t.escrow?.amountTon??t.priceTon," TON"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Escrow holds funds safely until the post is verified."}),t.escrow?.status==="AWAITING_PAYMENT"?e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("button",{type:"button",onClick:I,disabled:o,className:"inline-flex w-full items-center justify-center rounded-xl bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground disabled:pointer-events-none disabled:opacity-70",children:"Pay via Telegram Wallet"}),e.jsx("a",{href:t.escrow.depositAddress?re({address:t.escrow.depositAddress,amountTon:t.escrow.amountTon,memo:t.escrow.memo}):void 0,className:"inline-flex w-full items-center justify-center rounded-xl border border-border/60 px-4 py-2 text-xs font-semibold text-foreground",children:"Open TON transfer link"}),e.jsxs("button",{type:"button",onClick:()=>x(a=>!a),className:"w-full rounded-xl border border-border/60 px-4 py-2 text-sm text-foreground",children:[c?"Hide":"Show"," manual transfer"]}),c?e.jsxs("div",{className:"space-y-2 rounded-xl border border-border/60 bg-background p-3 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Address"}),e.jsx("button",{type:"button",onClick:()=>A(t.escrow?.depositAddress),children:e.jsx(P,{size:14})})]}),e.jsx("p",{className:"break-all text-foreground",children:t.escrow?.depositAddress??"-"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Memo"}),e.jsx("button",{type:"button",onClick:()=>A(t.escrow?.memo),children:e.jsx(P,{size:14})})]}),e.jsx("p",{className:"text-foreground",children:t.escrow?.memo??"-"})]}):null,e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mock payments confirm after the wallet approval flow."})]}):null,e.jsx("div",{className:"mt-3 text-[11px] text-muted-foreground",children:H(t.updatedAt)})]}),e.jsxs(m,{title:"Creative",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:t.creative?.submittedAt?t.creative.approvedAt?"Approved":"Needs your review":"Waiting for channel owner"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.creative?.text??"Creative will appear here once submitted."}),t.creative?.submittedAt&&!t.creative?.approvedAt?e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:V,disabled:o,className:"rounded-full bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground",children:"Approve"}),e.jsx("button",{type:"button",onClick:D,disabled:o,className:"rounded-full border border-border/60 px-4 py-2 text-xs text-foreground",children:"Request edits"})]}):e.jsx("p",{className:"mt-3 text-[11px] text-muted-foreground",children:"Approvals are confirmed via bot messaging."})]}),e.jsxs(m,{title:"Schedule",children:[e.jsx("p",{className:"text-sm text-foreground",children:G(t.schedule?.scheduledAt)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Timezone: ",t.schedule?.timezone??"UTC"]})]}),e.jsxs(m,{title:"Delivery",children:[e.jsx("p",{className:"text-sm text-foreground",children:t.post?.viewUrl?"Post live":"Waiting for delivery"}),t.post?.viewUrl?e.jsxs("a",{href:t.post.viewUrl,target:"_blank",rel:"noreferrer",className:"mt-2 inline-flex items-center gap-2 text-xs text-primary",children:[e.jsx(de,{size:12})," View in Telegram"]}):null,e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:T?`Release in: ${T}`:"Verification pending"}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:L,disabled:o,className:"rounded-full border border-border/60 px-3 py-1 text-xs",children:"Simulate Post Published"}),e.jsx("button",{type:"button",onClick:U,disabled:o,className:"rounded-full border border-border/60 px-3 py-1 text-xs",children:"Simulate Verify Pass"}),e.jsx("button",{type:"button",onClick:_,disabled:o,className:"rounded-full border border-border/60 px-3 py-1 text-xs",children:"Simulate Verify Fail"})]})]}),e.jsx("div",{className:"sticky bottom-4 rounded-2xl border border-border/60 bg-card/90 px-4 py-3 backdrop-blur",children:e.jsx("button",{type:"button",className:"w-full rounded-xl bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground",children:l.ctaLabel})})]})})})}export{Ne as default};
