import{r as c,j as e,e as M,b as T,f as I,g as A}from"./index-D1JYa1Mh.js";import{E as B}from"./ErrorState-mrL9QHMX.js";import{L as $}from"./LoadingSkeleton-CVSMxmd8.js";import{g as G}from"./errors-3kY4UU5q.js";import{a as Q}from"./use-deals-Bl4twDB9.js";import"./skeleton-BKryotUH.js";import"./useQuery-onZHD_1B.js";import"./useMutation-CkFlFw74.js";import"./dealsApi-IR9uA1lc.js";const R=t=>{try{const a=BigInt(t),i=a/1000000000n,o=a%1000000000n;if(o===0n)return i.toString();const l=o.toString().padStart(9,"0").slice(0,2);return`${i.toString()}.${l}`}catch{return t}},j=t=>{if(!t)return"-";const a=new Date(t);return Number.isNaN(a.getTime())?t:a.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})},U={advertiser:"You are advertiser",publisher:"You are publisher",publisher_manager:"You manage this channel"},N=t=>t.replace(/_/g," "),F=({deal:t,onSelect:a})=>e.jsxs("button",{type:"button",onClick:()=>a(t),className:"w-full rounded-2xl border border-border/60 bg-card/80 p-4 text-left shadow-sm transition hover:border-primary/40 hover:bg-card",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center overflow-hidden rounded-full bg-secondary/60 text-lg font-semibold text-muted-foreground",children:t.channel.avatarUrl?e.jsx("img",{src:t.channel.avatarUrl,alt:t.channel.name,className:"h-full w-full object-cover"}):t.channel.name.slice(0,1)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:[e.jsx("span",{children:t.channel.name}),t.channel.verified?e.jsx("span",{className:"inline-flex items-center rounded-full bg-primary/15 px-2 py-0.5 text-[10px] font-semibold text-primary",children:"Verified"}):null]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",t.channel.username]})]})]}),e.jsxs("div",{className:"mt-4 grid gap-3 text-sm text-muted-foreground sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Price"}),e.jsxs("p",{className:"text-base font-semibold text-foreground",children:[R(t.listing.priceNano)," TON"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Format"}),e.jsx("p",{className:"text-sm font-semibold text-foreground",children:t.listing.format})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Placement"}),e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:["Pinned ",t.listing.placementHours,"h"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Lifetime"}),e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:["Visible ",t.listing.lifetimeHours,"h"]})]})]}),t.listing.tags.length>0?e.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:t.listing.tags.map(i=>e.jsxs("span",{className:"rounded-full bg-secondary/60 px-3 py-1 text-xs font-medium text-foreground",children:["#",i]},i))}):null,e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[e.jsx("span",{className:"rounded-full bg-primary/10 px-3 py-1 text-xs font-semibold text-primary",children:N(t.status)}),e.jsx("span",{className:"rounded-full bg-foreground/5 px-3 py-1 text-xs font-semibold text-foreground",children:N(t.escrowStatus)})]}),e.jsxs("div",{className:"mt-4 grid gap-2 text-xs text-muted-foreground sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-foreground",children:"Created:"})," ",j(t.createdAt)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-foreground",children:"Scheduled:"})," ",j(t.scheduledAt)]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Role:"})," ",U[t.userRoleInDeal]]})]})]}),Y=c.memo(F),p=5,g=()=>({items:[],page:1,limit:p,total:0}),h=(t,a)=>{if(a.page<=1)return{...a,items:a.items};const i=new Set(t.items.map(l=>l.id)),o=[...t.items];return a.items.forEach(l=>{i.has(l.id)||o.push(l)}),{...a,items:o}},y={pending:"Pending",active:"Active",completed:"Completed"};function X(){const t=M(),a=T(),i=I(),o=a.state?.activeTab,[l,f]=c.useState(o??"pending"),[x,v]=c.useState({pending:1,active:1,completed:1}),[w,L]=c.useState({pending:g(),active:g(),completed:g()}),D=c.useMemo(()=>({role:"all",pendingPage:x.pending,pendingLimit:p,activePage:x.active,activeLimit:p,completedPage:x.completed,completedLimit:p}),[x]),{data:r,isLoading:b,isFetching:d,error:u,refetch:S}=Q(D);c.useEffect(()=>{if(!r)return;[...r.pending.items,...r.active.items,...r.completed.items].forEach(n=>{i.setQueryData(["dealById",n.id],n)}),L(n=>({pending:r.pending.page===n.pending.page&&r.pending.total===n.pending.total&&r.pending.items.length===n.pending.items.length?n.pending:h(n.pending,r.pending),active:r.active.page===n.active.page&&r.active.total===n.active.total&&r.active.items.length===n.active.items.length?n.active:h(n.active,r.active),completed:r.completed.page===n.completed.page&&r.completed.total===n.completed.total&&r.completed.items.length===n.completed.items.length?n.completed:h(n.completed,r.completed)}))},[r]),c.useEffect(()=>{o&&f(o)},[o]),c.useEffect(()=>{const s=A();!s?.MainButton?.showProgress||!s.MainButton.hideProgress||(d?s.MainButton.showProgress(!0):s.MainButton.hideProgress())},[d]);const P=c.useCallback(s=>{v(n=>({...n,[s]:n[s]+1}))},[]),k=c.useCallback(s=>{i.setQueryData(["dealById",s.id],s),t(`/deals/${s.id}`,{state:{deal:s}})},[t,i]),m=w[l],E=m.items.length<m.total,C=!b&&!u&&m.items.length===0&&!d;return e.jsxs("div",{className:"w-full max-w-3xl mx-auto",children:[e.jsxs("div",{className:"px-4 pt-6",children:[e.jsx("h1",{className:"text-lg font-semibold text-foreground",children:"Deals"}),e.jsx("div",{className:"mt-4 flex gap-6 border-b border-border/60",children:Object.keys(y).map(s=>e.jsx("button",{type:"button",onClick:()=>f(s),className:`pb-3 text-sm font-semibold transition-colors ${l===s?"border-b-2 border-primary text-primary":"text-muted-foreground"}`,children:y[s]},s))})]}),e.jsx("div",{className:"px-4 py-6 space-y-4",children:b&&m.items.length===0?e.jsx($,{items:3}):u?e.jsx(B,{message:G(u,"Unable to load deals"),description:"Please try again in a moment.",onRetry:()=>S()}):C?e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-8 text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-14 w-14 items-center justify-center rounded-full bg-primary/10 text-2xl",children:"ðŸ“­"}),e.jsx("h2",{className:"text-base font-semibold text-foreground",children:"No deals yet"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Deals in this section will appear here once they are created."})]}):e.jsxs("div",{className:"space-y-4",children:[m.items.map(s=>e.jsx(Y,{deal:s,onSelect:k},s.id)),E?e.jsx("button",{type:"button",onClick:()=>P(l),disabled:d,className:"w-full rounded-xl border border-border/60 bg-background px-4 py-2 text-sm font-semibold text-foreground transition hover:bg-secondary/40 disabled:opacity-60",children:d?"Loading...":"Load more"}):null]})})]})}export{X as default};
