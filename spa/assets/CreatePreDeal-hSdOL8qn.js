import{d as h,u as x,r as n,j as e,b as l}from"./index-Z0mf_gh5.js";import{u as p}from"./useMutation-CTv5LU0H.js";import{p as f}from"./predealsApi-DIMWNb_h.js";import{S as b}from"./ScheduleDatePicker-Cfri_naX.js";import{E as g}from"./ErrorState-CHIonT5P.js";import{P as c}from"./PageContainer-CQPTOrdE.js";import{g as j}from"./errors-3kY4UU5q.js";import{t as S}from"./date-DTgQQEB1.js";import"./button-DpUMSmAY.js";import"./chevron-left-DhhQjgjU.js";function D(){const{listingId:a}=h(),i=x(),[r,u]=n.useState(null),o=p({mutationFn:f,onSuccess:s=>{i(`/deals/predeal/${s.id}`)},onError:s=>{l.error(j(s,"Unable to create pre-deal"))}}),t=n.useMemo(()=>{if(!r)return null;try{return S(r)}catch{return null}},[r]),d=n.useMemo(()=>t?new Date(t).getTime()>Date.now()+3600*1e3:!1,[t]),m=async()=>{if(a){if(!t){l.error("Please select a valid date and time.");return}if(!d){l.error("Scheduled time must be at least 1 hour from now.");return}if(!t.endsWith("Z"))throw console.error("Scheduled date must be UTC ISO:",t),new Error("Invalid datetime format");o.mutate({listingId:a,scheduledAt:t})}};return a?e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsxs(c,{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground",children:"Schedule ad post"}),e.jsx("h1",{className:"text-xl font-semibold text-foreground",children:"Choose when the post should be published"})]}),e.jsx("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-4 space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-semibold text-foreground",children:"Scheduled date & time"}),e.jsx("div",{className:"pb-safe-bottom rounded-2xl border border-border/60 bg-card/80 p-3",children:e.jsx(b,{value:r,onChange:u})}),!d&&r&&e.jsx("p",{className:"text-xs text-destructive",children:"Scheduled time must be at least 1 hour from now."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"We will remind the channel owner at the scheduled time."})]})}),e.jsx("button",{type:"button",onClick:m,disabled:!r||!d||o.isPending,className:"w-full rounded-lg bg-primary px-4 py-3 text-sm font-semibold text-primary-foreground transition disabled:opacity-60",children:o.isPending?"Scheduling...":"Continue"})]})}):e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx(c,{className:"py-6",children:e.jsx(g,{message:"Listing not selected",description:"Please return to the marketplace and select a listing to continue.",onRetry:()=>i("/marketplace")})})})}export{D as default};
