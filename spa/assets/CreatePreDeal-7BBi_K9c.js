import{d as x,u as p,r as d,j as e,R as c,b as i}from"./index-hL3AzeaV.js";import{u as f}from"./useMutation-D8gLmmlu.js";import{p as b}from"./predealsApi-Dhg4xByD.js";import{S as g}from"./ScheduleDatePicker-CSpa0Yxc.js";import{E as j}from"./ErrorState-CWOptztJ.js";import{P as u}from"./PageContainer-Cm-a9C2U.js";import{g as S}from"./errors-3kY4UU5q.js";import{t as N}from"./date-DTgQQEB1.js";import"./button-BUfQU0W0.js";import"./chevron-left-BfQy29tv.js";import"./input-DG6tBJtM.js";import"./Combination-BTwFOyC8.js";import"./index-DhSgTxf3.js";function U(){const{listingId:a}=x(),l=p(),[r,m]=d.useState(null),o=f({mutationFn:b,onSuccess:s=>{l(c.DEAL_PREDEAL(s.id))},onError:s=>{i.error(S(s,"Unable to create pre-deal"))}}),t=d.useMemo(()=>{if(!r)return null;try{return N(r)}catch{return null}},[r]),n=d.useMemo(()=>t?new Date(t).getTime()>Date.now()+3600*1e3:!1,[t]),h=async()=>{if(a){if(!t){i.error("Please select a valid date and time.");return}if(!n){i.error("Scheduled time must be at least 1 hour from now.");return}if(!t.endsWith("Z"))throw console.error("Scheduled date must be UTC ISO:",t),new Error("Invalid datetime format");o.mutate({listingId:a,scheduledAt:t})}};return a?e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsxs(u,{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground",children:"Schedule ad post"}),e.jsx("h1",{className:"text-xl font-semibold text-foreground",children:"Choose when the post should be published"})]}),e.jsx("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-4 space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-semibold text-foreground",children:"Scheduled date & time"}),e.jsx("div",{className:"pb-safe-bottom rounded-2xl border border-border/60 bg-card/80 p-3",children:e.jsx(g,{value:r,onChange:m})}),!n&&r&&e.jsx("p",{className:"text-xs text-destructive",children:"Scheduled time must be at least 1 hour from now."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"We will remind the channel owner at the scheduled time."})]})}),e.jsx("button",{type:"button",onClick:h,disabled:!r||!n||o.isPending,className:"w-full rounded-lg bg-primary px-4 py-3 text-sm font-semibold text-primary-foreground transition disabled:opacity-60",children:o.isPending?"Scheduling...":"Continue"})]})}):e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx(u,{className:"py-6",children:e.jsx(j,{message:"Listing not selected",description:"Please return to the marketplace and select a listing to continue.",onRetry:()=>l(c.MARKETPLACE)})})})}export{U as default};
