import{u}from"./useQuery-BMygtY2j.js";import{e as d}from"./index-CobCbkwI.js";import{u as m}from"./useMutation-Cvb_cUX3.js";const g=()=>"".replace(/\/+$/,""),o=g(),l=!1;const i=(e,a)=>{},c=(e,a)=>{if(!e||typeof e!="object")return a;const t=e;return typeof t.message=="string"&&t.message.trim().length>0?t.message:typeof t.error=="string"&&t.error.trim().length>0?t.error:t.error&&typeof t.error=="object"&&typeof t.error.message=="string"&&t.error.message.trim().length>0?t.error.message:a},s=e=>({items:Array.isArray(e?.items)?e?.items:[],page:typeof e?.page=="number"?e.page:1,limit:typeof e?.limit=="number"?e.limit:10,total:typeof e?.total=="number"?e.total:0});const p=async e=>{try{const a={data:e};i("createDeal request",a);const t=await fetch(`${o}/deals/create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),r=await t.json();if(i("createDeal response",r),!t.ok)throw new Error(c(r,"Unable to create deal"));return r}catch(a){throw a instanceof Error?a:new Error("Unable to create deal")}},f=async(e={})=>{const a={role:e.role??"all",pendingPage:e.pendingPage,pendingLimit:e.pendingLimit,activePage:e.activePage,activeLimit:e.activeLimit,completedPage:e.completedPage,completedLimit:e.completedLimit};try{const t={data:a};i("fetchDealsList request",t);const r=await fetch(`${o}/deals/list`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await r.json();if(i("fetchDealsList response",n),!r.ok)throw new Error(c(n,"Unable to load deals"));return{pending:s(n.pending),active:s(n.active),completed:s(n.completed)}}catch(t){throw t instanceof Error?t:new Error("Unable to load deals")}},v=e=>u({queryKey:["deals",e.role??"all",e.pendingPage??1,e.activePage??1,e.completedPage??1],queryFn:()=>f(e),staleTime:2e4,refetchOnWindowFocus:!1}),w=()=>{const e=d();return m({mutationFn:a=>p(a),onSuccess:()=>{e.invalidateQueries({queryKey:["deals"]})}})};export{v as a,w as u};
