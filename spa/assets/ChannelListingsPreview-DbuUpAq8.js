import{c as C,a as j,r as b,j as e,h as v,e as _,t as R}from"./index-jdzU34Hn.js";import{a as N,f as q}from"./formatters-B6oyEeL1.js";import{b as B,c as H,h as P,f as V,g as z,a as F}from"./labels-EEWNt0UM.js";import{g as w}from"./tagOptions-DHtvjoWf.js";import{C as U}from"./chevron-down-Dqd2CSGT.js";import{u as K}from"./useQuery-7q6u7fuu.js";import{l as W}from"./listingsApi-CwGPVIL9.js";import{S as y}from"./skeleton-n7JSj-SM.js";import{g as G}from"./errors-3kY4UU5q.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Q=C("pencil-line",O);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],J=C("refresh-ccw",X),E=3,$=t=>{const r=t.map(s=>s.trim()).filter(Boolean),d=Array.from(new Set(r));return{visible:d.slice(0,E),hiddenCount:Math.max(d.length-E,0)}},Y=({listings:t})=>{const{t:r,language:d}=j();return t.length===0?e.jsx("div",{className:"rounded-xl border border-dashed border-border/60 bg-background/50 px-4 py-4 text-center text-xs text-muted-foreground",children:r("marketplace.emptyPlacements")}):e.jsx("div",{className:"space-y-3",children:t.map(s=>{const a=$(s.tags??[]),l=[s.allowEdits?B(r,!0):null,s.allowLinkTracking?H(r,!0):null].filter(Boolean),n=N(s.priceNano,d)??s.priceNano,o=s.pinDurationHours?`${r("listings.meta.pinned")} ${P(s.pinDurationHours,r)}`:r("listings.meta.notPinned"),i=`${r("listings.meta.visible")} ${P(s.visibilityDurationHours,r)}`,u=s.contentRulesText?.trim();return e.jsxs("div",{className:"rounded-xl border border-border/60 bg-card/80 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-sm font-semibold text-foreground",children:[n," ",r("common.ton")]}),e.jsx("span",{className:"rounded-full border border-border/60 bg-muted/40 px-2 py-0.5 text-[10px] font-semibold text-muted-foreground",children:V(r,s.format)})]}),e.jsxs("div",{className:"mt-2 text-[11px] text-muted-foreground",children:[o," • ",i]}),l.length>0?e.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-[11px] text-muted-foreground",children:l.map(c=>e.jsx("span",{className:"rounded-full border border-border/60 bg-muted/30 px-2 py-0.5",children:c},c))}):null,a.visible.length>0?e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-[11px] text-muted-foreground",children:[a.visible.map(c=>e.jsx("span",{className:"rounded-full border border-border/60 bg-card px-2 py-0.5 text-foreground",children:w(c,r)},`${s.id}-${c}`)),a.hiddenCount>0?e.jsxs("span",{className:"rounded-full border border-border/60 bg-card px-2 py-0.5",children:["+",a.hiddenCount]}):null]}):null,u?e.jsx("p",{className:"mt-2 line-clamp-2 text-[11px] text-muted-foreground",children:u}):null]},s.id)})})};function ue({channel:t,onClick:r,actions:d,isExpanded:s,onToggleExpand:a,expandedContent:l}){const{t:n,language:o}=j(),[i,u]=b.useState(!1),[c,x]=b.useState(!1),m=s??i,g=!!(a||l||t.listingsPreview),f=b.useMemo(()=>t.minPriceNano?N(t.minPriceNano,o):null,[t.minPriceNano,o]),h=$(t.tags??[]),L=t.username?`@${t.username.replace(/^@/,"")}`:null,T=t.name?.[0]?.toUpperCase()??n("common.avatarFallback"),k=!c&&t.avatarUrl?t.avatarUrl:null,A=t.placementsCount!=null?t.placementsCount.toString():n("common.emptyValue"),M=typeof t.subscribers=="number"?q(t.subscribers,o):n("common.emptyValue"),S=p=>{p.stopPropagation(),a?a():u(I=>!I)};return e.jsxs("div",{className:v("w-full rounded-2xl border border-border/50 bg-card/80 p-4 text-left shadow-sm transition",r&&"cursor-pointer hover:border-border/80 hover:bg-card"),role:r?"button":void 0,tabIndex:r?0:void 0,onClick:r,onKeyDown:p=>{r&&(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),r())},children:[e.jsxs("div",{className:"flex items-start gap-3",children:[k?e.jsx("img",{src:k,alt:t.name,className:"h-12 w-12 rounded-full object-cover",onError:()=>x(!0)}):e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-primary/30 via-secondary/50 to-secondary text-lg text-foreground",children:T}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:t.name}),L?e.jsx("span",{className:"text-xs text-muted-foreground",children:L}):null]}),e.jsxs("div",{className:"flex items-center gap-2",children:[d,g?e.jsx("button",{type:"button",onClick:S,"aria-expanded":m,className:"inline-flex h-8 w-8 items-center justify-center rounded-lg border border-border/60 bg-secondary/40 text-muted-foreground transition hover:text-foreground",children:e.jsx(U,{size:16,className:v("transition-transform duration-200",m&&"rotate-180")})}):null]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[A," ",n("marketplace.placements")]}),e.jsx("span",{children:"·"}),e.jsxs("span",{children:[M," ",n("marketplace.subscribers")]})]}),e.jsx("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:e.jsxs("span",{children:[n("common.from")," ",e.jsxs("span",{className:"font-semibold text-primary",children:[f??n("common.emptyValue")," ",n("common.ton")]})]})}),h.visible.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px] text-muted-foreground",children:[h.visible.map(p=>e.jsx("span",{className:"rounded-full border border-border/60 bg-card px-2.5 py-1 text-foreground",children:w(p,n)},`${t.id}-${p}`)),h.hiddenCount>0?e.jsxs("span",{className:"rounded-full border border-border/60 bg-card px-2.5 py-1 text-muted-foreground",children:["+",h.hiddenCount]}):null]}):null]})]}),g?e.jsx("div",{className:v("overflow-hidden transition-all duration-300",m?"mt-4 max-h-[1200px] opacity-100":"max-h-0 opacity-0"),children:e.jsx("div",{className:"rounded-2xl border border-border/60 bg-background/60 p-3",children:l||e.jsx(Y,{listings:t.listingsPreview??[]})})}):null]})}const Z=5,ee=3,re=t=>{const r=t.slice(0,2),d=t.length-r.length;return{shown:r,remaining:d}},D=b.memo(({channelId:t,listing:r,rootBackTo:d,mode:s})=>{const{t:a,language:l}=j(),n=r.pinDurationHours?z(a,r.pinDurationHours):a("listings.meta.notPinned"),o=F(a,r.visibilityDurationHours),i=re(r.tags??[]),u=r.isActive===!1;return e.jsxs("div",{className:v("flex items-center gap-3 py-3",s==="owner"&&u&&"opacity-60"),children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"text-sm font-semibold text-foreground",children:[N(r.priceNano,l)," ",a("common.ton")]}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:[n," • ",o]}),i.shown.length>0?e.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[i.shown.map(c=>e.jsx("span",{className:"rounded-full border border-border/60 bg-muted/30 px-2 py-0.5 text-[10px] text-muted-foreground",children:w(c,a)},c)),i.remaining>0?e.jsxs("span",{className:"rounded-full border border-border/60 bg-muted/30 px-2 py-0.5 text-[10px] text-muted-foreground",children:["+",i.remaining]}):null]}):null]}),s==="owner"?e.jsx(R,{to:`/channel-manage/${t}/listings/${r.id}/edit`,state:d?{rootBackTo:d}:void 0,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-border/60 bg-background text-muted-foreground transition hover:text-foreground","aria-label":a("listings.editAction"),children:e.jsx(Q,{size:14})}):null]})});D.displayName="ListingPreviewRow";const te=b.memo(({channelId:t,isExpanded:r,onSummaryChange:d,mode:s="owner"})=>{const a=_(),{t:l}=j(),n=a.state?.rootBackTo,o=K({queryKey:["channelListingsPreview",t],queryFn:()=>W({channelId:t,page:1,limit:Z,onlyActive:!0,sort:"recent"}),enabled:r,staleTime:1e3*60*5}),i=o.data?.items??[],u=o.data?.total??i.length;b.useEffect(()=>{if(!o.data)return;const x=i.reduce((m,g)=>{try{const f=BigInt(g.priceNano);return m===null||f<m?f:m}catch{return m}},null);d?.({placementsCount:u,minPriceNano:x?x.toString():null})},[i,d,o.data,u]);const c=b.useMemo(()=>i.slice(0,ee),[i]);return e.jsx("div",{className:"space-y-3",children:o.isLoading?e.jsx("div",{className:"space-y-2",children:Array.from({length:2}).map((x,m)=>e.jsxs("div",{className:"rounded-xl border border-border/50 bg-background/60 px-3 py-3",children:[e.jsx(y,{className:"h-4 w-24"}),e.jsx(y,{className:"mt-2 h-3 w-40"}),e.jsx(y,{className:"mt-2 h-3 w-28"})]},`listing-skeleton-${m}`))}):o.isError?e.jsxs("div",{className:"rounded-xl border border-border/60 bg-red-500/5 px-4 py-3 text-xs text-red-200",children:[e.jsx("p",{children:G(o.error,l("marketplace.listingsLoadFailed"))}),e.jsxs("button",{type:"button",onClick:()=>o.refetch(),className:"mt-2 inline-flex items-center gap-2 rounded-lg border border-red-500/40 bg-red-500/10 px-3 py-1 text-[11px] font-semibold text-red-200",children:[e.jsx(J,{size:12}),l("common.retry")]})]}):c.length>0?e.jsx("div",{className:"rounded-xl border border-border/60 bg-background/60 px-3 divide-y divide-border/40",children:c.map(x=>e.jsx(D,{channelId:t,listing:x,rootBackTo:n,mode:s},x.id))}):e.jsxs("div",{className:"rounded-xl border border-dashed border-border/60 bg-background/50 px-4 py-4 text-center",children:[e.jsx("p",{className:"text-xs font-semibold text-foreground",children:l("channels.emptyListingsTitle")}),e.jsx("p",{className:"mt-1 text-[11px] text-muted-foreground",children:l("channels.emptyListingsSubtitle")})]})})});te.displayName="ChannelListingsPreview";export{ue as C,te as a};
