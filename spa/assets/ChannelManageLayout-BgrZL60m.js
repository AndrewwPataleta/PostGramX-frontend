import{b as w,d as C,u as E,r as i,j as e,L as I,N as R,O as V,a as k}from"./index-BH0ZQ4_d.js";import{u as L,R as P,g as D,a as $}from"./useVerifyChannel-DY4kNVBw.js";import{m as b}from"./managedChannels-FAMZ8sT_.js";import{P as h}from"./PageContainer-DV6XqkAc.js";import"./useMutation-B8rWQHDA.js";import"./channelsApi-CiIMGA_m.js";const F=s=>({id:s.id,name:s.title||"Untitled channel",username:s.username.startsWith("@")?s.username:`@${s.username}`,avatar:"ðŸ“£",status:s.status,verified:s.status==="VERIFIED",subscribers:s.memberCount??0,activeDeals:0,description:void 0}),T=()=>{const{id:s}=w(),o=C(),p=E(),{mutateAsync:g,isPending:m}=L(),[u,c]=i.useState(null),n=i.useMemo(()=>o.state?.channel??null,[o.state]),l=o.state?.rootBackTo,d=i.useMemo(()=>n?F(n):null,[n]),[r,x]=i.useState(()=>s?d??b[s]??null:null);i.useEffect(()=>{if(!s){x(null);return}const t=d??b[s]??null;x(a=>t||(a?.id===s?a:null))},[d,s]);const y=r?.status==="PENDING_VERIFY";if(!r)return e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx(h,{className:"py-6",children:e.jsx("p",{className:"text-muted-foreground",children:"Channel not found"})})});const j=async()=>{if(s){c(null);try{const t=await g(s);if(t.status==="VERIFIED"){const f=n?{...n,status:"VERIFIED"}:void 0;p(`/channel-manage/${s}/listings`,{replace:!0,state:f?{channel:f,rootBackTo:l}:l?{rootBackTo:l}:void 0});return}const a=D(t,"Verification failed. Please check your bot permissions and retry.");c(a)}catch(t){const a=$(t,"Unable to verify the channel right now.");c(a),k.error(a)}}},v=`/channel-manage/${r.id}`,N={channel:r};return e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsxs(h,{className:"pt-6",children:[e.jsxs("div",{className:"py-6 bg-gradient-to-b from-card/50 to-transparent",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-primary/40 to-accent/40 flex items-center justify-center text-4xl flex-shrink-0",children:r.avatar}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("h2",{className:"text-xl font-bold text-foreground",children:r.name})}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:r.username}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.subscribers.toLocaleString()," subscribers"]})]})]}),y?e.jsxs("div",{className:"rounded-2xl border border-yellow-500/40 bg-yellow-500/10 px-4 py-3 text-xs text-yellow-100",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-yellow-100",children:"Channel not verified yet."}),e.jsx("p",{className:"text-yellow-100/80",children:"Add the bot as admin and enable â€œPost messagesâ€, then retry verification."})]}),e.jsxs("button",{type:"button",onClick:j,disabled:m,className:"inline-flex items-center justify-center gap-2 rounded-lg bg-yellow-500/80 px-4 py-2 text-xs font-semibold text-yellow-950 transition disabled:cursor-not-allowed disabled:opacity-70",children:[m?e.jsx(I,{size:14,className:"animate-spin"}):e.jsx(P,{size:14}),"Retry verification"]})]}),u?e.jsx("p",{className:"mt-2 text-[11px] text-yellow-100/80",children:u}):null]}):null]}),e.jsx("div",{className:"border-b border-border/50 bg-card/80 backdrop-blur-glass",children:e.jsx("div",{className:"flex gap-6",children:[{id:"listings",label:"Listings"},{id:"settings",label:"Settings"}].map(t=>e.jsx(R,{to:`${v}/${t.id}`,state:n||l?{channel:n??void 0,rootBackTo:l}:void 0,className:({isActive:a})=>`py-3 font-medium text-sm border-b-2 transition-colors ${a?"text-primary border-b-primary":"text-muted-foreground border-b-transparent hover:text-foreground"}`,children:t.label},t.id))})}),e.jsx("div",{className:"py-6 space-y-4",children:e.jsx(V,{context:N})})]})})};export{T as default};
