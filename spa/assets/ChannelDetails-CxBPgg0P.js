import{a as C,b as P,r as o,j as e,d as g}from"./index-D1JYa1Mh.js";import{E as D}from"./ErrorState-mrL9QHMX.js";import{u as T}from"./use-deals-Bl4twDB9.js";import{f as h,n as j}from"./ton-ClBVV2oW.js";import{C as L}from"./check-BW_IUSI9.js";import"./useQuery-onZHD_1B.js";import"./useMutation-CkFlFw74.js";import"./dealsApi-IR9uA1lc.js";const N=a=>a>=168&&a%24===0?`${a/24}d`:`${a}h`;function R(){const{channelId:a}=C(),r=P().state?.channel,c=o.useRef(null),[x,m]=o.useState(null),u=T(),t=(r?.listings??[]).filter(s=>s.isActive!==!1),p=t.reduce((s,l)=>{const n=BigInt(l.priceNano);return s===null||n<s?n:s},null),b=p?h(j(p)):null,i=t[0],v=t.some(s=>s.pinDurationHours!==null),d=u.isPending,f=async s=>{if(!d){m(s);try{await u.mutateAsync({listingId:s})}finally{m(null)}}},y=o.useMemo(()=>t.map(s=>({...s,priceTon:`${h(j(s.priceNano))} TON`,tags:s.tags.map(l=>l.trim()).filter(Boolean)})),[t]),w=()=>{i&&(t.length===1?f(i.id):c.current?.scrollIntoView({behavior:"smooth",block:"start"}))};return e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx("div",{className:"px-4 py-6 space-y-4",children:!r||r.id!==a?e.jsx(D,{message:"Channel not found",description:"We couldn't load this channel."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-4",children:e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-start",children:[e.jsx("div",{className:"flex h-16 w-16 shrink-0 items-center justify-center rounded-2xl bg-primary/10 text-2xl",children:r.avatarUrl?e.jsx("img",{src:r.avatarUrl,alt:r.name,className:"h-16 w-16 rounded-2xl object-cover"}):r.name?.[0]?.toUpperCase()}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:r.name}),r.verified?e.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-primary/20 p-1",children:e.jsx(L,{size:14,className:"text-primary"})}):null]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",r.username]})]})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"rounded-xl border border-border/60 bg-card/80 p-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Subscribers"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-foreground",children:r.subscribers?`${Math.round(r.subscribers/1e3)}K`:"--"})]}),e.jsxs("div",{className:"rounded-xl border border-border/60 bg-card/80 p-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Placements"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-foreground",children:t.length})]}),e.jsxs("div",{className:"rounded-xl border border-border/60 bg-card/80 p-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pinned options"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-foreground",children:v?"Yes":"No"})]})]}),e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-6",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pricing"}),e.jsxs("div",{className:"mt-2 flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-semibold text-foreground",children:b??"--"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"TON per post"})]}),e.jsx("p",{className:"mt-3 text-sm text-muted-foreground",children:"Pricing includes escrow protection and bot-assisted messaging."}),e.jsxs("button",{type:"button",onClick:w,disabled:!i||d,className:"mt-5 inline-flex w-full items-center justify-center gap-2 rounded-xl bg-primary px-4 py-3 text-sm font-semibold text-primary-foreground disabled:opacity-60",children:[d&&x===i?.id?e.jsx(g,{size:16,className:"animate-spin"}):null,"Create Deal"]})]}),t.length>0?e.jsxs("div",{ref:c,className:"rounded-2xl border border-border/60 bg-card/80 p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Available placements"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.length," placements available"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"From"}),e.jsxs("p",{className:"text-lg font-semibold text-primary",children:[b??"--"," TON"]})]})]}),e.jsx("div",{className:"space-y-3",children:y.map(s=>{const l=d&&x===s.id;return e.jsxs("div",{className:"rounded-xl border border-border/60 bg-card/70 p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Price"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-foreground",children:s.priceTon})]}),e.jsxs("button",{type:"button",onClick:()=>f(s.id),disabled:d,className:"inline-flex items-center justify-center gap-2 rounded-xl bg-primary px-3 py-2 text-xs font-semibold text-primary-foreground disabled:opacity-60",children:[l?e.jsx(g,{size:14,className:"animate-spin"}):null,"Create Deal"]})]}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-3",children:[e.jsxs("div",{className:"rounded-lg border border-border/60 bg-card/60 p-3",children:[e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Placement"}),e.jsx("p",{className:"mt-1 text-xs font-semibold text-foreground",children:s.format})]}),e.jsxs("div",{className:"rounded-lg border border-border/60 bg-card/60 p-3",children:[e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Pinned"}),e.jsx("p",{className:"mt-1 text-xs font-semibold text-foreground",children:s.pinDurationHours?N(s.pinDurationHours):"Not pinned"})]}),e.jsxs("div",{className:"rounded-lg border border-border/60 bg-card/60 p-3",children:[e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Visible"}),e.jsx("p",{className:"mt-1 text-xs font-semibold text-foreground",children:N(s.visibilityDurationHours??24)})]})]}),s.tags.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2 text-[11px] text-foreground",children:s.tags.map(n=>e.jsx("span",{className:"rounded-full border border-border/60 bg-card px-2.5 py-1",children:n},`${s.id}-${n}`))})]}):null]},s.id)})})]}):e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-6 text-center",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"No listings yet"}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"This channel has no active placements available right now."})]})]})})})}export{R as default};
