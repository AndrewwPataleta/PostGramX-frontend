import{c as v,j as e,m as L,b as w,d as P,r as d,a as T,h as b}from"./index-BH0ZQ4_d.js";import{u as k}from"./useQuery-CkR1PhGD.js";import{f as M,n as S}from"./ton-ClBVV2oW.js";import{L as C}from"./LoadingSkeleton-dy-fDe52.js";import{l as $}from"./listingsApi-vjciYiKO.js";import{g as D}from"./errors-3kY4UU5q.js";import{P as E}from"./plus-kUAXzRu9.js";import"./skeleton-AzQV4uOo.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],A=v("square-pen",z),j=s=>s>=168&&s%24===0?`${s/24}d`:`${s}h`;function q({listing:s,variant:l="full",actionSlot:x}){const a=s.tags??[],r=[...new Set([...a.filter(t=>t==="Must be pre-approved"),...a.filter(t=>t!=="Must be pre-approved")])],n=l==="compact"?3:r.length,c=r.slice(0,n),o=Math.max(0,r.length-c.length),p=s.visibilityDurationHours??24,f=s.pinDurationHours?j(s.pinDurationHours):null,m=j(p),h=(()=>{if("priceNano"in s)try{return M(S(s.priceNano))}catch{return s.priceNano}return String(s.priceTon)})();return e.jsxs("div",{className:`rounded-2xl border border-border/60 bg-card/80 p-4 ${l==="compact"?"space-y-3":"space-y-4"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:["Post â€¢ ",h," TON"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l==="compact"?"Per post":"Per post offer"})]}),e.jsx("span",{className:`rounded-full px-2.5 py-1 text-[11px] font-semibold ${s.isActive?"bg-emerald-500/15 text-emerald-400":"bg-rose-500/15 text-rose-400"}`,children:s.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px]",children:[e.jsx("span",{className:"rounded-full bg-secondary/60 px-2.5 py-1 text-foreground",children:s.allowEdits?"Edits allowed":"No edits"}),e.jsx("span",{className:"rounded-full bg-secondary/60 px-2.5 py-1 text-foreground",children:s.allowLinkTracking?"Tracking allowed":"No tracking"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px] text-foreground",children:[f?e.jsxs("span",{className:"rounded-full bg-secondary/60 px-2.5 py-1",children:["Pinned: ",f]}):e.jsx("span",{className:"rounded-full bg-secondary/60 px-2.5 py-1",children:"Pinned: none"}),e.jsxs("span",{className:"rounded-full bg-secondary/60 px-2.5 py-1",children:["Visible: ",m]})]}),r.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px] text-foreground",children:[c.map(t=>{const u=t==="Must be pre-approved";return e.jsx("span",{className:`rounded-full border px-2.5 py-1 ${u?"border-primary/40 bg-primary/10 text-primary":"border-border/60 bg-card text-foreground"}`,children:t},t)}),o>0?e.jsxs("span",{className:"rounded-full border border-border/60 bg-card px-2.5 py-1 text-muted-foreground",children:["+",o]}):null]}):null,l==="full"&&x?e.jsx("div",{className:"flex gap-2",children:x}):null]})}const R=()=>{const{channel:s}=L(),{id:l}=w(),x=P(),a=l??s.id,r=x.state?.rootBackTo,[n,c]=d.useState(1),[o]=d.useState(10),[p,f]=d.useState(!0),[m,h]=d.useState("recent"),t=k({queryKey:["listingsByChannel",a,{page:n,limit:o,onlyActive:p,sort:m}],queryFn:()=>$({channelId:a,page:n,limit:o,onlyActive:p,sort:m})});d.useEffect(()=>{t.error&&T.error(D(t.error,"Unable to load listings"))},[t.error]);const u=t.data?.items??[],y=t.data?.total??0,g=d.useMemo(()=>Math.max(1,Math.ceil(y/o)),[y,o]),N=u.length>0;return e.jsxs(e.Fragment,{children:[t.isLoading?e.jsx(C,{items:3}):N?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:u.map(i=>e.jsx(q,{listing:i,variant:"full",actionSlot:e.jsxs(b,{to:`/channel-manage/${a}/listings/${i.id}/edit`,state:r?{rootBackTo:r}:void 0,className:"flex-1 flex items-center justify-center gap-2 bg-secondary hover:bg-secondary/80 text-foreground font-medium py-2 rounded-lg border border-border transition-colors text-sm",children:[e.jsx(A,{size:16}),"Edit"]})},i.id))}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Page ",n," of ",g]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>c(i=>Math.max(1,i-1)),disabled:n===1,className:"rounded-lg border border-border/60 px-3 py-1 text-xs disabled:opacity-50",children:"Previous"}),e.jsx("button",{type:"button",onClick:()=>c(i=>Math.min(g,i+1)),disabled:n>=g,className:"rounded-lg border border-border/60 px-3 py-1 text-xs disabled:opacity-50",children:"Next"})]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-secondary/30 flex items-center justify-center mx-auto mb-3",children:e.jsx("span",{className:"text-xl",children:"ðŸ“‹"})}),e.jsx("p",{className:"text-foreground font-semibold mb-2",children:"No listings yet"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-6",children:"Create your first listing to start receiving offers"}),e.jsx(b,{to:`/channel-manage/${a}/listings/create`,state:r?{rootBackTo:r}:void 0,className:"inline-flex items-center justify-center rounded-lg bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground",children:"Create listing"})]}),e.jsx(b,{to:`/channel-manage/${a}/listings/create`,state:r?{rootBackTo:r}:void 0,className:"fixed bottom-[calc(var(--tg-content-safe-area-inset-bottom)+120px)] right-4 z-40 flex h-12 w-12 items-center justify-center rounded-2xl bg-primary text-primary-foreground shadow-lg shadow-primary/30 transition hover:bg-primary/90","aria-label":"Create listing",children:e.jsx(E,{size:18})})]})};export{R as default};
