import{c as $,r as c,j as e,u as R,d as q,e as G,g as Q}from"./index-DZGA1NBZ.js";import{C as S}from"./chevron-down-46nWR7jq.js";import{E as U}from"./ErrorState-Cmsr11EF.js";import{L as C}from"./LoadingSkeleton-DkIOoSlc.js";import{P as F}from"./PageContainer-Cn7ceown.js";import{g as Y}from"./errors-3kY4UU5q.js";import{a as O}from"./use-deals-DutSMc36.js";import"./skeleton-DOKldGoA.js";import"./useQuery-CedHV08i.js";import"./useMutation-C5t9vioM.js";import"./dealsApi-BiolEavY.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]],M=$("megaphone",V);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]],P=$("shopping-cart",K),W=t=>{try{const n=BigInt(t),i=n/1000000000n,o=n%1000000000n;if(o===0n)return i.toString();const l=o.toString().padStart(9,"0").slice(0,2);return`${i.toString()}.${l}`}catch{return t}},T=t=>{if(!t)return"-";const n=new Date(t);return Number.isNaN(n.getTime())?t:n.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})},J=t=>{if(!t)return"-";const n=new Date(t);return Number.isNaN(n.getTime())?t:n.toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},X={advertiser:"You are advertiser",publisher:"You are publisher",publisher_manager:"You manage this channel"},Z={advertiser:"bg-primary/10 text-primary",publisher:"bg-emerald-500/10 text-emerald-400",publisher_manager:"bg-emerald-500/10 text-emerald-400"},E=t=>t.replace(/_/g," "),ee=({deal:t,onSelect:n})=>{const[i,o]=c.useState(!1),l=t.listing.lifetimeHours?`Visible ${t.listing.lifetimeHours}h`:null,u=t.listing.placementHours?`Pinned ${t.listing.placementHours}h`:null,m=[l,u].filter(Boolean).join(" • "),y=E(t.status),b=E(t.escrowStatus);return e.jsxs("div",{className:`w-full rounded-2xl border border-border/60 bg-card/80 p-4 text-left shadow-sm transition ${n?"cursor-pointer hover:border-primary/40 hover:bg-card":""}`,role:n?"button":void 0,tabIndex:n?0:void 0,onClick:()=>n(t),onKeyDown:d=>{n&&(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),n(t))},children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center overflow-hidden rounded-full bg-secondary/60 text-lg font-semibold text-muted-foreground",children:t.channel.avatarUrl?e.jsx("img",{src:t.channel.avatarUrl,alt:t.channel.name,className:"h-full w-full object-cover"}):t.channel.name.slice(0,1)}),e.jsx("div",{className:"min-w-0",children:e.jsx("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:e.jsx("span",{className:"truncate",children:t.channel.name})})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"rounded-full bg-primary/10 px-3 py-1 text-xs font-semibold text-primary",children:y}),e.jsx("p",{className:"mt-1 text-[11px] text-muted-foreground",children:b})]}),e.jsx("button",{type:"button",onClick:d=>{d.stopPropagation(),o(p=>!p)},"aria-expanded":i,className:"flex h-8 w-8 items-center justify-center rounded-lg border border-border/60 bg-background/70 text-muted-foreground transition hover:text-foreground",children:e.jsx(S,{size:16,className:`transition-transform ${i?"rotate-180":""}`})})]})]}),e.jsxs("div",{className:"mt-3 space-y-1",children:[e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:[W(t.listing.priceNano)," TON"]}),m?e.jsx("p",{className:"text-xs text-muted-foreground",children:m}):null,t.scheduledAt?e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Scheduled: ",J(t.scheduledAt)]}):null]}),e.jsxs("button",{type:"button",onClick:d=>{d.stopPropagation(),o(p=>!p)},className:"mt-3 flex w-full items-center justify-between rounded-lg border border-border/60 bg-background/60 px-3 py-2 text-xs font-semibold text-muted-foreground transition hover:text-foreground",children:[e.jsx("span",{children:i?"Hide details":"Show details"}),e.jsx(S,{size:14,className:`transition-transform ${i?"rotate-180":""}`})]}),i?e.jsxs("div",{className:"mt-3 space-y-3 text-xs text-muted-foreground",children:[e.jsxs("p",{children:["@",t.channel.username]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${Z[t.userRoleInDeal]}`,children:X[t.userRoleInDeal]}),e.jsx("span",{className:"rounded-full bg-foreground/5 px-3 py-1 text-xs font-semibold text-foreground",children:b})]}),e.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-foreground",children:"Created:"})," ",T(t.createdAt)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-foreground",children:"Scheduled:"})," ",T(t.scheduledAt)]})]}),t.listing.tags.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:t.listing.tags.map(d=>e.jsxs("span",{className:"rounded-full bg-secondary/60 px-3 py-1 text-xs font-medium text-foreground",children:["#",d]},d))}):null,e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("span",{className:"rounded-full bg-secondary/60 px-3 py-1 text-xs font-medium text-foreground",children:["Format: ",t.listing.format]}),e.jsx("span",{className:"rounded-full bg-secondary/60 px-3 py-1 text-xs font-medium text-foreground",children:u??"No pin"}),e.jsx("span",{className:"rounded-full bg-secondary/60 px-3 py-1 text-xs font-medium text-foreground",children:l??"No visibility info"})]})]}):null]})},I=c.memo(ee),j=5,w=()=>({items:[],page:1,limit:j,total:0}),D=(t,n)=>{if(n.page<=1)return{...n,items:n.items};const i=new Set(t.items.map(l=>l.id)),o=[...t.items];return n.items.forEach(l=>{i.has(l.id)||o.push(l)}),{...n,items:o}},A={pending:"Pending",active:"Active",completed:"Completed"};function xe(){const t=R(),n=q(),i=G(),o=n.state?.activeTab,[l,u]=c.useState(o??"pending"),[m,y]=c.useState({pending:1,active:1,completed:1}),[b,d]=c.useState({pending:w(),active:w(),completed:w()}),p=c.useMemo(()=>({role:"all",pendingPage:m.pending,pendingLimit:j,activePage:m.active,activeLimit:j,completedPage:m.completed,completedLimit:j}),[m]),{data:a,isLoading:k,isFetching:g,error:N,refetch:B}=O(p);c.useEffect(()=>{if(!a)return;[...a.pending.items,...a.active.items,...a.completed.items].forEach(r=>{i.setQueryData(["dealById",r.id],r)}),d(r=>({pending:a.pending.page===r.pending.page&&a.pending.total===r.pending.total&&a.pending.items.length===r.pending.items.length?r.pending:D(r.pending,a.pending),active:a.active.page===r.active.page&&a.active.total===r.active.total&&a.active.items.length===r.active.items.length?r.active:D(r.active,a.active),completed:a.completed.page===r.completed.page&&a.completed.total===r.completed.total&&a.completed.items.length===r.completed.items.length?r.completed:D(r.completed,a.completed)}))},[a]),c.useEffect(()=>{o&&u(o)},[o]),c.useEffect(()=>{const s=Q();!s?.MainButton?.showProgress||!s.MainButton.hideProgress||(g?s.MainButton.showProgress(!0):s.MainButton.hideProgress())},[g]);const z=c.useCallback(s=>{y(r=>({...r,[s]:r[s]+1}))},[]),L=c.useCallback(s=>{i.setQueryData(["dealById",s.id],s),t(`/deals/${s.id}`,{state:{deal:s,rootBackTo:"/deals"}})},[t,i]),x=b[l],{buyerDeals:h,sellerDeals:f}=c.useMemo(()=>{const s=x.items.filter(v=>v.userRoleInDeal==="advertiser"),r=x.items.filter(v=>v.userRoleInDeal!=="advertiser");return{buyerDeals:s,sellerDeals:r}},[x.items]),_=x.items.length<x.total,H=!k&&!N&&h.length===0&&f.length===0&&!g;return e.jsx("div",{className:"w-full max-w-3xl mx-auto",children:e.jsxs(F,{className:"pt-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-foreground",children:"Deals"}),e.jsx("div",{className:"mt-4 flex gap-6 border-b border-border/60",children:Object.keys(A).map(s=>e.jsx("button",{type:"button",onClick:()=>u(s),className:`pb-3 text-sm font-semibold transition-colors ${l===s?"border-b-2 border-primary text-primary":"text-muted-foreground"}`,children:A[s]},s))})]}),k&&x.items.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:[e.jsx(P,{size:14}),"Buying ads",e.jsx("span",{className:"text-[11px] font-normal",children:"·"}),e.jsx("span",{className:"text-[11px] font-normal",children:"--"})]}),e.jsx(C,{items:2})]}),e.jsx("div",{className:"border-t border-border/60"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:[e.jsx(M,{size:14}),"Selling ads",e.jsx("span",{className:"text-[11px] font-normal",children:"·"}),e.jsx("span",{className:"text-[11px] font-normal",children:"--"})]}),e.jsx(C,{items:2})]})]}):N?e.jsx(U,{message:Y(N,"Unable to load deals"),description:"Please try again in a moment.",onRetry:()=>B()}):H?e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-8 text-center",children:[e.jsx("h2",{className:"text-base font-semibold text-foreground",children:"No deals in this section"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Deals in this section will appear here once they are created."})]}):e.jsxs("div",{className:"space-y-5",children:[h.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:[e.jsx(P,{size:14}),"Buying ads",e.jsx("span",{className:"text-[11px] font-normal",children:"·"}),e.jsx("span",{className:"text-[11px] font-normal",children:h.length})]}),e.jsx("div",{className:"space-y-3",children:h.map(s=>e.jsx(I,{deal:s,onSelect:L},s.id))})]}):null,h.length>0&&f.length>0?e.jsx("div",{className:"border-t border-border/60"}):null,f.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:[e.jsx(M,{size:14}),"Selling ads",e.jsx("span",{className:"text-[11px] font-normal",children:"·"}),e.jsx("span",{className:"text-[11px] font-normal",children:f.length})]}),e.jsx("div",{className:"space-y-3",children:f.map(s=>e.jsx(I,{deal:s,onSelect:L},s.id))})]}):null,_?e.jsx("button",{type:"button",onClick:()=>z(l),disabled:g,className:"w-full rounded-lg border border-border/60 bg-background px-4 py-2 text-sm font-semibold text-foreground transition hover:bg-secondary/40 disabled:opacity-60",children:g?"Loading...":"Load more"}):null]})]})})}export{xe as default};
