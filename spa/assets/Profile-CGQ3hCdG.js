import{c as M,r as n,j as e,h as b,X as je,H as ve,p as Y,I as we,a as Te,J as Ce,i as Se,K as ke,b as i,T as Oe}from"./index-JWVuw5_E.js";import{A as K,a as V,b as H}from"./avatar-6TxmI4NL.js";import{u as J}from"./useQuery-BI2k5xJO.js";import{E as Ue}from"./ErrorState-BHYLKFy5.js";import{L as X}from"./LoadingSkeleton-CVSwAoGu.js";import{g as Ae}from"./errors-3kY4UU5q.js";import{I as O}from"./input-DgYB3lvu.js";import{P as Pe}from"./PageContainer-D4fjnPhF.js";import{R as Ie,P as Ee,C as Z,a as Me,T as ee,D as te,O as se}from"./index-TqV9w_sP.js";import{n as ae,f as re}from"./ton-ClBVV2oW.js";import{C as Re}from"./circle-check-BS685Ypv.js";import{R as We}from"./refresh-ccw-C688W1ri.js";import"./skeleton-Bjp2eVk5.js";import"./Combination-BAVYof9a.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Fe=M("clock",Le);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],_e=M("shield-check",$e);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],qe=M("wallet",ze),Be=a=>{const{address:s,amountTon:r,memo:o}=a,l=Math.round(r*1e9),d=new URLSearchParams;Number.isFinite(l)&&l>0&&d.set("amount",l.toString()),o&&d.set("text",o);const h=d.toString();return`ton://transfer/${s}${h?`?${h}`:""}`},De=a=>{const{address:s,amountTon:r}=a,o=Math.round(r*1e9);return{validUntil:Math.floor(Date.now()/1e3)+60,messages:[{address:s,amount:o.toString()}]}},Qe=async(a=250,s=500)=>{const r=Math.floor(Math.random()*(s-a+1))+a;await new Promise(o=>setTimeout(o,r))},Ke={balance:{available:124.5,locked:35,pendingRelease:12,instantWithdraw:18},transactions:[{type:"Deposit",amount:"+50 TON",status:"Confirmed",time:"Today · 12:08"},{type:"Escrow Lock",amount:"-35 TON",status:"Pending",time:"Today · 11:42"},{type:"Escrow Release",amount:"+35 TON",status:"Confirmed",time:"Yesterday · 18:20"},{type:"Withdrawal",amount:"-12 TON",status:"Processing",time:"Yesterday · 16:05"},{type:"Refund",amount:"+8 TON",status:"Confirmed",time:"Aug 20 · 09:45"}],topUpAddress:"EQABc7p8sT1h8Q8p2x9K4Qx9nX9z1q8Qx0Qx9nX9z1q8Qx0Qx",topUpMemo:"PGX-TOPUP"};console.info("MOCK MODE ENABLED for Profile");const Ve=async()=>(await Qe(),Ke),He={all:["profile"],overview:()=>["profile","overview"],balance:()=>["profile","balance"]},Xe=()=>J({queryKey:He.overview(),queryFn:Ve}),G=Ie,Ge=Ee,ne=n.forwardRef(({className:a,...s},r)=>e.jsx(se,{className:b("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s,ref:r}));ne.displayName=se.displayName;const Ye=ve("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),A=n.forwardRef(({side:a="right",className:s,children:r,...o},l)=>e.jsxs(Ge,{children:[e.jsx(ne,{}),e.jsxs(Z,{ref:l,className:b(Ye({side:a}),s),...o,children:[r,e.jsxs(Me,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));A.displayName=Z.displayName;const P=({className:a,...s})=>e.jsx("div",{className:b("flex flex-col space-y-2 text-center sm:text-left",a),...s});P.displayName="SheetHeader";const I=n.forwardRef(({className:a,...s},r)=>e.jsx(ee,{ref:r,className:b("text-lg font-semibold text-foreground",a),...s}));I.displayName=ee.displayName;const E=n.forwardRef(({className:a,...s},r)=>e.jsx(te,{ref:r,className:b("text-sm text-muted-foreground",a),...s}));E.displayName=te.displayName;const Je=async(a={})=>Y("/payments/payouts/channels",a),Ze=async a=>Y("/payments/payouts/withdraw",a),et=[10,25,50],tt=1000000000n,st=a=>{try{return re(ae(BigInt(a)))}catch{return a}},at=a=>{const s=a.trim();if(!s||s==="."||!/^\d*\.?\d*$/.test(s))return null;const[r,o=""]=s.split("."),l=r===""?"0":r,d=(o+"000000000").slice(0,9);return BigInt(l)*tt+BigInt(d)},U=a=>{if(!a)return 0n;try{return BigInt(a.availableNano)}catch{return 0n}};function bt(){const{user:a}=we(),{t:s,language:r,setLanguage:o}=Te(),{data:l,isLoading:d,error:h,refetch:oe}=Xe(),[u,le]=n.useState(50),[ie,de]=n.useState("50"),[R,v]=n.useState("idle"),[y,W]=n.useState(!1),[ce,w]=n.useState(!1),[me,T]=n.useState(!1),[L,f]=n.useState(""),[c,C]=n.useState(null),[F,$]=n.useState(!1),[N,pe]=n.useState(""),ue=Ce(),[xe]=Se(),{open:he}=ke(),S=a?`${a.first_name}${a.last_name?` ${a.last_name}`:""}`:s("profile.displayNameFallback"),fe=a?.username?`@${a.username}`:s("profile.usernameFallback"),ge=S.split(" ").filter(Boolean).slice(0,2).map(t=>t[0]?.toUpperCase()).join(""),k=l?.topUpAddress??"—",_=l?.topUpMemo??"—",m=J({queryKey:["payouts",N],queryFn:()=>Je(N.trim()?{q:N.trim()}:{}),refetchOnWindowFocus:!1}),z=m.data?.items??[],g=m.error instanceof Error?m.error:null;n.useEffect(()=>{g&&i.error(g.message)},[g]);const q=t=>{de(t);const x=Number(t);Number.isFinite(x)&&le(x)},B=async()=>{if(!Number.isFinite(u)||u<=0){i.error(s("profile.toastSelectValidTopUp"));return}if(!ue){he(),i.info(s("profile.toastConnectWallet"));return}W(!0),v("pending");try{await xe.sendTransaction(De({address:k,amountTon:u})),v("confirmed"),w(!1),i.success(s("profile.toastTopUpConfirmed"))}catch(t){v("idle"),i.error(t instanceof Error?t.message:s("profile.toastTopUpFailed"))}finally{W(!1)}},be=Be({address:k,amountTon:u,memo:_}),ye=t=>{C(t),f(""),T(!0)},Ne=async()=>{if(!c)return;const t=at(L);if(!t||t<=0n){i.error("Enter a valid TON amount.");return}const x=U(c);if(t>x){i.error("Amount exceeds available balance.");return}$(!0);try{const p=await Ze({channelId:c.channel.id,amountNano:t.toString()}),j=typeof p.message=="string"?p.message:"Withdrawal request submitted.";i.success(j),T(!1),f(""),C(null),await m.refetch()}catch(p){i.error(p instanceof Error?p.message:"Withdraw failed.")}finally{$(!1)}},D=U(c),Q=n.useMemo(()=>ae(D),[D]);return e.jsxs("div",{className:"w-full max-w-6xl mx-auto",children:[e.jsx(Pe,{className:"py-6 space-y-6",children:d?e.jsx(X,{items:2}):h?e.jsx(Ue,{message:Ae(h,"Unable to load profile"),description:"Please reconnect your session and try again.",onRetry:()=>oe()}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"glass p-5",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(K,{className:"h-14 w-14",children:[e.jsx(V,{src:a?.photo_url,alt:S}),e.jsx(H,{className:"bg-primary/15 text-primary text-lg font-semibold",children:ge||"TG"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:S}),e.jsx("p",{className:"text-sm text-muted-foreground",children:fe}),e.jsxs("div",{className:"mt-2 inline-flex items-center gap-2 rounded-full bg-secondary/60 px-3 py-1 text-[11px] font-medium text-muted-foreground",children:[e.jsx(_e,{size:14,className:"text-primary/80"}),s("profile.connectedViaTelegram")]})]})]})}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[340px_1fr]",children:[e.jsxs("div",{className:"space-y-6 lg:sticky lg:top-20 lg:self-start",children:[e.jsxs("div",{className:"relative rounded-[28px] border border-border/40 bg-background/70 shadow-xl overflow-hidden",children:[e.jsxs("div",{className:"px-5 py-4 border-b border-border/40 flex items-center justify-between gap-3",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Wallet"}),e.jsx(Oe,{className:"shrink-0"})]}),e.jsxs("div",{className:"px-5 py-5 space-y-4 pb-6",children:[e.jsxs("div",{className:"glass p-4 space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:s("profile.topUpBalance")}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s("profile.tonAmount")}),e.jsxs("p",{className:"text-2xl font-semibold text-foreground",children:[u.toFixed(2)," TON"]})]}),e.jsx(qe,{size:20,className:"text-primary/80"})]}),e.jsx("button",{type:"button",className:"rounded-md border border-primary/40 bg-primary/10 px-3 py-1 text-xs text-primary/80 transition hover:border-primary/60 hover:bg-primary/20",onClick:()=>w(!0),children:"Change amount"})]}),e.jsx("button",{type:"button",className:"button-primary rounded-md py-3 text-sm",onClick:B,disabled:y,children:s(y?"profile.processing":"profile.proceedToPayment")}),e.jsxs("div",{className:"glass p-4 space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:s("profile.paymentInstructions")}),e.jsxs("div",{className:"space-y-1 text-sm text-foreground",children:[e.jsx("p",{children:be}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s("profile.address")," ",k]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s("profile.memo")," ",_]})]})]}),R==="pending"?e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-primary/30 bg-primary/10 px-4 py-3 text-xs text-primary",children:[e.jsx(Fe,{size:14}),s("profile.waitingConfirmation")]}):null,R==="confirmed"?e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-emerald-400/30 bg-emerald-500/10 px-4 py-3 text-xs text-emerald-200",children:[e.jsx(Re,{size:14}),s("profile.topUpConfirmed")]}):null]})]}),e.jsxs("div",{className:"glass p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:s("profile.language")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s("profile.languageDescription")})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{value:"en",label:s("profile.languageOptionEnglish")},{value:"ru",label:s("profile.languageOptionRussian")}].map(t=>e.jsx("button",{type:"button",onClick:()=>o(t.value),className:`rounded-md border px-3 py-1 text-xs transition ${r===t.value?"border-primary/60 bg-primary/20 text-primary":"border-border/40 text-muted-foreground hover:text-foreground"}`,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"rounded-[28px] border border-border/40 bg-background/70 shadow-xl overflow-hidden",children:[e.jsxs("div",{className:"px-5 py-4 border-b border-border/40 space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Payouts"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Available to withdraw from your channels"})]}),e.jsxs("button",{type:"button",onClick:()=>m.refetch(),disabled:m.isFetching,className:"inline-flex items-center gap-2 rounded-md border border-border/40 px-3 py-2 text-xs font-semibold text-muted-foreground transition hover:text-foreground disabled:opacity-60",children:[e.jsx(We,{size:14}),"Reload"]})]}),e.jsx(O,{value:N,onChange:t=>pe(t.target.value),placeholder:"Search channels",className:"h-10 rounded-md bg-background/70"})]}),e.jsxs("div",{className:"px-5 py-5 space-y-4 pb-8",children:[m.isLoading?e.jsx(X,{items:3}):z.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No channel payouts available."}):e.jsx("div",{className:"space-y-3",children:z.map(t=>{const x=U(t),p=st(t.availableNano),j=x<=0n;return e.jsxs("div",{className:"glass p-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(K,{className:"h-11 w-11",children:[e.jsx(V,{src:t.channel.avatarUrl??void 0,alt:t.channel.name}),e.jsx(H,{className:"bg-primary/15 text-primary text-sm font-semibold",children:t.channel.name.slice(0,2).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:t.channel.name}),t.channel.username?e.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",t.channel.username]}):null]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 sm:justify-end",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:[j?"0":p," TON"]}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Available"})]}),e.jsx("button",{type:"button",onClick:()=>ye(t),disabled:j,className:"button-primary rounded-md px-4 py-2 text-xs disabled:pointer-events-none disabled:opacity-60",children:"Withdraw"})]})]},t.channel.id)})}),g?e.jsx("p",{className:"text-xs text-rose-200",children:g.message}):null]})]})]})]})}),e.jsx(G,{open:ce,onOpenChange:w,children:e.jsxs(A,{side:"bottom",className:"rounded-t-3xl border-t border-border/60 bg-background/95 px-5 pb-8 pt-6",children:[e.jsxs(P,{className:"text-left",children:[e.jsx(I,{children:"Top up balance"}),e.jsx(E,{children:"Enter the TON amount you want to add to your wallet."})]}),e.jsxs("div",{className:"mt-5 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Amount (TON)"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{type:"number",inputMode:"decimal",min:"0",step:"0.01",value:ie,onChange:t=>q(t.target.value),className:"h-12 rounded-2xl text-lg",placeholder:"0.00"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"TON"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:et.map(t=>e.jsxs("button",{type:"button",onClick:()=>q(t.toString()),className:`rounded-md border px-3 py-1 text-xs transition ${u===t?"border-primary/60 bg-primary/20 text-primary":"border-primary/40 bg-primary/10 text-primary/80"}`,children:["+",t," TON"]},t))}),e.jsx("button",{type:"button",className:"button-primary rounded-md py-4 disabled:pointer-events-none disabled:opacity-70",onClick:B,disabled:y,children:y?"Processing...":"Top up"})]})]})}),e.jsx(G,{open:me,onOpenChange:t=>{T(t),t||(C(null),f(""))},children:e.jsxs(A,{side:"bottom",className:"rounded-t-3xl border-t border-border/60 bg-background/95 px-5 pb-8 pt-6",children:[e.jsxs(P,{className:"text-left",children:[e.jsx(I,{children:"Withdraw from channel"}),e.jsx(E,{children:"Enter the amount you want to withdraw from this channel."})]}),e.jsxs("div",{className:"mt-5 space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:c?.channel.name??""}),c?.channel.username?e.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",c.channel.username]}):null,e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Available: ",re(Q)," TON"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Amount (TON)"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{type:"text",inputMode:"decimal",value:L,onChange:t=>f(t.target.value),className:"h-12 rounded-2xl text-lg",placeholder:"0.00"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"TON"})]}),e.jsx("button",{type:"button",onClick:()=>f(Q),className:"rounded-md border border-primary/40 bg-primary/10 px-3 py-1 text-xs text-primary/80 transition hover:border-primary/60 hover:bg-primary/20",children:"Max"})]}),e.jsx("button",{type:"button",className:"button-primary rounded-md py-4 disabled:pointer-events-none disabled:opacity-70",onClick:Ne,disabled:F,children:F?"Processing...":"Confirm withdraw"})]})]})})]})}export{bt as default};
