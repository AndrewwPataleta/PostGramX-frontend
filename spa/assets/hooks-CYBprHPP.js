import{u as v}from"./useQuery-CDEvYnML.js";import{t as l,o}from"./index-CbVeYs1W.js";import{u as d}from"./useMutation-DttlsHh2.js";import{m as r}from"./mockChannels-BOQTRySQ.js";import{g as E}from"./errors-DxSBi7os.js";const D="flowgramx.mockDeals",g=Date.now(),a=t=>new Date(g-t*6e4).toISOString(),T=t=>new Date(g+t*6e4).toISOString(),N=t=>new Date(g+t*36e5).toISOString(),w=[{id:"DL-2001",status:"OWNER_ACCEPTED",updatedAt:a(8),priceTon:4.2,briefText:"Launch teaser for FlowgramX with CTA to beta waitlist.",channel:{id:r[0].id,title:r[0].title,username:r[0].username,avatarUrl:r[0].avatarUrl,isVerified:r[0].verified,subscribers:r[0].subscribers,averageViews:r[0].averageViews,language:r[0].language,priceTon:r[0].priceTon},escrow:{status:"AWAITING_PAYMENT",amountTon:4.2,network:"TON",depositAddress:"EQC2MockDepositAddress1111",memo:"FGX-2001",updatedAt:a(8)}},{id:"DL-2002",status:"CREATIVE_SUBMITTED",updatedAt:a(18),priceTon:3.5,briefText:"Promote new campaign dashboard with a short CTA to try demo.",channel:{id:r[1].id,title:r[1].title,username:r[1].username,avatarUrl:r[1].avatarUrl,isVerified:r[1].verified,subscribers:r[1].subscribers,averageViews:r[1].averageViews,language:r[1].language,priceTon:r[1].priceTon},escrow:{status:"FUNDS_LOCKED",amountTon:3.5,network:"TON",updatedAt:a(20)},creative:{text:"ðŸš€ FlowgramX just launched a smarter way to buy Telegram placements. Try the demo today.",submittedAt:a(18),approvedAt:null}},{id:"DL-2003",status:"SCHEDULED",updatedAt:a(40),priceTon:2.6,briefText:"Drive signups for creator waitlist with emphasis on verified channels.",channel:{id:r[2].id,title:r[2].title,username:r[2].username,avatarUrl:r[2].avatarUrl,isVerified:r[2].verified,subscribers:r[2].subscribers,averageViews:r[2].averageViews,language:r[2].language,priceTon:r[2].priceTon},escrow:{status:"FUNDS_LOCKED",amountTon:2.6,network:"TON",updatedAt:a(40)},creative:{text:"FlowgramX connects advertisers with top Telegram channels. Join the waitlist today.",submittedAt:a(60),approvedAt:a(48)},schedule:{scheduledAt:N(2),timezone:"UTC"}},{id:"DL-2004",status:"POSTED",updatedAt:a(6),priceTon:5.1,briefText:"Highlight escrow safety and bot-assisted messaging for advertisers.",channel:{id:r[3].id,title:r[3].title,username:r[3].username,avatarUrl:r[3].avatarUrl,isVerified:r[3].verified,subscribers:r[3].subscribers,averageViews:r[3].averageViews,language:r[3].language,priceTon:r[3].priceTon},escrow:{status:"FUNDS_LOCKED",amountTon:5.1,network:"TON",updatedAt:a(8)},creative:{text:"FlowgramX keeps your TON safe in escrow until the post is verified. Learn more today.",submittedAt:a(35),approvedAt:a(30)},schedule:{scheduledAt:a(15),timezone:"UTC"},post:{messageId:"99421",viewUrl:"https://t.me/signalstream/99421",verifyUntil:T(22),postedAt:a(12)}},{id:"DL-2005",status:"RELEASED",updatedAt:a(55),priceTon:3.1,briefText:"Showcase creative review and scheduling in the mini app.",channel:{id:r[4].id,title:r[4].title,username:r[4].username,avatarUrl:r[4].avatarUrl,isVerified:r[4].verified,subscribers:r[4].subscribers,averageViews:r[4].averageViews,language:r[4].language,priceTon:r[4].priceTon},escrow:{status:"RELEASED",amountTon:3.1,network:"TON",updatedAt:a(55)},creative:{text:"Our first FlowgramX campaign is live â€” thanks to the community!",submittedAt:a(120),approvedAt:a(110)},schedule:{scheduledAt:a(90),timezone:"UTC"},post:{messageId:"99400",viewUrl:"https://t.me/web3horizon/99400",verifyUntil:a(10),postedAt:a(80)}},{id:"DL-2006",status:"REFUNDED",updatedAt:a(90),priceTon:3.8,briefText:"Russian audience campaign for product launch update.",channel:{id:r[5].id,title:r[5].title,username:r[5].username,avatarUrl:r[5].avatarUrl,isVerified:r[5].verified,subscribers:r[5].subscribers,averageViews:r[5].averageViews,language:r[5].language,priceTon:r[5].priceTon},escrow:{status:"REFUNDED",amountTon:3.8,network:"TON",updatedAt:a(90)}}],y=()=>typeof window<"u"&&!!window.localStorage,m=()=>{if(!y())return[...w];const t=window.localStorage.getItem(D);if(!t)return window.localStorage.setItem(D,JSON.stringify(w)),[...w];try{const e=JSON.parse(t);if(Array.isArray(e)&&e.length>0)return e}catch(e){console.warn("Failed to parse mock deals",e)}return window.localStorage.setItem(D,JSON.stringify(w)),[...w]},h=t=>{y()&&window.localStorage.setItem(D,JSON.stringify(t))},b=()=>m(),C=t=>m().find(e=>e.id===t)??null,p=(t,e)=>{const s=m(),i=s.findIndex(A=>A.id===t);if(i===-1)return null;const u=e({...s[i]});return s[i]=u,h(s),u},V=()=>`DL-${Math.floor(1e3+Math.random()*9e3)}`,U=t=>{const e=r.find(I=>I.id===t.channelId)??r[0],s=new Date().toISOString(),i={id:V(),status:"REQUESTED",updatedAt:s,priceTon:e.priceTon,briefText:t.briefText,requestedScheduleAt:t.requestedScheduleAt??null,channel:{id:e.id,title:e.title,username:e.username,avatarUrl:e.avatarUrl,isVerified:e.verified,subscribers:e.subscribers,averageViews:e.averageViews,language:e.language,priceTon:e.priceTon}},u={...i,status:"OWNER_ACCEPTED",escrow:{status:"AWAITING_PAYMENT",amountTon:e.priceTon,network:"TON",depositAddress:"EQC2MockDepositAddress2222",memo:`FGX-${i.id}`,updatedAt:s}},A=m(),S=[u,...A];return h(S),u},F=t=>p(t,e=>{const s=new Date().toISOString(),i=!!e.schedule?.scheduledAt;return{...e,status:i?"SCHEDULED":"CREATIVE_APPROVED",updatedAt:s,creative:{...e.creative,approvedAt:s}}}),O=(t,e)=>p(t,s=>{const i=new Date().toISOString();return{...s,status:"CREATIVE_DRAFTING",updatedAt:i,creative:{...s.creative,text:e?`${s.creative?.text??""}

Edits: ${e}`.trim():s.creative?.text,submittedAt:null,approvedAt:null,lastUpdatedAt:i}}}),P=t=>p(t,e=>{const s=new Date().toISOString();return e.escrow?.status==="AWAITING_PAYMENT"?{...e,status:"PAYMENT_CONFIRMING",updatedAt:s,escrow:{...e.escrow,status:"PAYMENT_CONFIRMING",updatedAt:s}}:e.escrow?.status==="PAYMENT_CONFIRMING"?{...e,status:"FUNDS_LOCKED",updatedAt:s,escrow:{...e.escrow,status:"FUNDS_LOCKED",updatedAt:s},creative:e.creative??{text:"",submittedAt:null,approvedAt:null}}:{...e,updatedAt:s}}),M=t=>p(t,e=>{const s=new Date().toISOString();return{...e,status:"POSTED",updatedAt:s,post:{messageId:"10101",viewUrl:`https://t.me/${e.channel.username}/10101`,verifyUntil:T(25),postedAt:s}}}),L=t=>p(t,e=>{const s=new Date().toISOString();return{...e,status:"RELEASED",updatedAt:s,escrow:e.escrow?{...e.escrow,status:"RELEASED",updatedAt:s}:void 0}}),_=t=>p(t,e=>{const s=new Date().toISOString();return{...e,status:"REFUNDED",updatedAt:s,escrow:e.escrow?{...e.escrow,status:"REFUNDED",updatedAt:s}:void 0}}),te=!0,c=async(t=300,e=600)=>{const s=Math.floor(Math.random()*(e-t+1))+t;await new Promise(i=>setTimeout(i,s))};console.info("MOCK MODE ENABLED for Deals");const q=async()=>(await c(),b()),k=async t=>{{await c();const e=C(t);if(!e)throw new Error("Deal not found");return e}},Q=async t=>(await c(),U(t)),G=async t=>{{await c();const e=F(t);if(!e)throw new Error("Deal not found");return e}},K=async(t,e)=>{{await c();const s=O(t,e);if(!s)throw new Error("Deal not found");return s}},x=async t=>{await c();const e=P(t);if(!e)throw new Error("Deal not found");return e},Y=async t=>{await c();const e=M(t);if(!e)throw new Error("Deal not found");return e},W=async t=>{await c();const e=L(t);if(!e)throw new Error("Deal not found");return e},H=async t=>{await c();const e=_(t);if(!e)throw new Error("Deal not found");return e},R={REQUESTED:{label:"Request sent",description:"Your request is with the channel owner. We'll notify you via bot once accepted.",ctaLabel:"View request",listAction:"View",category:"pending",tone:"neutral"},PAYMENT_REQUIRED:{label:"Payment required",description:"Escrow keeps funds safe until the post is verified.",ctaLabel:"Pay escrow",listAction:"Pay Now",category:"pending",tone:"warning"},PAYMENT_CONFIRMING:{label:"Payment confirming",description:"We're confirming your TON transfer. This usually takes a minute.",ctaLabel:"View payment",listAction:"View",category:"pending",tone:"info"},FUNDS_LOCKED:{label:"Funds locked",description:"Funds are secured in escrow while the channel drafts your creative.",ctaLabel:"Message via bot",listAction:"View",category:"active",tone:"info"},CREATIVE_DRAFTING:{label:"Creative drafting",description:"The channel owner is preparing the creative draft for your review.",ctaLabel:"Message via bot",listAction:"View",category:"active",tone:"info"},CREATIVE_REVIEW:{label:"Creative review",description:"Review the draft and approve to schedule delivery.",ctaLabel:"Review creative",listAction:"Review",category:"active",tone:"primary"},CREATIVE_APPROVED:{label:"Creative approved",description:"Creative approved. Waiting for channel to schedule the post.",ctaLabel:"View status",listAction:"View",category:"active",tone:"info"},SCHEDULED:{label:"Scheduled",description:"The post is scheduled and queued for delivery.",ctaLabel:"View schedule",listAction:"View",category:"active",tone:"info"},VERIFYING:{label:"Posted Â· verifying",description:"Post is live. Verification checks will release escrow automatically.",ctaLabel:"View post",listAction:"View Post",category:"active",tone:"primary"},RELEASED:{label:"Released",description:"Post verified. Escrow released to the channel owner.",ctaLabel:"View receipt",listAction:"Receipt",category:"completed",tone:"success"},REFUNDED:{label:"Refunded",description:"Verification failed or the deal was cancelled. Funds returned.",ctaLabel:"View receipt",listAction:"Receipt",category:"completed",tone:"danger"}},f=t=>t.status==="REFUNDED"||t.escrow?.status==="REFUNDED"?"REFUNDED":t.status==="RELEASED"||t.escrow?.status==="RELEASED"?"RELEASED":t.status==="VERIFYING"||t.status==="POSTED"||t.post?.viewUrl?"VERIFYING":t.status==="SCHEDULED"||t.schedule?.scheduledAt?"SCHEDULED":t.status==="CREATIVE_SUBMITTED"&&!t.creative?.approvedAt?"CREATIVE_REVIEW":t.status==="CREATIVE_APPROVED"||t.creative?.approvedAt?"CREATIVE_APPROVED":t.status==="CREATIVE_DRAFTING"?"CREATIVE_DRAFTING":t.status==="FUNDS_LOCKED"||t.escrow?.status==="FUNDS_LOCKED"?"FUNDS_LOCKED":t.status==="PAYMENT_CONFIRMING"||t.escrow?.status==="PAYMENT_CONFIRMING"?"PAYMENT_CONFIRMING":t.status==="PAYMENT_REQUIRED"||t.status==="OWNER_ACCEPTED"||t.escrow?.status==="AWAITING_PAYMENT"?"PAYMENT_REQUIRED":"REQUESTED",X=t=>{const e=f(t);return R[e].category},re=t=>{const e=f(t);return R[e]},B=["Accepted","Payment","Creative","Scheduled","Posted","Released"],J={REQUESTED:0,PAYMENT_REQUIRED:1,PAYMENT_CONFIRMING:1,FUNDS_LOCKED:2,CREATIVE_DRAFTING:2,CREATIVE_REVIEW:2,CREATIVE_APPROVED:3,SCHEDULED:3,VERIFYING:4,RELEASED:5,REFUNDED:5},se=t=>{const e=f(t),s=J[e];return B.map((i,u)=>u<s?{label:i,state:"completed"}:u===s?{label:i,state:"current"}:{label:i,state:"upcoming"})},n={all:["deals"],list:t=>["deals","list",t],detail:t=>["deals","detail",t]},ae=t=>v({queryKey:n.list(t),queryFn:q,select:e=>e.filter(s=>X(s)===t)}),ie=t=>v({queryKey:t?n.detail(t):n.detail("unknown"),queryFn:()=>{if(!t)throw new Error("Missing deal ID");return k(t)},enabled:!!t}),ne=()=>{const t=l();return d({mutationFn:e=>Q(e),onSuccess:e=>{t.invalidateQueries({queryKey:n.all}),t.setQueryData(n.detail(e.id),e),o.success("Request sent")},onError:e=>{o.error(E(e,"Unable to create deal"))}})},oe=()=>{const t=l();return d({mutationFn:e=>G(e),onSuccess:e=>{t.invalidateQueries({queryKey:n.all}),t.setQueryData(n.detail(e.id),e),o.success("Creative approved")},onError:e=>{o.error(E(e,"Unable to approve creative"))}})},ce=()=>{const t=l();return d({mutationFn:({id:e,note:s})=>K(e,s),onSuccess:e=>{t.invalidateQueries({queryKey:n.all}),t.setQueryData(n.detail(e.id),e),o.success("Edits requested")},onError:e=>{o.error(E(e,"Unable to request edits"))}})},ue=()=>{const t=l();return d({mutationFn:e=>x(e),onSuccess:e=>{t.invalidateQueries({queryKey:n.all}),t.setQueryData(n.detail(e.id),e),o.success("Payment confirmed")},onError:e=>{o.error(E(e,"Unable to process payment"))}})},le=()=>{const t=l();return d({mutationFn:e=>Y(e),onSuccess:e=>{t.invalidateQueries({queryKey:n.all}),t.setQueryData(n.detail(e.id),e),o.success("Post published")},onError:e=>{o.error(E(e,"Unable to simulate post"))}})},de=()=>{const t=l();return d({mutationFn:e=>W(e),onSuccess:e=>{t.invalidateQueries({queryKey:n.all}),t.setQueryData(n.detail(e.id),e),o.success("Escrow released")},onError:e=>{o.error(E(e,"Unable to simulate release"))}})},Ee=()=>{const t=l();return d({mutationFn:e=>H(e),onSuccess:e=>{t.invalidateQueries({queryKey:n.all}),t.setQueryData(n.detail(e.id),e),o.success("Deal refunded")},onError:e=>{o.error(E(e,"Unable to simulate refund"))}})};export{te as U,ae as a,ie as b,oe as c,ce as d,ue as e,le as f,re as g,de as h,Ee as i,se as j,ne as u};
