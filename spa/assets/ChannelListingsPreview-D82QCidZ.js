import{c as L,r as p,j as e,f,d as I,h as M}from"./index-4rp1-c6Q.js";import{f as _,n as A}from"./ton-ClBVV2oW.js";import{C as O}from"./chevron-down-CcFFJBnR.js";import{u as R}from"./useQuery-BI1e1xV-.js";import{l as B}from"./listingsApi-DR9uWiS6.js";import{S as h}from"./skeleton-BRMC-f2S.js";import{g as q}from"./errors-3kY4UU5q.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],z=L("pencil-line",H);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],V=L("refresh-ccw",U),j=3,$=r=>{if(!r)return null;try{return _(A(r))}catch{return r}},k=r=>{const t=r.map(o=>o.trim()).filter(Boolean),s=Array.from(new Set(t));return{visible:s.slice(0,j),hiddenCount:Math.max(s.length-j,0)}},y=r=>r>=168&&r%24===0?`${r/24}d`:`${r}h`,F=({listings:r})=>r.length===0?e.jsx("div",{className:"rounded-xl border border-dashed border-border/60 bg-background/50 px-4 py-4 text-center text-xs text-muted-foreground",children:"No placements available yet."}):e.jsx("div",{className:"space-y-3",children:r.map(t=>{const s=k(t.tags??[]),o=[t.allowEdits?"Edits allowed":null,t.allowLinkTracking?"Tracking allowed":null].filter(Boolean),c=$(t.priceNano)??t.priceNano,d=t.pinDurationHours?`Pinned ${y(t.pinDurationHours)}`:"Not pinned",n=`Visible ${y(t.visibilityDurationHours)}`,i=t.contentRulesText?.trim();return e.jsxs("div",{className:"rounded-xl border border-border/60 bg-card/80 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-sm font-semibold text-foreground",children:[c," TON"]}),e.jsx("span",{className:"rounded-full border border-border/60 bg-muted/40 px-2 py-0.5 text-[10px] font-semibold text-muted-foreground",children:t.format})]}),e.jsxs("div",{className:"mt-2 text-[11px] text-muted-foreground",children:[d," • ",n]}),o.length>0?e.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-[11px] text-muted-foreground",children:o.map(a=>e.jsx("span",{className:"rounded-full border border-border/60 bg-muted/30 px-2 py-0.5",children:a},a))}):null,s.visible.length>0?e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-[11px] text-muted-foreground",children:[s.visible.map(a=>e.jsx("span",{className:"rounded-full border border-border/60 bg-card px-2 py-0.5 text-foreground",children:a},`${t.id}-${a}`)),s.hiddenCount>0?e.jsxs("span",{className:"rounded-full border border-border/60 bg-card px-2 py-0.5",children:["+",s.hiddenCount]}):null]}):null,i?e.jsx("p",{className:"mt-2 line-clamp-2 text-[11px] text-muted-foreground",children:i}):null]},t.id)})});function ne({channel:r,onClick:t,actions:s,isExpanded:o,onToggleExpand:c,expandedContent:d}){const[n,i]=p.useState(!1),[a,b]=p.useState(!1),l=o??n,x=!!(c||d||r.listingsPreview),g=p.useMemo(()=>$(r.minPriceNano),[r.minPriceNano]),m=k(r.tags??[]),N=r.username?`@${r.username.replace(/^@/,"")}`:null,T=r.name?.[0]?.toUpperCase()??"?",v=!a&&r.avatarUrl?r.avatarUrl:null,E=r.placementsCount!=null?r.placementsCount.toString():"—",S=typeof r.subscribers=="number"?r.subscribers.toLocaleString():"—",C=u=>{u.stopPropagation(),c?c():i(D=>!D)};return e.jsxs("div",{className:f("w-full rounded-2xl border border-border/50 bg-card/80 p-4 text-left shadow-sm transition",t&&"cursor-pointer hover:border-border/80 hover:bg-card"),role:t?"button":void 0,tabIndex:t?0:void 0,onClick:t,onKeyDown:u=>{t&&(u.key==="Enter"||u.key===" ")&&(u.preventDefault(),t())},children:[e.jsxs("div",{className:"flex items-start gap-3",children:[v?e.jsx("img",{src:v,alt:r.name,className:"h-12 w-12 rounded-full object-cover",onError:()=>b(!0)}):e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-primary/30 via-secondary/50 to-secondary text-lg text-foreground",children:T}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:r.name}),N?e.jsx("span",{className:"text-xs text-muted-foreground",children:N}):null]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s,x?e.jsx("button",{type:"button",onClick:C,"aria-expanded":l,className:"inline-flex h-8 w-8 items-center justify-center rounded-lg border border-border/60 bg-secondary/40 text-muted-foreground transition hover:text-foreground",children:e.jsx(O,{size:16,className:f("transition-transform duration-200",l&&"rotate-180")})}):null]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[E," placements"]}),e.jsx("span",{children:"·"}),e.jsxs("span",{children:[S," subscribers"]})]}),e.jsx("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:e.jsxs("span",{children:["From"," ",e.jsxs("span",{className:"font-semibold text-primary",children:[g??"—"," TON"]})]})}),m.visible.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px] text-muted-foreground",children:[m.visible.map(u=>e.jsx("span",{className:"rounded-full border border-border/60 bg-card px-2.5 py-1 text-foreground",children:u},`${r.id}-${u}`)),m.hiddenCount>0?e.jsxs("span",{className:"rounded-full border border-border/60 bg-card px-2.5 py-1 text-muted-foreground",children:["+",m.hiddenCount]}):null]}):null]})]}),x?e.jsx("div",{className:f("overflow-hidden transition-all duration-300",l?"mt-4 max-h-[1200px] opacity-100":"max-h-0 opacity-0"),children:e.jsx("div",{className:"rounded-2xl border border-border/60 bg-background/60 p-3",children:d||e.jsx(F,{listings:r.listingsPreview??[]})})}):null]})}const K=5,W=3,w=1000000000n,G=r=>{try{const t=BigInt(r),s=t/w,o=t%w;if(o===0n)return`${s.toString()} TON`;const d=o.toString().padStart(9,"0").slice(0,2).replace(/0+$/,"");return`${d?`${s.toString()}.${d}`:s.toString()} TON`}catch{return`${r} TON`}},Q=r=>{const t=r.slice(0,2),s=r.length-t.length;return{shown:t,remaining:s}},P=p.memo(({channelId:r,listing:t,rootBackTo:s,mode:o})=>{const c=t.pinDurationHours?`Pinned ${t.pinDurationHours}h`:"No pin",d=`Visible ${t.visibilityDurationHours}h`,n=Q(t.tags??[]),i=t.isActive===!1;return e.jsxs("div",{className:f("flex items-center gap-3 py-3",o==="owner"&&i&&"opacity-60"),children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:G(t.priceNano)}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:[c," • ",d]}),n.shown.length>0?e.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[n.shown.map(a=>e.jsx("span",{className:"rounded-full border border-border/60 bg-muted/30 px-2 py-0.5 text-[10px] text-muted-foreground",children:a},a)),n.remaining>0?e.jsxs("span",{className:"rounded-full border border-border/60 bg-muted/30 px-2 py-0.5 text-[10px] text-muted-foreground",children:["+",n.remaining]}):null]}):null]}),o==="owner"?e.jsx(M,{to:`/channel-manage/${r}/listings/${t.id}/edit`,state:s?{rootBackTo:s}:void 0,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-border/60 bg-background text-muted-foreground transition hover:text-foreground","aria-label":"Edit listing",children:e.jsx(z,{size:14})}):null]})});P.displayName="ListingPreviewRow";const X=p.memo(({channelId:r,isExpanded:t,onSummaryChange:s,mode:o="owner"})=>{const d=I().state?.rootBackTo,n=R({queryKey:["channelListingsPreview",r],queryFn:()=>B({channelId:r,page:1,limit:K,onlyActive:!0,sort:"recent"}),enabled:t,staleTime:1e3*60*5}),i=n.data?.items??[],a=n.data?.total??i.length;p.useEffect(()=>{if(!n.data)return;const l=i.reduce((x,g)=>{try{const m=BigInt(g.priceNano);return x===null||m<x?m:x}catch{return x}},null);s?.({placementsCount:a,minPriceNano:l?l.toString():null})},[i,s,n.data,a]);const b=p.useMemo(()=>i.slice(0,W),[i]);return e.jsx("div",{className:"space-y-3",children:n.isLoading?e.jsx("div",{className:"space-y-2",children:Array.from({length:2}).map((l,x)=>e.jsxs("div",{className:"rounded-xl border border-border/50 bg-background/60 px-3 py-3",children:[e.jsx(h,{className:"h-4 w-24"}),e.jsx(h,{className:"mt-2 h-3 w-40"}),e.jsx(h,{className:"mt-2 h-3 w-28"})]},`listing-skeleton-${x}`))}):n.isError?e.jsxs("div",{className:"rounded-xl border border-border/60 bg-red-500/5 px-4 py-3 text-xs text-red-200",children:[e.jsx("p",{children:q(n.error,"Unable to load placements.")}),e.jsxs("button",{type:"button",onClick:()=>n.refetch(),className:"mt-2 inline-flex items-center gap-2 rounded-lg border border-red-500/40 bg-red-500/10 px-3 py-1 text-[11px] font-semibold text-red-200",children:[e.jsx(V,{size:12}),"Retry"]})]}):b.length>0?e.jsx("div",{className:"rounded-xl border border-border/60 bg-background/60 px-3 divide-y divide-border/40",children:b.map(l=>e.jsx(P,{channelId:r,listing:l,rootBackTo:d,mode:o},l.id))}):e.jsxs("div",{className:"rounded-xl border border-dashed border-border/60 bg-background/50 px-4 py-4 text-center",children:[e.jsx("p",{className:"text-xs font-semibold text-foreground",children:"No placements yet"}),e.jsx("p",{className:"mt-1 text-[11px] text-muted-foreground",children:"Create your first listing to start earning."})]})})});X.displayName="ChannelListingsPreview";export{ne as C,X as a};
