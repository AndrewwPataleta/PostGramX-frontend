import{c as Y,r as p,j as e,f as u,e as w,a as h,p as S,b as G,d as H}from"./index-Bdaoqcb2.js";import{u as C}from"./useQuery-2L_VsJWv.js";import{C as V}from"./chevron-left-C9feXbdu.js";import{a as $,f as q}from"./dealsApi-BJWRNCiv.js";import{L as B}from"./LoadingSkeleton-Bn_rn0M-.js";import{E as Q}from"./ErrorState-CNKN_qb3.js";import{P as K}from"./PageContainer-DKM49Rqo.js";import{g as j}from"./errors-3kY4UU5q.js";import{u as D}from"./useMutation-BiKwg8wc.js";import{o as I}from"./telegramLinks-DFMIlj7w.js";import"./skeleton-DJrZWN2d.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],z=Y("chevron-right",X),v=["SCHEDULE","SEND_POST","CONFIRM_POST","ADMIN_APPROVAL","PAYMENT_WINDOW","PAYMENT","PAYMENT_PENDING","SCHEDULED","VERIFYING","DONE"],J={SCHEDULING_PENDING:"SCHEDULE",CREATIVE_AWAITING_SUBMIT:"SEND_POST",CREATIVE_AWAITING_CONFIRM:"CONFIRM_POST",ADMIN_REVIEW:"ADMIN_APPROVAL",PAYMENT_WINDOW_PENDING:"PAYMENT_WINDOW",PAYMENT_AWAITING:"PAYMENT",FUNDS_PENDING:"PAYMENT_PENDING",FUNDS_CONFIRMED:"SCHEDULED",APPROVED_SCHEDULED:"SCHEDULED",POSTED_VERIFYING:"VERIFYING",COMPLETED:"DONE",CANCELED:"DONE",REFUNDED:"DONE",DISPUTED:"DONE"},Z={SCHEDULE:"Schedule time",SEND_POST:"Send post",CONFIRM_POST:"Confirm post",ADMIN_APPROVAL:"Admin approval",PAYMENT_WINDOW:"Payment window",PAYMENT:"Payment",PAYMENT_PENDING:"Payment pending",SCHEDULED:"Scheduled",VERIFYING:"Verifying",DONE:"Done"},ee={SCHEDULING_PENDING:"Scheduling pending",CREATIVE_AWAITING_SUBMIT:"Creative awaiting submit",CREATIVE_AWAITING_CONFIRM:"Creative awaiting confirm",ADMIN_REVIEW:"Admin review",PAYMENT_WINDOW_PENDING:"Payment window pending",PAYMENT_AWAITING:"Payment awaiting",FUNDS_PENDING:"Funds pending",FUNDS_CONFIRMED:"Funds confirmed",APPROVED_SCHEDULED:"Approved & scheduled",POSTED_VERIFYING:"Posted verifying",COMPLETED:"Completed",CANCELED:"Canceled",REFUNDED:"Refunded",DISPUTED:"Disputed"},T=t=>J[t]??"SCHEDULE",te=t=>{const r=T(t),s=v.indexOf(r);return s===-1?["SCHEDULE"]:v.slice(0,s+1)},M=t=>Z[t]??t,k=t=>ee[t]??t.replace(/_/g," "),P=(t,r)=>{const s=T(r);return v.indexOf(t)<=v.indexOf(s)},re=t=>{try{const r=BigInt(t),s=r/1000000000n,n=r%1000000000n;if(n===0n)return s.toString();const o=n.toString().padStart(9,"0").slice(0,2);return`${s.toString()}.${o}`}catch{return t}},se={advertiser:"You are advertiser",publisher:"You are publisher",publisher_manager:"You manage this channel"},ne={advertiser:"bg-primary/10 text-primary",publisher:"bg-emerald-500/10 text-emerald-400",publisher_manager:"bg-emerald-500/10 text-emerald-400"},oe=t=>t?t.toLowerCase().replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase()):"Post";function ae({deal:t,currentStage:r}){const[s,n]=p.useState(!1),o=`${re(t.listing.priceNano)} TON`,i=oe(t.listing.format),d=M(r),c=k(t.escrowStatus),x=t.listing.tags??[],g=t.listing.pinDurationHours??t.listing.placementHours,y=t.listing.visibilityDurationHours??t.listing.lifetimeHours,m=p.useMemo(()=>[{label:"Pinned",value:g?`${g}h`:"None"},{label:"Visible",value:y?`${y}h`:"—"},{label:"Edits",value:t.listing.allowEdits===void 0?"—":t.listing.allowEdits?"Allowed":"No edits"},{label:"Link tracking",value:t.listing.allowLinkTracking===void 0?"—":t.listing.allowLinkTracking?"Enabled":"Disabled"}],[t.listing.allowEdits,t.listing.allowLinkTracking,g,y]);return e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center overflow-hidden rounded-full bg-secondary/60 text-lg font-semibold text-muted-foreground",children:t.channel.avatarUrl?e.jsx("img",{src:t.channel.avatarUrl,alt:t.channel.name,className:"h-full w-full object-cover"}):t.channel.name.slice(0,1)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:[e.jsx("span",{className:"truncate",children:t.channel.name}),t.channel.verified?e.jsx("span",{className:"rounded-full bg-emerald-500/10 px-2 py-0.5 text-[10px] font-semibold text-emerald-400",children:"Verified"}):null]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",t.channel.username]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:o}),e.jsx("p",{className:"text-xs text-muted-foreground",children:i})]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:u("rounded-full px-3 py-1 text-xs font-semibold",ne[t.userRoleInDeal]),children:se[t.userRoleInDeal]}),e.jsxs("span",{className:"rounded-full bg-secondary/60 px-3 py-1 text-xs font-semibold text-foreground",children:["Stage: ",d]}),e.jsx("span",{className:"rounded-full border border-border/60 bg-background/50 px-3 py-1 text-xs font-semibold text-muted-foreground",children:c})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("button",{type:"button",onClick:()=>n(f=>!f),className:"flex w-full items-center justify-between rounded-lg border border-border/60 bg-background/60 px-3 py-2 text-xs font-semibold text-muted-foreground transition hover:text-foreground",children:[e.jsx("span",{children:s?"Hide details":"Show details"}),e.jsx("span",{className:u("text-xs",s?"text-foreground":"text-muted-foreground"),children:s?"▴":"▾"})]})}),s?e.jsxs("div",{className:"mt-4 space-y-3 text-xs text-muted-foreground",children:[x.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:x.map(f=>e.jsxs("span",{className:"rounded-full bg-secondary/60 px-3 py-1 text-xs font-medium text-foreground",children:["#",f]},f))}):null,e.jsx("div",{className:"grid gap-2 sm:grid-cols-2",children:m.map(f=>e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-[11px] uppercase tracking-wide text-muted-foreground",children:f.label}),e.jsx("span",{className:"font-semibold text-foreground",children:f.value})]},f.label))}),t.listing.contentRulesText?e.jsxs("div",{className:"rounded-lg border border-border/60 bg-background/50 p-3 text-xs text-muted-foreground",children:[e.jsx("p",{className:"text-[11px] font-semibold uppercase tracking-wide text-foreground/80",children:"Content rules"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:t.listing.contentRulesText})]}):null,e.jsx("div",{className:"flex flex-wrap gap-2",children:t.listing.requiresApproval?e.jsx("span",{className:"rounded-full bg-amber-500/20 px-3 py-1 text-xs font-semibold text-amber-200",children:"Must be pre-approved"}):null})]}):null]})}function ie({stages:t,selectedStage:r,escrowStatus:s,onSelect:n}){const o=t.indexOf(r),i=o>0?t[o-1]:null,d=o>=0&&o<t.length-1?t[o+1]:null;return e.jsxs("div",{className:"rounded-2xl border border-border/50 bg-card/80 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Timeline"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.length," steps"]})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>i&&n(i),disabled:!i,className:u("flex h-9 w-9 items-center justify-center rounded-full border border-border/60 text-muted-foreground transition",i?"hover:text-foreground":"cursor-not-allowed opacity-40"),"aria-label":"Previous stage",children:e.jsx(V,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex flex-1 flex-wrap gap-2",children:t.map(c=>{const x=c===r,g=!P(c,s);return e.jsx("button",{type:"button",onClick:()=>n(c),disabled:g,className:u("rounded-full border px-3 py-1 text-xs font-semibold transition",x?"border-primary/50 bg-primary/15 text-primary-foreground":"border-border/60 bg-background/50 text-muted-foreground",g?"cursor-not-allowed opacity-40":"hover:border-primary/40 hover:text-foreground"),children:M(c)},c)})}),e.jsx("button",{type:"button",onClick:()=>d&&n(d),disabled:!d,className:u("flex h-9 w-9 items-center justify-center rounded-full border border-border/60 text-muted-foreground transition",d?"hover:text-foreground":"cursor-not-allowed opacity-40"),"aria-label":"Next stage",children:e.jsx(z,{className:"h-4 w-4"})})]})]})}function b({title:t,children:r}){return e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("p",{className:"text-sm font-semibold text-foreground",children:t})}),e.jsx("div",{className:"mt-3 space-y-2 text-xs text-muted-foreground",children:r})]})}const _=t=>{if(!t)return"";const r=new Date(t);if(Number.isNaN(r.getTime()))return"";const s=x=>x.toString().padStart(2,"0"),n=r.getFullYear(),o=s(r.getMonth()+1),i=s(r.getDate()),d=s(r.getHours()),c=s(r.getMinutes());return`${n}-${o}-${i}T${d}:${c}`};function de({deal:t,isCurrent:r}){const s=w(),[n,o]=p.useState(_(t.scheduledAt));p.useEffect(()=>{o(_(t.scheduledAt))},[t.scheduledAt]);const i=D({mutationFn:async()=>{if(!n)throw new Error("Select a date and time before saving.");return S("/deals/schedule",{dealId:t.id,scheduledAt:n})},onSuccess:()=>{h.success("Schedule updated"),s.invalidateQueries({queryKey:["deal",t.id]})},onError:d=>{h.error(j(d,"Unable to save schedule"))}});return e.jsxs(b,{title:"Schedule time",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Choose when this post should go live. The time is saved to the deal schedule."}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsx("input",{type:"datetime-local",value:n,onChange:d=>o(d.target.value),disabled:!r,className:u("w-full rounded-lg border border-border/60 bg-background/60 px-3 py-2 text-xs text-foreground",!r&&"cursor-not-allowed opacity-60")}),e.jsx("button",{type:"button",onClick:()=>i.mutate(),disabled:!r||i.isPending,className:u("rounded-lg bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground transition",!r||i.isPending?"cursor-not-allowed opacity-60":"hover:bg-primary/90"),children:"Save & continue"})]}),r?null:e.jsx("p",{className:"text-xs text-muted-foreground",children:"This step is complete."})]})}const le="postgramx_bot";function ce({deal:t,isCurrent:r}){const s=`https://t.me/${le}?start=deal_${t.id}`;return e.jsxs(b,{title:"Send post",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Send your creative to the PostgramX bot so the publisher can review it. Include any required links or assets."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:()=>I(s),className:"rounded-lg bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground transition hover:bg-primary/90",children:"Open bot"}),e.jsx("button",{type:"button",disabled:!r,className:u("rounded-lg border border-border/60 px-4 py-2 text-xs font-semibold text-foreground",!r&&"cursor-not-allowed opacity-60"),children:"I sent the post"})]}),r?null:e.jsx("p",{className:"text-xs text-muted-foreground",children:"This step is already completed."})]})}function ue({deal:t,isCurrent:r}){const s=w(),n=t.creativeText,o=D({mutationFn:async()=>S("/deals/creative/confirm",{dealId:t.id}),onSuccess:()=>{h.success("Creative confirmed"),s.invalidateQueries({queryKey:["deal",t.id]})},onError:d=>{h.error(j(d,"Unable to confirm creative"))}}),i=D({mutationFn:async()=>S("/deals/creative/reject",{dealId:t.id}),onSuccess:()=>{h.success("Requested changes"),s.invalidateQueries({queryKey:["deal",t.id]})},onError:d=>{h.error(j(d,"Unable to request changes"))}});return e.jsxs(b,{title:"Confirm post",children:[n?e.jsx("div",{className:"rounded-lg border border-border/60 bg-background/50 p-3 text-xs text-foreground",children:n}):e.jsx("div",{className:"rounded-lg border border-dashed border-border/60 bg-background/40 p-3 text-xs text-muted-foreground",children:"Waiting for creative submission."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:()=>o.mutate(),disabled:!r||!n||o.isPending,className:u("rounded-lg bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground transition",!r||!n||o.isPending?"cursor-not-allowed opacity-60":"hover:bg-primary/90"),children:"Confirm"}),e.jsx("button",{type:"button",onClick:()=>i.mutate(),disabled:!r||!n||i.isPending,className:u("rounded-lg border border-border/60 px-4 py-2 text-xs font-semibold text-foreground",!r||!n||i.isPending?"cursor-not-allowed opacity-60":"hover:border-primary/40"),children:"Request changes"})]}),r?null:e.jsx("p",{className:"text-xs text-muted-foreground",children:"This step has been completed."})]})}const xe="postgramx_bot";function me({deal:t,isCurrent:r}){const s=`https://t.me/${xe}?start=deal_${t.id}`,n=t.userRoleInDeal==="publisher"||t.userRoleInDeal==="publisher_manager";return e.jsxs(b,{title:"Admin approval",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Waiting for channel admin approval before payment can proceed."}),n?e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",disabled:!r,className:u("rounded-lg bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground",!r&&"cursor-not-allowed opacity-60"),children:"Approve"}),e.jsx("button",{type:"button",disabled:!r,className:u("rounded-lg border border-border/60 px-4 py-2 text-xs font-semibold text-foreground",!r&&"cursor-not-allowed opacity-60"),children:"Reject"})]}):e.jsx("p",{className:"text-xs text-muted-foreground",children:"Only channel admins can approve this stage."}),e.jsx("button",{type:"button",onClick:()=>I(s),className:"mt-2 rounded-lg border border-border/60 px-4 py-2 text-xs font-semibold text-foreground transition hover:border-primary/40",children:"Check in bot"})]})}const L=[1,2,24],pe=t=>{if(!t)return null;const r=new Date(t).getTime();if(Number.isNaN(r))return null;const s=Math.max(0,r-Date.now()),n=Math.floor(s/36e5),o=Math.floor(s%36e5/6e4);return`${n}h ${o}m`};function ge({deal:t,isCurrent:r}){const s=w(),[n,o]=p.useState(L[0]),i=D({mutationFn:async()=>S("/deals/payment-window",{dealId:t.id,hours:n}),onSuccess:()=>{h.success("Payment window updated"),s.invalidateQueries({queryKey:["deal",t.id]})},onError:c=>{h.error(j(c,"Unable to set payment window"))}}),d=p.useMemo(()=>pe(t.escrowExpiresAt),[t.escrowExpiresAt]);return e.jsxs(b,{title:"Payment window",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Choose how long the advertiser has to complete payment once approved."}),e.jsx("div",{className:"flex flex-wrap gap-2",children:L.map(c=>e.jsxs("button",{type:"button",onClick:()=>o(c),disabled:!r,className:u("rounded-full border px-3 py-1 text-xs font-semibold",c===n?"border-primary/50 bg-primary/15 text-primary-foreground":"border-border/60 bg-background/50 text-muted-foreground",!r&&"cursor-not-allowed opacity-60"),children:[c,"h"]},c))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>i.mutate(),disabled:!r||i.isPending,className:u("rounded-lg bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground transition",!r||i.isPending?"cursor-not-allowed opacity-60":"hover:bg-primary/90"),children:"Set window"}),d?e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Expires in ",d]}):null]})]})}const fe=t=>{try{const r=BigInt(t),s=r/1000000000n,n=r%1000000000n;if(n===0n)return s.toString();const o=n.toString().padStart(9,"0").slice(0,2);return`${s.toString()}.${o}`}catch{return t}};function be({deal:t,isCurrent:r}){const[s,n]=p.useState(!1);return e.jsxs(b,{title:"Payment",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Connect your wallet and confirm payment to lock funds in escrow."}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"rounded-full bg-secondary/60 px-3 py-1 text-xs font-semibold text-foreground",children:["Amount: ",fe(t.listing.priceNano)," TON"]}),e.jsx("span",{className:"rounded-full border border-border/60 bg-background/50 px-3 py-1 text-xs font-semibold text-muted-foreground",children:"Wallet via TonConnect"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",disabled:!r||s,onClick:()=>{n(!0),setTimeout(()=>n(!1),1200)},className:u("rounded-lg bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground transition",!r||s?"cursor-not-allowed opacity-60":"hover:bg-primary/90"),children:s?"Sending...":"Pay"}),e.jsx("button",{type:"button",disabled:!0,className:"rounded-lg border border-border/60 px-4 py-2 text-xs font-semibold text-muted-foreground opacity-60",children:"Connect wallet"})]}),r?null:e.jsx("p",{className:"text-xs text-muted-foreground",children:"Payment step already processed."})]})}function he({isCurrent:t,onRefresh:r,isRefreshing:s}){return e.jsxs(b,{title:"Payment pending",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Payment is being confirmed on-chain. We will update this screen automatically."}),e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsx("button",{type:"button",onClick:r,disabled:s,className:u("rounded-lg border border-border/60 px-4 py-2 text-xs font-semibold text-foreground",s?"cursor-not-allowed opacity-60":"hover:border-primary/40"),children:s?"Refreshing...":"Refresh"})}),t?null:e.jsx("p",{className:"text-xs text-muted-foreground",children:"Payment confirmation completed."})]})}const Ne=t=>{if(!t)return"Not scheduled yet";const r=new Date(t);return Number.isNaN(r.getTime())?t:r.toLocaleString(void 0,{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})};function ye({deal:t,isCurrent:r}){return e.jsxs(b,{title:"Scheduled",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Scheduled time: ",e.jsx("span",{className:"font-semibold text-foreground",children:Ne(t.scheduledAt)})]}),t.scheduledAt?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Waiting for the post to go live."}):e.jsx("p",{className:"text-xs text-muted-foreground",children:"No schedule selected yet. Switch back to the schedule step to pick a time."}),r?null:e.jsx("p",{className:"text-xs text-muted-foreground",children:"Posting is already underway."})]})}function je({deal:t,isCurrent:r}){const s=()=>{t.postUrl&&I(t.postUrl)};return e.jsxs(b,{title:"Verifying post",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"The post has been published. We are verifying it remains visible for the required duration."}),t.postUrl?e.jsx("button",{type:"button",onClick:s,className:u("rounded-lg border border-border/60 px-4 py-2 text-xs font-semibold text-foreground","hover:border-primary/40"),children:"Open post"}):e.jsx("p",{className:"text-xs text-muted-foreground",children:"Post link will appear once available."}),r?null:e.jsx("p",{className:"text-xs text-muted-foreground",children:"Verification has finished."})]})}const O=t=>{if(!t)return"-";const r=new Date(t);return Number.isNaN(r.getTime())?t:r.toLocaleString(void 0,{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})};function Ee({deal:t}){return e.jsxs(b,{title:"Deal complete",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Status: ",e.jsx("span",{className:"font-semibold text-foreground",children:k(t.escrowStatus)})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Last update: ",e.jsx("span",{className:"font-semibold text-foreground",children:O(t.lastActivityAt)})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Created: ",e.jsx("span",{className:"font-semibold text-foreground",children:O(t.createdAt)})]})]})}function Oe(){const{dealId:t}=G(),r=H(),s=w(),n=r.state?.deal,o=t?s.getQueryData(["deal",t]):void 0,i=n?.id===t?n:o,{data:d,isLoading:c,error:x,refetch:g,isFetching:y}=C({queryKey:["deal",t],queryFn:async()=>{if(!t)throw new Error("Missing deal id");return $(t)},enabled:!!t,initialData:i,refetchInterval:l=>l&&["PAYMENT_AWAITING","FUNDS_PENDING","POSTED_VERIFYING"].includes(l.escrowStatus)?5e3:!1}),m=C({queryKey:["deals","list","detail-fallback",t],queryFn:()=>q({role:"all",pendingLimit:20,activeLimit:20,completedLimit:20}),enabled:!!t&&!d,staleTime:2e4}),f=p.useMemo(()=>!m.data||!t?null:[...m.data.pending.items,...m.data.active.items,...m.data.completed.items].find(W=>W.id===t)??null,[t,m.data]),a=d??f;p.useEffect(()=>{(x||m.error)&&h.error(j(x??m.error,"Unable to load deal"))},[x,m.error]);const N=a?T(a.escrowStatus):"SCHEDULE",R=a?te(a.escrowStatus):[],[E,A]=p.useState(null);p.useEffect(()=>{a&&A(l=>!l||!P(l,a.escrowStatus)?N:l)},[N,a]);const U=l=>{a&&P(l,a.escrowStatus)&&A(l)},F=p.useMemo(()=>{if(!a||!E)return null;const l=E===N;switch(E){case"SCHEDULE":return e.jsx(de,{deal:a,isCurrent:l});case"SEND_POST":return e.jsx(ce,{deal:a,isCurrent:l});case"CONFIRM_POST":return e.jsx(ue,{deal:a,isCurrent:l});case"ADMIN_APPROVAL":return e.jsx(me,{deal:a,isCurrent:l});case"PAYMENT_WINDOW":return e.jsx(ge,{deal:a,isCurrent:l});case"PAYMENT":return e.jsx(be,{deal:a,isCurrent:l});case"PAYMENT_PENDING":return e.jsx(he,{isCurrent:l,onRefresh:()=>g(),isRefreshing:y});case"SCHEDULED":return e.jsx(ye,{deal:a,isCurrent:l});case"VERIFYING":return e.jsx(je,{deal:a,isCurrent:l});case"DONE":return e.jsx(Ee,{deal:a});default:return null}},[N,y,g,a,E]);return e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx(K,{className:"py-6 space-y-4",children:c?e.jsx(B,{items:3}):x||m.error||!a?e.jsx(Q,{message:j(x??m.error,"Deal not found"),description:"We couldn't load this deal right now.",onRetry:()=>g()}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{deal:a,currentStage:N}),e.jsx(ie,{stages:R,selectedStage:E??N,escrowStatus:a.escrowStatus,onSelect:U}),F]})})})}export{Oe as default};
