import{d as x,u as h,r as n,j as e,b as d}from"./index-CzoPqvzv.js";import{u as p}from"./useMutation-C1pH0NSp.js";import{p as f}from"./predealsApi-B-hM09CN.js";import{E as g}from"./ErrorState-QLh2JjFD.js";import{P as i}from"./PageContainer-fqrHJuV_.js";import{g as b}from"./errors-3kY4UU5q.js";import{t as j}from"./date-DTgQQEB1.js";function E(){const{listingId:a}=x(),l=h(),[s,u]=n.useState(""),o=p({mutationFn:f,onSuccess:r=>{l(`/deals/predeal/${r.id}`)},onError:r=>{d.error(b(r,"Unable to create pre-deal"))}}),t=n.useMemo(()=>{if(!s)return null;try{return j(s)}catch{return null}},[s]),c=n.useMemo(()=>t?new Date(t).getTime()>Date.now():!1,[t]),m=async()=>{if(a){if(!t){d.error("Please select a valid date and time.");return}if(!c){d.error("Scheduled time must be in the future.");return}if(!t.endsWith("Z"))throw console.error("Scheduled date must be UTC ISO:",t),new Error("Invalid datetime format");o.mutate({listingId:a,scheduledAt:t})}};return a?e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsxs(i,{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground",children:"Schedule ad post"}),e.jsx("h1",{className:"text-xl font-semibold text-foreground",children:"Choose when the post should be published"})]}),e.jsx("div",{className:"rounded-2xl border border-border/60 bg-card/80 p-4 space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-semibold text-foreground",children:"Scheduled date & time"}),e.jsx("input",{type:"datetime-local",value:s,onChange:r=>u(r.target.value),className:"w-full rounded-lg border border-border/60 bg-background px-3 py-2 text-sm text-foreground"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"We will remind the channel owner at the scheduled time."})]})}),e.jsx("button",{type:"button",onClick:m,disabled:!s||o.isPending,className:"w-full rounded-lg bg-primary px-4 py-3 text-sm font-semibold text-primary-foreground transition disabled:opacity-60",children:o.isPending?"Scheduling...":"Continue"})]})}):e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx(i,{className:"py-6",children:e.jsx(g,{message:"Listing not selected",description:"Please return to the marketplace and select a listing to continue.",onRetry:()=>l("/marketplace")})})})}export{E as default};
