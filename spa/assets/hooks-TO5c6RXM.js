import{u as b,g as d}from"./errors-DT0qsOzt.js";import{S as O,t as U,v as T,w as V,x as S,y as l,r as m,z as F,B as P,o as u}from"./index-B6hEyGHB.js";import{m as s}from"./mockChannels-BOQTRySQ.js";var M=class extends O{#s;#r=void 0;#e;#t;constructor(t,e){super(),this.#s=t,this.setOptions(e),this.bindMethods(),this.#a()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const e=this.options;this.options=this.#s.defaultMutationOptions(t),U(this.options,e)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#e,observer:this}),e?.mutationKey&&this.options.mutationKey&&T(e.mutationKey)!==T(this.options.mutationKey)?this.reset():this.#e?.state.status==="pending"&&this.#e.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#e?.removeObserver(this)}onMutationUpdate(t){this.#a(),this.#i(t)}getCurrentResult(){return this.#r}reset(){this.#e?.removeObserver(this),this.#e=void 0,this.#a(),this.#i()}mutate(t,e){return this.#t=e,this.#e?.removeObserver(this),this.#e=this.#s.getMutationCache().build(this.#s,this.options),this.#e.addObserver(this),this.#e.execute(t)}#a(){const t=this.#e?.state??V();this.#r={...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}}#i(t){S.batch(()=>{if(this.#t&&this.hasListeners()){const e=this.#r.variables,r=this.#r.context;t?.type==="success"?(this.#t.onSuccess?.(t.data,e,r),this.#t.onSettled?.(t.data,null,e,r)):t?.type==="error"&&(this.#t.onError?.(t.error,e,r),this.#t.onSettled?.(void 0,t.error,e,r))}this.listeners.forEach(e=>{e(this.#r)})})}};function E(t,e){const r=l(),[a]=m.useState(()=>new M(r,t));m.useEffect(()=>{a.setOptions(t)},[a,t]);const o=m.useSyncExternalStore(m.useCallback(w=>a.subscribe(S.batchCalls(w)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),h=m.useCallback((w,f)=>{a.mutate(w,f).catch(F)},[a]);if(o.error&&P(a.options.throwOnError,[o.error]))throw o.error;return{...o,mutate:h,mutateAsync:o.mutate}}const v="flowgramx.mockDeals",A=Date.now(),i=t=>new Date(A-t*6e4).toISOString(),R=t=>new Date(A+t*6e4).toISOString(),L=t=>new Date(A+t*36e5).toISOString(),D=[{id:"DL-2001",status:"OWNER_ACCEPTED",updatedAt:i(8),priceTon:4.2,briefText:"Launch teaser for FlowgramX with CTA to beta waitlist.",channel:{id:s[0].id,title:s[0].title,username:s[0].username,avatarUrl:s[0].avatarUrl,isVerified:s[0].verified,subscribers:s[0].subscribers,averageViews:s[0].averageViews,language:s[0].language,priceTon:s[0].priceTon},escrow:{status:"AWAITING_PAYMENT",amountTon:4.2,network:"TON",depositAddress:"EQC2MockDepositAddress1111",memo:"FGX-2001",updatedAt:i(8)}},{id:"DL-2002",status:"CREATIVE_SUBMITTED",updatedAt:i(18),priceTon:3.5,briefText:"Promote new campaign dashboard with a short CTA to try demo.",channel:{id:s[1].id,title:s[1].title,username:s[1].username,avatarUrl:s[1].avatarUrl,isVerified:s[1].verified,subscribers:s[1].subscribers,averageViews:s[1].averageViews,language:s[1].language,priceTon:s[1].priceTon},escrow:{status:"FUNDS_LOCKED",amountTon:3.5,network:"TON",updatedAt:i(20)},creative:{text:"ðŸš€ FlowgramX just launched a smarter way to buy Telegram placements. Try the demo today.",submittedAt:i(18),approvedAt:null}},{id:"DL-2003",status:"SCHEDULED",updatedAt:i(40),priceTon:2.6,briefText:"Drive signups for creator waitlist with emphasis on verified channels.",channel:{id:s[2].id,title:s[2].title,username:s[2].username,avatarUrl:s[2].avatarUrl,isVerified:s[2].verified,subscribers:s[2].subscribers,averageViews:s[2].averageViews,language:s[2].language,priceTon:s[2].priceTon},escrow:{status:"FUNDS_LOCKED",amountTon:2.6,network:"TON",updatedAt:i(40)},creative:{text:"FlowgramX connects advertisers with top Telegram channels. Join the waitlist today.",submittedAt:i(60),approvedAt:i(48)},schedule:{scheduledAt:L(2),timezone:"UTC"}},{id:"DL-2004",status:"POSTED",updatedAt:i(6),priceTon:5.1,briefText:"Highlight escrow safety and bot-assisted messaging for advertisers.",channel:{id:s[3].id,title:s[3].title,username:s[3].username,avatarUrl:s[3].avatarUrl,isVerified:s[3].verified,subscribers:s[3].subscribers,averageViews:s[3].averageViews,language:s[3].language,priceTon:s[3].priceTon},escrow:{status:"FUNDS_LOCKED",amountTon:5.1,network:"TON",updatedAt:i(8)},creative:{text:"FlowgramX keeps your TON safe in escrow until the post is verified. Learn more today.",submittedAt:i(35),approvedAt:i(30)},schedule:{scheduledAt:i(15),timezone:"UTC"},post:{messageId:"99421",viewUrl:"https://t.me/signalstream/99421",verifyUntil:R(22),postedAt:i(12)}},{id:"DL-2005",status:"RELEASED",updatedAt:i(55),priceTon:3.1,briefText:"Showcase creative review and scheduling in the mini app.",channel:{id:s[4].id,title:s[4].title,username:s[4].username,avatarUrl:s[4].avatarUrl,isVerified:s[4].verified,subscribers:s[4].subscribers,averageViews:s[4].averageViews,language:s[4].language,priceTon:s[4].priceTon},escrow:{status:"RELEASED",amountTon:3.1,network:"TON",updatedAt:i(55)},creative:{text:"Our first FlowgramX campaign is live â€” thanks to the community!",submittedAt:i(120),approvedAt:i(110)},schedule:{scheduledAt:i(90),timezone:"UTC"},post:{messageId:"99400",viewUrl:"https://t.me/web3horizon/99400",verifyUntil:i(10),postedAt:i(80)}},{id:"DL-2006",status:"REFUNDED",updatedAt:i(90),priceTon:3.8,briefText:"Russian audience campaign for product launch update.",channel:{id:s[5].id,title:s[5].title,username:s[5].username,avatarUrl:s[5].avatarUrl,isVerified:s[5].verified,subscribers:s[5].subscribers,averageViews:s[5].averageViews,language:s[5].language,priceTon:s[5].priceTon},escrow:{status:"REFUNDED",amountTon:3.8,network:"TON",updatedAt:i(90)}}],I=()=>typeof window<"u"&&!!window.localStorage,g=()=>{if(!I())return[...D];const t=window.localStorage.getItem(v);if(!t)return window.localStorage.setItem(v,JSON.stringify(D)),[...D];try{const e=JSON.parse(t);if(Array.isArray(e)&&e.length>0)return e}catch(e){console.warn("Failed to parse mock deals",e)}return window.localStorage.setItem(v,JSON.stringify(D)),[...D]},N=t=>{I()&&window.localStorage.setItem(v,JSON.stringify(t))},_=()=>g(),q=t=>g().find(e=>e.id===t)??null,p=(t,e)=>{const r=g(),a=r.findIndex(h=>h.id===t);if(a===-1)return null;const o=e({...r[a]});return r[a]=o,N(r),o},k=()=>`DL-${Math.floor(1e3+Math.random()*9e3)}`,x=t=>{const e=s.find(f=>f.id===t.channelId)??s[0],r=new Date().toISOString(),a={id:k(),status:"REQUESTED",updatedAt:r,priceTon:e.priceTon,briefText:t.briefText,requestedScheduleAt:t.requestedScheduleAt??null,channel:{id:e.id,title:e.title,username:e.username,avatarUrl:e.avatarUrl,isVerified:e.verified,subscribers:e.subscribers,averageViews:e.averageViews,language:e.language,priceTon:e.priceTon}},o={...a,status:"OWNER_ACCEPTED",escrow:{status:"AWAITING_PAYMENT",amountTon:e.priceTon,network:"TON",depositAddress:"EQC2MockDepositAddress2222",memo:`FGX-${a.id}`,updatedAt:r}},h=g(),w=[o,...h];return N(w),o},K=t=>p(t,e=>{const r=new Date().toISOString(),a=!!e.schedule?.scheduledAt;return{...e,status:a?"SCHEDULED":"CREATIVE_APPROVED",updatedAt:r,creative:{...e.creative,approvedAt:r}}}),Q=(t,e)=>p(t,r=>{const a=new Date().toISOString();return{...r,status:"CREATIVE_DRAFTING",updatedAt:a,creative:{...r.creative,text:e?`${r.creative?.text??""}

Edits: ${e}`.trim():r.creative?.text,submittedAt:null,approvedAt:null,lastUpdatedAt:a}}}),G=t=>p(t,e=>{const r=new Date().toISOString();return e.escrow?.status==="AWAITING_PAYMENT"?{...e,status:"PAYMENT_CONFIRMING",updatedAt:r,escrow:{...e.escrow,status:"PAYMENT_CONFIRMING",updatedAt:r}}:e.escrow?.status==="PAYMENT_CONFIRMING"?{...e,status:"FUNDS_LOCKED",updatedAt:r,escrow:{...e.escrow,status:"FUNDS_LOCKED",updatedAt:r},creative:e.creative??{text:"",submittedAt:null,approvedAt:null}}:{...e,updatedAt:r}}),Y=t=>p(t,e=>{const r=new Date().toISOString();return{...e,status:"POSTED",updatedAt:r,post:{messageId:"10101",viewUrl:`https://t.me/${e.channel.username}/10101`,verifyUntil:R(25),postedAt:r}}}),W=t=>p(t,e=>{const r=new Date().toISOString();return{...e,status:"RELEASED",updatedAt:r,escrow:e.escrow?{...e.escrow,status:"RELEASED",updatedAt:r}:void 0}}),H=t=>p(t,e=>{const r=new Date().toISOString();return{...e,status:"REFUNDED",updatedAt:r,escrow:e.escrow?{...e.escrow,status:"REFUNDED",updatedAt:r}:void 0}}),ue=!0,c=async(t=300,e=600)=>{const r=Math.floor(Math.random()*(e-t+1))+t;await new Promise(a=>setTimeout(a,r))};console.info("MOCK MODE ENABLED for Deals");const X=async()=>(await c(),_()),B=async t=>{{await c();const e=q(t);if(!e)throw new Error("Deal not found");return e}},z=async t=>(await c(),x(t)),J=async t=>{{await c();const e=K(t);if(!e)throw new Error("Deal not found");return e}},$=async(t,e)=>{{await c();const r=Q(t,e);if(!r)throw new Error("Deal not found");return r}},j=async t=>{await c();const e=G(t);if(!e)throw new Error("Deal not found");return e},Z=async t=>{await c();const e=Y(t);if(!e)throw new Error("Deal not found");return e},ee=async t=>{await c();const e=W(t);if(!e)throw new Error("Deal not found");return e},te=async t=>{await c();const e=H(t);if(!e)throw new Error("Deal not found");return e},C={REQUESTED:{label:"Request sent",description:"Your request is with the channel owner. We'll notify you via bot once accepted.",ctaLabel:"View request",listAction:"View",category:"pending",tone:"neutral"},PAYMENT_REQUIRED:{label:"Payment required",description:"Escrow keeps funds safe until the post is verified.",ctaLabel:"Pay escrow",listAction:"Pay Now",category:"pending",tone:"warning"},PAYMENT_CONFIRMING:{label:"Payment confirming",description:"We're confirming your TON transfer. This usually takes a minute.",ctaLabel:"View payment",listAction:"View",category:"pending",tone:"info"},FUNDS_LOCKED:{label:"Funds locked",description:"Funds are secured in escrow while the channel drafts your creative.",ctaLabel:"Message via bot",listAction:"View",category:"active",tone:"info"},CREATIVE_DRAFTING:{label:"Creative drafting",description:"The channel owner is preparing the creative draft for your review.",ctaLabel:"Message via bot",listAction:"View",category:"active",tone:"info"},CREATIVE_REVIEW:{label:"Creative review",description:"Review the draft and approve to schedule delivery.",ctaLabel:"Review creative",listAction:"Review",category:"active",tone:"primary"},CREATIVE_APPROVED:{label:"Creative approved",description:"Creative approved. Waiting for channel to schedule the post.",ctaLabel:"View status",listAction:"View",category:"active",tone:"info"},SCHEDULED:{label:"Scheduled",description:"The post is scheduled and queued for delivery.",ctaLabel:"View schedule",listAction:"View",category:"active",tone:"info"},VERIFYING:{label:"Posted Â· verifying",description:"Post is live. Verification checks will release escrow automatically.",ctaLabel:"View post",listAction:"View Post",category:"active",tone:"primary"},RELEASED:{label:"Released",description:"Post verified. Escrow released to the channel owner.",ctaLabel:"View receipt",listAction:"Receipt",category:"completed",tone:"success"},REFUNDED:{label:"Refunded",description:"Verification failed or the deal was cancelled. Funds returned.",ctaLabel:"View receipt",listAction:"Receipt",category:"completed",tone:"danger"}},y=t=>t.status==="REFUNDED"||t.escrow?.status==="REFUNDED"?"REFUNDED":t.status==="RELEASED"||t.escrow?.status==="RELEASED"?"RELEASED":t.status==="VERIFYING"||t.status==="POSTED"||t.post?.viewUrl?"VERIFYING":t.status==="SCHEDULED"||t.schedule?.scheduledAt?"SCHEDULED":t.status==="CREATIVE_SUBMITTED"&&!t.creative?.approvedAt?"CREATIVE_REVIEW":t.status==="CREATIVE_APPROVED"||t.creative?.approvedAt?"CREATIVE_APPROVED":t.status==="CREATIVE_DRAFTING"?"CREATIVE_DRAFTING":t.status==="FUNDS_LOCKED"||t.escrow?.status==="FUNDS_LOCKED"?"FUNDS_LOCKED":t.status==="PAYMENT_CONFIRMING"||t.escrow?.status==="PAYMENT_CONFIRMING"?"PAYMENT_CONFIRMING":t.status==="PAYMENT_REQUIRED"||t.status==="OWNER_ACCEPTED"||t.escrow?.status==="AWAITING_PAYMENT"?"PAYMENT_REQUIRED":"REQUESTED",se=t=>{const e=y(t);return C[e].category},ce=t=>{const e=y(t);return C[e]},re=["Accepted","Payment","Creative","Scheduled","Posted","Released"],ae={REQUESTED:0,PAYMENT_REQUIRED:1,PAYMENT_CONFIRMING:1,FUNDS_LOCKED:2,CREATIVE_DRAFTING:2,CREATIVE_REVIEW:2,CREATIVE_APPROVED:3,SCHEDULED:3,VERIFYING:4,RELEASED:5,REFUNDED:5},le=t=>{const e=y(t),r=ae[e];return re.map((a,o)=>o<r?{label:a,state:"completed"}:o===r?{label:a,state:"current"}:{label:a,state:"upcoming"})},n={all:["deals"],list:t=>["deals","list",t],detail:t=>["deals","detail",t]},de=t=>b({queryKey:n.list(t),queryFn:X,select:e=>e.filter(r=>se(r)===t)}),Ee=t=>b({queryKey:t?n.detail(t):n.detail("unknown"),queryFn:()=>{if(!t)throw new Error("Missing deal ID");return B(t)},enabled:!!t}),pe=()=>{const t=l();return E({mutationFn:e=>z(e),onSuccess:e=>{t.invalidateQueries({queryKey:n.all}),t.setQueryData(n.detail(e.id),e),u.success("Request sent")},onError:e=>{u.error(d(e,"Unable to create deal"))}})},he=()=>{const t=l();return E({mutationFn:e=>J(e),onSuccess:e=>{t.invalidateQueries({queryKey:n.all}),t.setQueryData(n.detail(e.id),e),u.success("Creative approved")},onError:e=>{u.error(d(e,"Unable to approve creative"))}})},we=()=>{const t=l();return E({mutationFn:({id:e,note:r})=>$(e,r),onSuccess:e=>{t.invalidateQueries({queryKey:n.all}),t.setQueryData(n.detail(e.id),e),u.success("Edits requested")},onError:e=>{u.error(d(e,"Unable to request edits"))}})},me=()=>{const t=l();return E({mutationFn:e=>j(e),onSuccess:e=>{t.invalidateQueries({queryKey:n.all}),t.setQueryData(n.detail(e.id),e),u.success("Payment confirmed")},onError:e=>{u.error(d(e,"Unable to process payment"))}})},De=()=>{const t=l();return E({mutationFn:e=>Z(e),onSuccess:e=>{t.invalidateQueries({queryKey:n.all}),t.setQueryData(n.detail(e.id),e),u.success("Post published")},onError:e=>{u.error(d(e,"Unable to simulate post"))}})},ve=()=>{const t=l();return E({mutationFn:e=>ee(e),onSuccess:e=>{t.invalidateQueries({queryKey:n.all}),t.setQueryData(n.detail(e.id),e),u.success("Escrow released")},onError:e=>{u.error(d(e,"Unable to simulate release"))}})},ge=()=>{const t=l();return E({mutationFn:e=>te(e),onSuccess:e=>{t.invalidateQueries({queryKey:n.all}),t.setQueryData(n.detail(e.id),e),u.success("Deal refunded")},onError:e=>{u.error(d(e,"Unable to simulate refund"))}})};export{ue as U,de as a,Ee as b,he as c,we as d,me as e,De as f,ce as g,ve as h,ge as i,le as j,pe as u};
