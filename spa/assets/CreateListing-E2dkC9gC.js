import{a as te,d as se,e as re,y as ie,u as oe,f as ne,r,j as e,b as ae}from"./index-FC6y9RuK.js";import{g as le}from"./errors-3kY4UU5q.js";import{L as de}from"./ListingPreviewDetails-B4De7GQz.js";import{P as M}from"./PageContainer-D_xdjQdM.js";import{m as ce}from"./managedChannels-FAMZ8sT_.js";import{g as E,l as ue}from"./tagOptions-DHtvjoWf.js";import{c as xe}from"./listingsApi-LzUdg6Ug.js";import{f as me}from"./formatters-B6oyEeL1.js";import{h as I}from"./labels-EEWNt0UM.js";import{t as K}from"./date-DTgQQEB1.js";import{I as pe}from"./info-DBzz9qjK.js";const Q=(t,h,c)=>{if(t==="custom"){const x=Number(h);return Number.isFinite(x)&&x>0?x:c}const u=Number(t);return Number.isFinite(u)?u:c};function Te(){const{t,language:h}=te(),{id:c}=se(),u=re(),a=ie()?.channel??(c?ce[c]:null),B=oe(),m=ne(),k=u.state?.rootBackTo,[f,D]=r.useState("25"),[l,y]=r.useState("none"),[P,V]=r.useState(""),[p,L]=r.useState("24"),[H,z]=r.useState(""),[v,U]=r.useState(!0),[j,W]=r.useState(!0),[N,Y]=r.useState(""),[b,G]=r.useState(""),[R,q]=r.useState(""),[n,w]=r.useState(["Must be pre-approved"]),[S,O]=r.useState(!1),[$]=r.useState(()=>new Date),[F]=r.useState(()=>new Date(Date.now()+10080*60*1e3)),J=r.useMemo(()=>[{label:t("listings.pinDuration.none"),value:"none"},{label:t("listings.pinDuration.optionHours",{hours:6}),value:"6"},{label:t("listings.pinDuration.optionHours",{hours:12}),value:"12"},{label:t("listings.pinDuration.optionHours",{hours:24}),value:"24"},{label:t("listings.pinDuration.optionHours",{hours:48}),value:"48"},{label:t("common.custom"),value:"custom"}],[t]),X=r.useMemo(()=>[{label:t("listings.visibilityDuration.optionHours",{hours:24}),value:"24"},{label:t("listings.visibilityDuration.optionHours",{hours:48}),value:"48"},{label:t("listings.visibilityDuration.optionHours",{hours:72}),value:"72"},{label:t("listings.visibilityDuration.optionDays",{days:7}),value:"168"},{label:t("common.custom"),value:"custom"}],[t]),g=l==="none"?null:Q(l,P,24),A=Q(p,H,24);if(!a)return e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsx(M,{className:"py-6",children:e.jsx("p",{className:"text-muted-foreground",children:t("channels.notFound")})})});const Z=async()=>{if(S)return;const s=n.includes("Must be pre-approved")?n:[...n,"Must be pre-approved"],o={channelId:a.id,format:"POST",priceTon:Number(f||0),availabilityFrom:K($),availabilityTo:K(F),pinDurationHours:g,visibilityDurationHours:A,allowEdits:v,requiresApproval:!0,contentRulesText:N,tags:s,isActive:!0,allowLinkTracking:j,allowPinnedPlacement:g!==null};try{O(!0),await xe(o),await m.invalidateQueries({queryKey:["listingsByChannel",a.id]}),await m.invalidateQueries({queryKey:["marketplaceListingsByChannel",a.id]}),m.invalidateQueries({queryKey:["channelListingsPreview",a.id]}),m.invalidateQueries({queryKey:["channelsList"]}),B(`/channel-manage/${a.id}/listings`,{state:k?{rootBackTo:k}:void 0})}catch(d){ae.error(le(d,t("listings.publishError")))}finally{O(!1)}};return e.jsx("div",{className:"w-full max-w-2xl mx-auto",children:e.jsxs(M,{className:"py-6 space-y-6",children:[e.jsxs("section",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold text-foreground",children:t("listings.adFormatTitle")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("listings.adFormatSubtitle")})]}),e.jsxs("select",{className:"w-full rounded-xl border border-border/60 bg-card px-3 py-3 text-sm text-foreground",children:[e.jsx("option",{value:"POST",children:t("listings.format.POST")}),e.jsx("option",{value:"FORWARD",disabled:!0,children:t("listings.format.forwardComingSoon")}),e.jsx("option",{value:"STORY",disabled:!0,children:t("listings.format.storyComingSoon")})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold text-foreground",children:t("listings.pricePerPostTitle")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("listings.pricePerPostSubtitle")})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsx("input",{type:"number",value:f,onChange:s=>D(s.target.value),placeholder:t("listings.pricePlaceholder"),className:"w-full rounded-xl border border-border/60 bg-card px-3 py-3 text-sm text-foreground sm:flex-1"}),e.jsxs("div",{className:"flex items-center justify-between gap-2 rounded-xl border border-border/60 bg-card/60 px-2 py-2 text-xs text-muted-foreground sm:w-auto",children:[e.jsx("button",{type:"button",className:"rounded-lg bg-primary/20 px-3 py-1 text-xs font-semibold text-primary",children:t("common.ton")}),e.jsxs("div",{className:"rounded-lg border border-border/60 bg-muted/60 px-3 py-1 text-center text-[11px] font-semibold text-muted-foreground",children:[t("common.usd"),e.jsx("div",{className:"text-[9px] uppercase tracking-wide text-muted-foreground",children:t("common.comingSoon")})]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[10,25,50].map(s=>e.jsxs("button",{type:"button",onClick:()=>D(String(s)),className:"rounded-lg border border-border/60 bg-secondary/60 px-3 py-1 text-xs text-foreground",children:["+",me(s,h)," ",t("common.ton")]},s))})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold text-foreground",children:t("listings.visibilityRequirementsTitle")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("listings.visibilityRequirementsSubtitle")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-semibold text-foreground",children:t("listings.pinnedDurationLabel")}),e.jsx("select",{value:l,onChange:s=>y(s.target.value),className:"w-full rounded-xl border border-border/60 bg-card px-3 py-2 text-sm text-foreground",children:J.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[[6,12,24,48].map(s=>e.jsx("button",{type:"button",onClick:()=>y(String(s)),className:`rounded-lg border px-3 py-1 text-[11px] ${l===String(s)?"border-primary/60 bg-primary/20 text-primary":"border-border/60 bg-secondary/60 text-foreground"}`,children:I(s,t)},s)),e.jsx("button",{type:"button",onClick:()=>y("none"),className:`rounded-lg border px-3 py-1 text-[11px] ${l==="none"?"border-primary/60 bg-primary/20 text-primary":"border-border/60 bg-secondary/60 text-foreground"}`,children:t("common.off")})]}),l==="custom"?e.jsx("input",{type:"number",value:P,onChange:s=>V(s.target.value),placeholder:t("listings.customHours"),className:"w-full rounded-xl border border-border/60 bg-card px-3 py-2 text-sm text-foreground"}):null,e.jsx("p",{className:"text-xs text-muted-foreground",children:t("listings.pinnedDurationHint")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-semibold text-foreground",children:t("listings.visibilityDurationLabel")}),e.jsx("select",{value:p,onChange:s=>L(s.target.value),className:"w-full rounded-xl border border-border/60 bg-card px-3 py-2 text-sm text-foreground",children:X.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[24,48,72,168].map(s=>e.jsx("button",{type:"button",onClick:()=>L(String(s)),className:`rounded-lg border px-3 py-1 text-[11px] ${p===String(s)?"border-primary/60 bg-primary/20 text-primary":"border-border/60 bg-secondary/60 text-foreground"}`,children:I(s,t)},s))}),p==="custom"?e.jsx("input",{type:"number",value:H,onChange:s=>z(s.target.value),placeholder:t("listings.customHours"),className:"w-full rounded-xl border border-border/60 bg-card px-3 py-2 text-sm text-foreground"}):null,e.jsx("p",{className:"text-xs text-muted-foreground",children:t("listings.visibilityDurationHint")})]}),e.jsxs("div",{className:"rounded-xl border border-primary/30 bg-primary/10 px-3 py-3 text-xs text-primary",children:[e.jsx("p",{className:"font-semibold text-foreground",children:t("listings.escrowRuleTitle")}),e.jsx("p",{className:"mt-1 text-[11px] text-muted-foreground",children:t("listings.escrowRuleSubtitle")})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold text-foreground",children:t("listings.conditionsTitle")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("listings.conditionsSubtitle")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center justify-between rounded-xl border border-border/60 bg-card px-3 py-3 text-sm",children:[e.jsx("span",{className:"text-foreground",children:t("listings.allowEditsPrompt")}),e.jsx("input",{type:"checkbox",checked:v,onChange:s=>U(s.target.checked),className:"h-4 w-4"})]}),e.jsxs("label",{className:"flex items-center justify-between rounded-xl border border-border/60 bg-card px-3 py-3 text-sm",children:[e.jsx("span",{className:"text-foreground",children:t("listings.allowLinkTrackingPrompt")}),e.jsx("input",{type:"checkbox",checked:j,onChange:s=>W(s.target.checked),className:"h-4 w-4"})]}),e.jsxs("label",{className:"flex items-center justify-between rounded-xl border border-border/40 bg-card/60 px-3 py-3 text-sm opacity-80",children:[e.jsxs("span",{className:"text-foreground",children:[t("listings.preApprovalLocked"),e.jsx("span",{className:"ml-2 text-[10px] uppercase tracking-wide text-primary",children:t("common.locked")})]}),e.jsx("input",{type:"checkbox",checked:!0,disabled:!0,className:"h-4 w-4"})]})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold text-foreground",children:t("listings.tagsTitle")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("listings.tagsSubtitle")}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:t("listings.tagsHint")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",value:b,onChange:s=>G(s.target.value),placeholder:t("common.search"),className:"w-full rounded-xl border border-border/60 bg-card px-3 py-3 text-sm text-foreground"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:R,onChange:s=>q(s.target.value),placeholder:t("listings.addCustomTag"),className:"flex-1 rounded-xl border border-border/60 bg-card px-3 py-3 text-sm text-foreground"}),e.jsx("button",{type:"button",onClick:()=>{const s=R.trim();s&&(n.includes(s)||w(o=>[...o,s]),q(""))},className:"rounded-lg border border-primary/40 bg-primary/10 px-4 py-3 text-xs font-semibold text-primary",children:t("common.add")})]})]}),n.length>0?e.jsx("div",{className:"flex flex-wrap gap-2 text-[11px] text-foreground",children:n.map(s=>{const o=s==="Must be pre-approved";return e.jsxs("button",{type:"button",onClick:()=>{o||w(d=>d.filter(i=>i!==s))},className:`rounded-lg px-2.5 py-1 ${o?"bg-secondary/60 text-foreground":"bg-secondary/60 text-foreground hover:bg-secondary"}`,children:[E(s,t),o?` • ${t("common.locked")}`:` ${t("common.removeTagSuffix")}`]},s)})}):null,e.jsx("div",{className:"space-y-4",children:ue.map(s=>{const o=s.tags.filter(i=>E(i.value,t).toLowerCase().includes(b.trim().toLowerCase()));if(!b&&o.length===0)return null;const d=b?o:s.tags;return d.length===0?null:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-foreground",children:t(s.titleKey)}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.map(i=>{const C=i.value==="Must be pre-approved",_=n.includes(i.value);return e.jsxs("button",{type:"button",onClick:()=>{C||w(T=>T.includes(i.value)?T.filter(ee=>ee!==i.value):[...T,i.value])},className:`rounded-lg border px-3 py-1 text-xs transition-colors ${_?"border-primary/60 bg-primary/20 text-primary":"border-border/60 bg-card text-muted-foreground hover:text-foreground"} ${C?"cursor-not-allowed opacity-70":""}`,children:[t(i.labelKey),C?` • ${t("common.locked")}`:""]},i.value)})})]},s.titleKey)})})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold text-foreground",children:t("listings.additionalRequirementsTitle")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("listings.additionalRequirementsSubtitle")})]}),e.jsx("textarea",{value:N,onChange:s=>Y(s.target.value),placeholder:t("listings.additionalRequirementsPlaceholder"),className:"min-h-[120px] w-full rounded-xl border border-border/60 bg-card px-3 py-3 text-sm text-foreground"})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold text-foreground",children:t("listings.previewTitle")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("listings.previewSubtitle")})]}),e.jsx(de,{priceTon:Number(f||0),format:"POST",pinDurationHours:g,visibilityDurationHours:A,allowEdits:v,allowLinkTracking:j,allowPinnedPlacement:g!==null,tags:n,requiresApproval:!0,additionalRequirementsText:N,availabilityFrom:$.toISOString(),availabilityTo:F.toISOString()})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{type:"button",onClick:Z,disabled:S,className:"w-full button-primary py-3 text-base font-semibold disabled:opacity-70",children:t(S?"listings.publishing":"listings.publishAction")}),e.jsxs("div",{className:"flex items-start gap-2 rounded-xl border border-border/60 bg-card px-3 py-3 text-xs text-muted-foreground",children:[e.jsx(pe,{size:16,className:"text-primary"}),e.jsx("span",{children:t("listings.escrowNote")})]})]})]})})}export{Te as default};
